try{if(!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return true;}}).x){Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:false,configurable:true,value:function(name,func){Object.defineProperty(this,name,{get:func,enumerable:true,configurable:true});}});Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:false,configurable:true,value:function(name,func){Object.defineProperty(this,name,{set:func,enumerable:true,configurable:true});}});}}catch(defPropException){}function getInternetExplorerVersion(){try{var sAgent=window.navigator.userAgent;var Idx=sAgent.indexOf("MSIE");if(Idx>0){return parseInt(sAgent.substring(Idx+5,sAgent.indexOf(".",Idx)));}else{if(!!navigator.userAgent.match(/Trident\/7\./)){return 11;}else{return 0;}}}catch(err){}return null;}function checkIEVersion(){try{var ver=getInternetExplorerVersion();if(ver>0){if(confirm("ALERT! You're using an OLD unsupported version of Windows Internet Explorer. Only IE Edge and above are supported.")){window.location="https://mockflow.com";}else{window.location="https://mockflow.com";}}}catch(err){}}var MF_Global=(function(){function privateMethod(){}return{serverURL:function(){return"https://designcollab.mockflow.com/";},getS3Bucket:function(){return"mfassets";},getS3URL:function(){return"https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/";},projectImageURL:function(){return"https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/designcollab/company/"+MF_UserSession.getUser().company+"/projects/thumbnails/";},projectSharedImageURL:function(company){return"https://s3.amazonaws.com/"+MF_Global.getS3Bucket()+"/app/designcollab/company/"+company+"/projects/thumbnails/";}};})();function MF_Project(){var thisClass=this;this.id=null;this.title=null;this.creator=null;this.createDate=null;this.updateDate=null;this.share=false;this.shareDisabled=false;this.isBasic=true;this.permitted=false;this.sharedClient=null;this.permissionType=null;this.realtime=false;this.revision=false;this.stamp=null;this.checkPermission=false;this.comments=0;this.members=0;this.variations=0;this.data=null;this.boards=0;this.approveCount=0;this.approvedVariation=null;this.approved=false;this.isdeleted=false;this.deletedon=null;this.readonly=false;this.awaitingApproval=false;this.sentForApproval=false;this.approvedProject=false;this.collaborators=null;this.sharePerm=null;this.emailAlert=true;this.company=null;this.publicURL=null;var creatorImage="";this.__defineGetter__("creatorImage",function(){var cr=thisClass.creator;if(cr=="mockflow@produle.com"){cr="dummymf";}var str=MF_Utils.get_gravatar(cr,32);return str;});this.__defineSetter__("creatorImage",function(val){creatorImage=val;});this.__defineSetter__("isShared",function(val){});this.__defineGetter__("isShared",function(){if(thisClass.permissionTypeStr=="Owner"){return"";}return true;});var isApproved=false;this.__defineGetter__("isApproved",function(){if(thisClass.boards>0){if(thisClass.approveCount===thisClass.boards){return true;}else{return false;}}else{return false;}return false;});this.__defineSetter__("isApproved",function(val){isApproved=val;});var memberStr="";this.__defineGetter__("memberStr",function(){return"Members: "+thisClass.members;});this.__defineSetter__("memberStr",function(val){memberStr=val;});var commentStr="";this.__defineGetter__("commentStr",function(){return thisClass.comments;});this.__defineSetter__("commentStr",function(val){commentStr=val;});var variationStr="";this.__defineGetter__("variationStr",function(){return"Variations: "+thisClass.variations;});this.__defineSetter__("variationStr",function(val){variationStr=val;});var createDateStr="";this.__defineGetter__("createDateStr",function(){if(thisClass.createDate!=null){var curr_date=thisClass.createDate.getDate();var curr_month=thisClass.createDate.getMonth()+1;var curr_year=thisClass.createDate.getFullYear();var hours=thisClass.createDate.getHours();var minutes=thisClass.createDate.getMinutes();return curr_date+" "+MF_Utils.getMonthByName(thisClass.createDate.getMonth())+" "+curr_year+" - "+hours+":"+minutes;}else{return thisClass.createDate;}});this.__defineSetter__("createDateStr",function(val){createDateStr=val;});var updateDateStr="";this.__defineGetter__("updateDateStr",function(){if(thisClass.updateDate!=null){var curr_date=thisClass.updateDate.getDate();var curr_month=thisClass.updateDate.getMonth()+1;var curr_year=thisClass.updateDate.getFullYear();var hours=thisClass.updateDate.getHours();var minutes=thisClass.updateDate.getMinutes();return curr_date+" "+MF_Utils.getMonthByName(thisClass.updateDate.getMonth())+" "+curr_year+" - "+hours+":"+minutes;}else{return thisClass.updateDate;}});this.__defineSetter__("updateDateStr",function(val){updateDateStr=val;});var shareStr="no";this.__defineGetter__("shareStr",function(){if(thisClass.share){return"yes";}else{return"no";}});this.__defineSetter__("shareStr",function(val){shareStr=val;});var owner=true;this.__defineGetter__("owner",function(){if(MF_UserSession.getUser()&&thisClass.company==MF_UserSession.getUser().company){return true;}return false;});this.__defineSetter__("owner",function(val){owner=val;});var permissionTypeStr="owner";this.__defineGetter__("permissionTypeStr",function(){if(thisClass.permissionType==null){return"Owner";}else{return thisClass.permissionType;}});this.__defineSetter__("permissionTypeStr",function(val){permissionTypeStr=val;});this.__defineGetter__("isShared",function(){if(thisClass.permissionTypeStr=="Owner"){return"";}return true;});var thumbnailURL="";this.__defineGetter__("thumbnailURL",function(){if(thisClass.permitted){return MF_Global.projectSharedImageURL(thisClass.company)+thisClass.id;}else{return MF_Global.projectImageURL()+thisClass.id;}});this.__defineSetter__("thumbnailURL",function(val){thumbnailURL=val;});this.__defineGetter__("creatorStr",function(){if(MF_UserSession.getUser()&&thisClass.company==MF_UserSession.getUser().company){return"Me";}return thisClass.creator;});this.__defineSetter__("creatorStr",function(val){});this.__defineGetter__("createdByStr",function(){if(MF_UserSession.getUser()&&thisClass.company==MF_UserSession.getUser().company){return"Created By";}return"Shared By";});this.__defineSetter__("createdByStr",function(val){});var daysToDelete="";this.__defineGetter__("daysToDelete",function(){if(thisClass.isdeleted){var dateToday=new Date();var dateDeleted=new Date(thisClass.deletedon);var differenceDays=(dateDeleted.getTime()-dateToday.getTime())/(1000*3600*24);differenceDays=Math.round(differenceDays+30);if(differenceDays<2){return"1 day";}else{return differenceDays+" days";}}return"";});this.__defineSetter__("daysToDelete",function(val){daysToDelete=val;});this.cast=function(obj){this.id=obj.id;this.title=obj.title;this.creator=obj.creator;this.createDate=obj.createDate;this.updateDate=obj.updateDate;this.share=obj.share;this.shareDisabled=obj.shareDisabled;this.isBasic=obj.isBasic;this.permitted=obj.permitted;this.sharedClient=obj.shareClient;this.permissionType=obj.permissionType;this.realtime=obj.realtime;this.revision=obj.revision;this.stamp=obj.stamp;this.checkPermission=obj.checkPermission;this.comments=obj.comments;this.members=obj.members;this.company=obj.company;this.sharePerm=obj.sharePerm;this.variations=obj.variations;this.collaborators=obj.collaborators;this.approvedVariation=obj.approvedVariation;this.boards=obj.boards;this.approveCount=obj.approveCount;this.approved=obj.approved;this.awaitingApproval=obj.awaitingApproval;this.sentForApproval=obj.sentForApproval;this.approvedProject=obj.approvedProject;this.publicURL=obj.publicURL;this.isdeleted=obj.isdeleted;this.deletedon=obj.deletedon;this.readonly=obj.readonly;};}function MF_ChatMember(){var thisClass=this;this.userid=null;this.name=null;this.online=false;this.cast=function(obj){thisClass.userid=obj.userid;thisClass.name=obj.name;};}function MF_Board(){var thisClass=this;this.id=null;this.name=null;this.type=null;this.clientid=null;this.approvedVariation=null;this.variations=null;this.sortDate=null;this.projectId=null;this.variationList=null;this.approver=null;this.__defineGetter__("hasApprover",function(){if(thisClass.approver==null){return false;}if(thisClass.approver==""){return false;}return true;});this.__defineGetter__("approverThumbnail",function(){if(this.approver){return(MF_Utils.get_gravatar(this.approver));}return"";});this.__defineGetter__("approverTooltip",function(){var tooltip="";if(mf_main.PUBLIC){if(this.hasApprover){tooltip="Design approver for this board";}else{tooltip="No approver for this board";}}else{if(this.hasApprover){tooltip="Approver : "+this.approver;}else{tooltip="Add an approver for this board";}}return tooltip;});this.cast=function(obj){this.id=obj.id;this.name=obj.name;this.type=obj.type;this.approvedVariation=obj.approvedVariation;this.variations=obj.variations;this.clientid=obj.clientid;this.sortDate=obj.sortDate;this.projectId=obj.projectId;this.variationList=[];this.approver=obj.approver;for(var i=0;i<obj.variationList.length;i++){var curVariation=new MF_ImgVariation();curVariation.cast(obj.variationList[i]);this.variationList.push(curVariation);}};}function MF_ImgVariation(){var thisClass=this;this.id=null;this.varid=0;this.boardid=null;this.name=null;this.type=null;this.creator=null;this.createDate=null;this.sortDate=null;this.width=0;this.height=0;this.projectid=null;this.clientid=null;this.description=null;this.comments=0;this.rating=0;this.ratingCount=0;this.approved=false;this.isUnread=false;this.variationLabel=null;var thumbnailURL="";this.__defineGetter__("thumbnailURL",function(){return MF_Global.getS3URL()+"app/designcollab/company/"+thisClass.clientid+"/projects/"+thisClass.projectid+"/board/"+this.boardid+"/variations/thumbnails/"+thisClass.id;});this.__defineSetter__("thumbnailURL",function(val){thumbnailURL=val;});var imageURL="";this.__defineGetter__("imageURL",function(){return MF_Global.getS3URL()+"app/designcollab/company/"+thisClass.clientid+"/projects/"+thisClass.projectid+"/board/"+this.boardid+"/variations/"+thisClass.id;});this.__defineSetter__("imageURL",function(val){imageURL=val;});var variationLabelDisplay=false;this.__defineGetter__("variationLabelDisplay",function(){if(thisClass.variationLabel!=null&&thisClass.variationLabel!="null"&&thisClass.variationLabel!=""&&thisClass.variationLabel!="approved"){return true;}return false;});this.__defineSetter__("variationLabelDisplay",function(val){variationLabelDisplay=val;});var variationLabelText="";this.__defineGetter__("variationLabelText",function(){if(thisClass.variationLabel!=null&&thisClass.variationLabel!="null"&&thisClass.variationLabel!=""){variationLabelText=mf_main.editorController.variationViewer.labelJSONData[thisClass.variationLabel].name;return variationLabelText;}});this.__defineSetter__("variationLabelText",function(val){variationLabelText=val;});var variationLabelColor="";this.__defineGetter__("variationLabelColor",function(){if(thisClass.variationLabel!=null&&thisClass.variationLabel!="null"&&thisClass.variationLabel!=""){variationLabelColor=mf_main.editorController.variationViewer.labelJSONData[thisClass.variationLabel].color;return variationLabelColor;}});this.__defineSetter__("variationLabelColor",function(val){variationLabelColor=val;});this.cast=function(obj){this.id=obj.id;this.varid=obj.varid;this.boardid=obj.boardid;this.name=obj.name;this.type=obj.type;this.creator=obj.creator;this.createDate=obj.createDate;this.sortDate=obj.sortDate;this.width=obj.width;this.height=obj.height;this.projectid=obj.projectid;this.clientid=obj.clientid;this.description=obj.description;this.comments=obj.comments;this.rating=obj.rating;this.ratingCount=obj.ratingCount;this.isUnread=obj.isUnread;this.variationLabel=obj.variationLabel;};}function MF_ChatMsg(){var thisClass=this;this.id=null;this.sender=null;this.msg=null;this.senderName=null;var senderNameStr="";this.__defineGetter__("senderNameStr",function(){if(thisClass.sender.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()){return"Me";}else{return thisClass.senderName;}});this.__defineSetter__("senderNameStr",function(val){senderNameStr=val;});var profileImage="";this.__defineGetter__("profileImage",function(){var cr=thisClass.sender;if(cr=="mockflow@produle.com"){cr="dummymf";}var str=MF_Utils.get_gravatar(cr,48);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});this.cast=function(obj){thisClass.id=obj.id;thisClass.sender=obj.sender;thisClass.msg=obj.msg;thisClass.senderName=obj.senderName;};}function MF_ProjectInfoData(){var thisClass=this;this.collaborators=null;this.log=null;}function MF_Feedback(){var thisClass=this;this.id=null;this.projectid=null;this.boardid=null;this.varid=null;this.message=null;this.creator=null;this.createDate=null;this.creatorName=null;this.pos=null;this.comment=null;this.reply=null;this.attached=null;var createDateStr="";this.__defineGetter__("createDateStr",function(){if(thisClass.createDate!=null){var curr_date=thisClass.createDate.getDate();var curr_month=thisClass.createDate.getMonth()+1;var curr_year=thisClass.createDate.getFullYear();var hours=thisClass.createDate.getHours();var minutes=thisClass.createDate.getMinutes();return curr_date+" "+MF_Utils.getMonthByName(thisClass.createDate.getMonth())+" "+curr_year;}else{return thisClass.createDate;}});this.__defineSetter__("createDateStr",function(val){createDateStr=val;});var createDatePast="";this.__defineGetter__("createDatePast",function(){if(thisClass.createDate!=null){return moment(thisClass.createDate).format("D MMM YYYY, h:mm a");}else{return thisClass.createDate;}});this.__defineSetter__("createDatePast",function(val){createDatePast=val;});var messageStr="";this.__defineGetter__("messageStr",function(){var str=thisClass.message.replace(/(\r\n|\n|\r)/gm,"<br/>");return str;});this.__defineSetter__("messageStr",function(val){messageStr=val;});var isReply=false;this.__defineGetter__("isReply",function(){if(thisClass.reply!=null){return true;}else{return false;}});this.__defineSetter__("isReply",function(val){isReply=val;});var creatorNameStr="";this.__defineGetter__("creatorNameStr",function(){if(MF_UserSession.getUser()!=null&&MF_UserSession.getUser()!=""){if(thisClass.creator.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()){return"Me";}else{return thisClass.creatorName;}}else{return thisClass.creatorName;}});this.__defineSetter__("creatorNameStr",function(val){creatorNameStr=val;});var annotate="";this.__defineGetter__("annotate",function(){if(thisClass.pos!=null){var arr=thisClass.pos.split(",");if(arr.length==2){return true;}return false;}else{return false;}});this.__defineSetter__("annotate",function(val){annotate=val;});var isAttached=false;this.__defineGetter__("isAttached",function(){if(thisClass.attached==null||thisClass.attached==""){return false;}else{return true;}});this.__defineSetter__("isAttached",function(val){isAttached=val;});var image=false;this.__defineGetter__("image",function(){if(thisClass.attached=="png"||thisClass.attached=="gif"||thisClass.attached=="jpg"){return true;}else{return false;}});this.__defineSetter__("image",function(val){image=val;});var thumbnailURL="";this.__defineGetter__("thumbnailURL",function(){return MF_Global.getS3URL()+"app/designcollab/company/"+mf_main.editorController.projectObj.company+"/projects/"+mf_main.editorController.projectObj.id+"/board/"+thisClass.boardid+"/variations/"+thisClass.varid+"/feedback/thumbnail/"+thisClass.id+"."+thisClass.attached;});this.__defineSetter__("thumbnailURL",function(val){thumbnailURL=val;});var attachURL="";this.__defineGetter__("attachURL",function(){return MF_Global.getS3URL()+"app/designcollab/company/"+mf_main.editorController.projectObj.company+"/projects/"+mf_main.editorController.projectObj.id+"/board/"+thisClass.boardid+"/variations/"+thisClass.varid+"/feedback/"+thisClass.id+"."+thisClass.attached;});this.__defineSetter__("attachURL",function(val){attachURL=val;});var profileImage="";this.__defineGetter__("profileImage",function(){var cr=thisClass.creator;if(cr=="mockflow@produle.com"){cr="dummymf";}var str=MF_Utils.get_gravatar(cr,48);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});this.cast=function(obj){this.id=obj.id;this.projectid=obj.projectid;this.boardid=obj.boardid;this.varid=obj.varid;this.message=obj.message;this.creator=obj.creator;this.createDate=obj.createDate;this.creatorName=obj.creatorName;this.pos=obj.pos;this.comment=obj.comment;this.reply=obj.reply;this.attached=obj.attached;this.canDelete=obj.canDelete;this.canEdit=obj.canEdit;};}function MF_Activity(){var thisClass=this;this.id=null;this.projectid=null;this.boardid=null;this.message=null;this.creator=null;this.createDate=null;this.creatorName=null;this.clientid=null;this.comment=null;this.varid=null;this.attached=null;this.type=null;var isAttached=false;this.__defineGetter__("isAttached",function(){if(thisClass.attached==null||thisClass.attached==""){return false;}else{return true;}});this.__defineSetter__("isAttached",function(val){isAttached=val;});var image=false;this.__defineGetter__("image",function(){if(thisClass.attached=="png"||thisClass.attached=="gif"||thisClass.attached=="jpg"){return true;}else{return false;}});this.__defineSetter__("image",function(val){image=val;});var thumbnailURL="";this.__defineGetter__("thumbnailURL",function(){return MF_Global.getS3URL()+"app/designcollab/company/"+mf_main.editorController.projectObj.company+"/projects/"+mf_main.editorController.projectObj.id+"/board/"+thisClass.boardid+"/variations/"+thisClass.varid+"/feedback/thumbnail/"+thisClass.id+"."+thisClass.attached;});this.__defineSetter__("thumbnailURL",function(val){thumbnailURL=val;});var attachURL="";this.__defineGetter__("attachURL",function(){return MF_Global.getS3URL()+"app/designcollab/company/"+mf_main.editorController.projectObj.company+"/projects/"+mf_main.editorController.projectObj.id+"/board/"+thisClass.boardid+"/variations/"+thisClass.varid+"/feedback/"+thisClass.id+"."+thisClass.attached;});this.__defineSetter__("attachURL",function(val){attachURL=val;});var createDateStr="";this.__defineGetter__("createDateStr",function(){if(thisClass.createDate!=null){var curr_date=thisClass.createDate.getDate();var curr_month=thisClass.createDate.getMonth()+1;var curr_year=thisClass.createDate.getFullYear();var hours=thisClass.createDate.getHours();var minutes=thisClass.createDate.getMinutes();return curr_date+" "+MF_Utils.getMonthByName(thisClass.createDate.getMonth())+" "+curr_year;}else{return thisClass.createDate;}});this.__defineSetter__("createDateStr",function(val){createDateStr=val;});var messageStr="";this.__defineGetter__("messageStr",function(){var str=thisClass.message.replace(/(\r\n|\n|\r)/gm,"<br/>");return str;});this.__defineSetter__("messageStr",function(val){messageStr=val;});var creatorNameStr="";this.__defineGetter__("creatorNameStr",function(){if(MF_UserSession.getUser()!=null&&MF_UserSession.getUser()!=""){if(thisClass.creator.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()){return"Me";}else{return thisClass.creatorName;}}else{return thisClass.creatorName;}});this.__defineSetter__("creatorNameStr",function(val){creatorNameStr=val;});var profileImage="";this.__defineGetter__("profileImage",function(){var cr=thisClass.creator;if(cr=="mockflow@produle.com"){cr="dummymf";}var str=MF_Utils.get_gravatar(cr,30);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});this.cast=function(obj){this.id=obj.id;this.projectid=obj.projectid;this.boardid=obj.boardid;this.clientid=obj.clientid;this.message=obj.message;this.creator=obj.creator;this.createDate=obj.createDate;this.creatorName=obj.creatorName;this.comment=obj.comment;this.varid=obj.varid;this.attached=obj.attached;this.type=obj.type;};}function MF_LicenseData(){var thisClass=this;this.licenses=null;this.userLicenses=null;}function MF_SharePerm(){var thisClass=this;this.canViewLog=true;this.canViewMembers=true;this.canRateDesign=true;this.canUploadImage=true;this.canDeleteImage=true;this.canCreateBoard=true;this.canEditBoard=true;this.canDeleteBoard=true;this.cast=function(obj){this.canViewLog=obj.canViewLog;this.canViewMembers=obj.canViewMembers;this.canRateDesign=obj.canRateDesign;this.canUploadImage=obj.canUploadImage;this.canDeleteImage=obj.canDeleteImage;this.canCreateBoard=obj.canCreateBoard;this.canEditBoard=obj.canEditBoard;this.canDeleteBoard=obj.canDeleteBoard;};}function MF_License(){var thisClass=this;this.id=null;this.clientid=null;this.users=0;this.edition=null;this.cost=0;this.txnID=null;this.status=null;this.period=null;this.monthly=false;this.createDate=null;var periodStr="";this.__defineGetter__("periodStr",function(){if(thisClass.period!=null){var curr_date=thisClass.period.getDate();var curr_month=thisClass.period.getMonth()+1;var curr_year=thisClass.period.getFullYear();var da=curr_date+" "+MF_Utils.getMonthByName(thisClass.period.getMonth())+" "+curr_year;if(thisClass.status=="active"||thisClass.status=="invoiced"||thisClass.status=="failed"){return"Renews On: "+da;}if(thisClass.status=="expired"||thisClass.status=="Expired"){return"Expired On: "+da;}if(thisClass.status=="cancelled"){return"Expires On: "+da;}return da;}else{return thisClass.period;}});this.__defineSetter__("periodStr",function(val){periodStr=val;});var createDateFormat="";this.__defineGetter__("createDateFormat",function(){if(thisClass.createDate!=null){var curr_date=thisClass.createDate.getDate();var curr_month=thisClass.createDate.getMonth()+1;var curr_year=thisClass.createDate.getFullYear();return curr_year+"-"+curr_month+"-"+curr_date;}else{return thisClass.createDate;}});this.__defineSetter__("createDateFormat",function(val){createDateFormat=val;});var periodFormat="";this.__defineGetter__("periodFormat",function(){if(thisClass.period!=null){var curr_date=thisClass.period.getDate();var curr_month=thisClass.period.getMonth()+1;var curr_year=thisClass.period.getFullYear();return curr_year+"-"+curr_month+"-"+curr_date;}else{return thisClass.period;}});this.__defineSetter__("periodFormat",function(val){periodFormat=val;});var statusMsg="Active";this.__defineGetter__("statusMsg",function(){if(thisClass.status=="active"){return"Active";}if(thisClass.status=="cancelled"){return"Cancelled";}if(thisClass.status=="expired"){return"Expired";}if(thisClass.status=="failed"){return"Failed";}if(thisClass.status=="invoiced"){return"Invoiced";}return thisClass.status;});this.__defineSetter__("statusMsg",function(val){statusMsg=val;});var statusColor="#000000";this.__defineGetter__("statusColor",function(){if(thisClass.status=="cancelled"){return"#ff0000";}if(thisClass.status=="failed"){return"#ff0000";}return"#000000";});this.__defineSetter__("statusColor",function(val){statusColor=val;});var showCancelBtn=true;this.__defineGetter__("showCancelBtn",function(){if(thisClass.status=="active"||thisClass.status=="failed"){return true;}else{return false;}});this.__defineSetter__("showCancelBtn",function(val){showCancelBtn=val;});var isPayPal=false;this.__defineGetter__("isPayPal",function(){if(thisClass.txnID.substring(0,2)=="S-"||thisClass.txnID.substring(0,2)=="s-"){return true;}return false;});this.__defineSetter__("isPayPal",function(val){isPayPal=val;});var isInvoice=false;this.__defineGetter__("isInvoice",function(){if(thisClass.txnID.substring(0,4)=="INV-"||thisClass.txnID.substring(0,4)=="inv-"||thisClass.txnID.substring(0,4)=="Inv-"){return true;}return false;});this.__defineSetter__("isInvoice",function(val){isInvoice=val;});var isFastSpring=false;this.__defineGetter__("isFastSpring",function(){var arr=thisClass.txnID.split("--__--");if(arr.length>=6){return true;}return false;});this.__defineSetter__("isFastSpring",function(val){isFastSpring=val;});var isMonthly=false;this.__defineGetter__("isMonthly",function(){var arr=thisClass.txnID.split("--__--");if(arr.length>=6){var str=arr[3];if(str=="monthly"){return true;}else{return false;}}return false;});this.__defineSetter__("isMonthly",function(val){isMonthly=val;});var subID="";this.__defineGetter__("subID",function(){var arr=thisClass.txnID.split("--__--");if(thisClass.isFastSpring){if(arr.length==6){return arr[4];}if(arr.length==7){return arr[5];}}else{return thisClass.txnID;}return thisClass.txnID;});this.__defineSetter__("subID",function(val){subID=val;});this.cast=function(obj){this.id=obj.id;this.clientid=obj.clientid;this.users=obj.users;this.edition=obj.edition;this.cost=obj.cost;this.txnID=obj.txnID;this.status=obj.status;this.period=obj.period;this.createDate=obj.createDate;};}function MF_LicenseUser(){var thisClass=this;this.clientid=null;this.id=null;this.email=null;this.createDate=null;this.canDowngrade=false;this.__defineGetter__("canDowngrade",function(){if(thisClass.email.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()){return false;}return true;});this.__defineSetter__("canDowngrade",function(val){thisClass.canDowngrade=val;});this.cast=function(obj){this.id=obj.id;this.clientid=obj.clientid;this.email=obj.email;this.createDate=obj.createDate;};}function MF_LogShared(){var thisClass=this;this.id=null;this.projectName=null;this.projectid=null;this.creator=null;this.createDate=null;this.creatorName=null;this.logtype=null;this.opened=false;this.pageid=null;this.receiver=null;var linkable=false;this.__defineGetter__("linkable",function(){if(thisClass.logtype=="ADD-MEMBER-EDITOR"||thisClass.logtype=="ADD-MEMBER-REVIEWER"||thisClass.logtype=="ADD-MEMBER-APPROVER"||thisClass.logtype=="RATING"||thisClass.logtype=="ADD-VARIATION"||thisClass.logtype=="DEL-VARIATION"||thisClass.logtype=="ENABLE-SHARE-MEMBER"||thisClass.logtype=="MEMBER-EDITOR"||thisClass.logtype=="MEMBER-REVIEWER"||thisClass.logtype=="MEMBER-APPROVER"||thisClass.logtype=="OWNER"||thisClass.logtype=="COMMENTED"||thisClass.logtype=="PROJECT-ARCHIVED"||thisClass.logtype=="PROJECT-UNARCHIVED"){return true;}return false;});this.__defineSetter__("linkable",function(val){linkable=val;});var logMessage="";this.__defineGetter__("logMessage",function(){var str=" ";var d=thisClass.createDate;if(d==null){d=new Date();}var curr_date=d.getDate();var curr_month=d.getMonth()+1;var curr_year=d.getFullYear();str=str+"<span class='mfNfUserName'>"+thisClass.creatorName+"</span>";if(thisClass.logtype!="NEW"){str=str+" has";}if(thisClass.logtype=="ADD-MEMBER-EDITOR"){str=str+" added you as Co-Editor to this project: '<span class='mfNfProjectName'>"+thisClass.projectName+"</span>' \n\n";}if(thisClass.logtype=="ADD-MEMBER-REVIEWER"){str=str+" added you as Reviewer to this project: '<span class='mfNfProjectName'>"+thisClass.projectName+"</span>' \n\n";}if(thisClass.logtype=="ADD-MEMBER-APPROVER"){str=str+" added you as Approver to this project: '<span class='mfNfProjectName'>"+thisClass.projectName+"</span>' \n\n";}if(thisClass.logtype=="ADD-MEMBER-ADMIN"){str=str+" added you as Administrator to this project: '<span class='mfNfProjectName'>"+thisClass.projectName+"</span>' \n\n";}if(thisClass.logtype=="ADD-MEMBER"){str=str+" added you as Team Member \n\n";}if(thisClass.logtype=="MEMBER-UPGRADE"){str=str+" upgraded your account to premium \n\n";}if(thisClass.logtype=="MEMBER-DOWNGRADE"){str=str+" downgraded your account to basic \n\n";}if(thisClass.logtype=="DEL-MEMBER"){str=str+" removed you from this project: '<span class='mfNfProjectName'>"+thisClass.projectName+"</span>' \n\n";}if(thisClass.logtype=="DISABLE-SHARE-MEMBER"){str=str+" disabled sharing with you for this project: '<span class='mfNfProjectName'>"+thisClass.projectName+"</span>' \n\n";}if(thisClass.logtype=="ENABLE-SHARE-MEMBER"){str=str+" re-enabled sharing with you for this project: '<span class='mfNfProjectName'>"+thisClass.projectName+"</span>' \n\n";}if(thisClass.logtype=="MEMBER-EDITOR"){str=str+" changed your role to 'Co-Editor' in this project: '<span class='mfNfProjectName'>"+thisClass.projectName+"</span>' \n\n";}if(thisClass.logtype=="MEMBER-REVIEWER"){str=str+" changed your role to 'Reviewer' in this project: '<span class='mfNfProjectName'>"+thisClass.projectName+"</span>' \n\n";}if(thisClass.logtype=="MEMBER-APPROVER"){str=str+" changed your role to 'Approver' in this project: '<span class='mfNfProjectName'>"+thisClass.projectName+"</span>' \n\n";}if(thisClass.logtype=="MEMBER-ADMIN"){str=str+" changed your role to 'Administrator' in this project: '<span class='mfNfProjectName'>"+thisClass.projectName+"</span>' \n\n";}if(thisClass.logtype=="COMMENTED"){str=str+" added a comment to this project: '<span class='mfNfProjectName'>"+thisClass.projectName+"</span>' \n\n";}if(thisClass.logtype=="RATING"){str=str+" rated this project: '<span class='mfNfProjectName'>"+thisClass.projectName+"</span>' \n\n";}if(thisClass.logtype=="ADD-VARIATION"){str=str+" added a new design variation to this project: '<span class='mfNfProjectName'>"+thisClass.projectName+"</span>' \n\n";}if(thisClass.logtype=="OWNER"){str=str+" sent a copy of this project: '<span class='mfNfProjectName'>"+thisClass.projectName+"</span>' \n\n";}if(thisClass.logtype=="CLONED"){str=str+" cloned a copy of this project: '<span class='mfNfProjectName'>"+thisClass.projectName+"</span>' \n\n";}if(thisClass.logtype=="APPROVED"){str=str+" approved Design in this project: '<span class='mfNfProjectName'>"+thisClass.projectName+"</span>' \n\n";}if(thisClass.logtype=="UNAPPROVED"){str=str+" removed the Approved Design in this project: '<span class='mfNfProjectName'>"+thisClass.projectName+"</span>' \n\n";}if(thisClass.logtype=="NEW"){str=str+" : Notifications from other users are displayed here \n\n";}if(thisClass.logtype=="ALTEREDLABEL"){str=str+" altered label in this project: '<span class='mfNfProjectName'>"+thisClass.projectName+"</span>' \n\n";}if(thisClass.logtype=="PROJECT-ARCHIVED"){str=str+" archived the project: '<span class='mfNfProjectName'>"+thisClass.projectName+"</span>' \n\n";}if(thisClass.logtype=="PROJECT-UNARCHIVED"){str=str+" unarchived the project: '<span class='mfNfProjectName'>"+thisClass.projectName+"</span>' \n\n";}str=str+"<span class='mfNotificationDate'>"+curr_date+" "+MF_Utils.getMonthByName(d.getMonth())+" "+curr_year+"</span>";return str;});this.__defineSetter__("logMessage",function(val){logMessage=val;});var profileImage="";this.__defineGetter__("profileImage",function(){var cr=thisClass.creator;if(cr=="mockflow@produle.com"){cr="dummymf";}var str=MF_Utils.get_gravatar(cr,30);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});this.cast=function(obj){this.id=obj.id;this.projectName=obj.projectName;this.projectid=obj.projectid;this.creator=obj.creator;this.createDate=obj.createDate;this.creatorName=obj.creatorName;this.logtype=obj.logtype;this.opened=obj.opened;this.receiver=obj.receiver;this.pageid=obj.pageid;};}function MF_Variation(){var thisClass=this;this.id=null;this.varid=0;this.name=null;this.type=null;this.creator=null;this.createDate=null;this.width=0;this.height=0;this.projectid=null;this.clientid=null;this.description=null;this.comments=0;this.rating=0;this.ratingCount=0;this.approved=false;var thumbnailURL="";this.__defineGetter__("thumbnailURL",function(){return MF_Global.getS3URL()+"app/designcollab/company/"+thisClass.clientid+"/projects/"+thisClass.projectid+"/variations/thumbnails/"+thisClass.id;});this.__defineSetter__("thumbnailURL",function(val){thumbnailURL=val;});var imageURL="";this.__defineGetter__("imageURL",function(){return MF_Global.getS3URL()+"app/designcollab/company/"+thisClass.clientid+"/projects/"+thisClass.projectid+"/variations/"+thisClass.id;});this.__defineSetter__("imageURL",function(val){imageURL=val;});this.cast=function(obj){this.id=obj.id;this.varid=obj.varid;this.name=obj.name;this.type=obj.type;this.creator=obj.creator;this.createDate=obj.createDate;this.width=obj.width;this.height=obj.height;this.projectid=obj.projectid;this.clientid=obj.clientid;this.description=obj.description;this.comments=obj.comments;this.rating=obj.rating;this.ratingCount=obj.ratingCount;};}function MF_Rating(){var thisClass=this;this.id=null;this.varid=null;this.creator=null;this.createDate=null;this.projectid=null;this.clientid=null;this.rating=0;var profileImage="";this.__defineGetter__("profileImage",function(){var str=MF_Utils.get_gravatar(thisClass.creator,20);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});var showDelete=false;this.__defineGetter__("showDelete",function(){if(mf_main.PERMISSION=="Owner"||mf_main.PERMISSION=="Admin"){return true;}if(mf_main.PERMISSION=="Editor"||mf_main.PERMISSION=="Reviewer"||mf_main.PERMISSION=="Approver"){if(thisClass.creator.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()){return true;}}return false;});this.__defineSetter__("showDelete",function(val){showDelete=val;});var creatorStr="";this.__defineGetter__("creatorStr",function(){if(thisClass.creator==MF_UserSession.getUser().username){return"Me";}return thisClass.creator;});this.__defineSetter__("creatorStr",function(val){creatorStr=val;});this.cast=function(obj){this.id=obj.id;this.varid=obj.varid;this.creator=obj.creator;this.createDate=obj.createDate;this.projectid=obj.projectid;this.clientid=obj.clientid;this.rating=obj.rating;};}function MF_Log(){var thisClass=this;this.id=null;this.projectid=null;this.clientid=null;this.log=null;this.creator=null;this.createDate=null;this.creatorName=null;this.logtype=null;var logMessage="";this.__defineGetter__("logMessage",function(){var str=" ";var d=thisClass.createDate;if(d==null){d=new Date();}var curr_date=d.getDate();var curr_month=d.getMonth()+1;var curr_year=d.getFullYear();str=str+"["+curr_date+"-"+curr_month+"-"+curr_year+"] - ";if(MF_UserSession.getUser()&&thisClass.creator.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()){str=str+"You have";}else{str=str+thisClass.creatorName+" has";}str=str+" "+thisClass.log+" \n\n";return str;});this.__defineSetter__("logMessage",function(val){logMessage=val;});var logIcon="";this.__defineGetter__("logIcon",function(){var str="images/logicons/update.png";if(thisClass.logtype=="ADD-MEMBER-EDITOR"||thisClass.logtype=="ADD-MEMBER-REVIEWER"||thisClass.logtype=="ADD-MEMBER-APPROVER"||thisClass.logtype=="ADD-MEMBER-ADMIN"||thisClass.logtype=="ADD-MEMBER"){str="images/logicons/add_member.png";}if(thisClass.logtype=="DEL-MEMBER"){str="images/logicons/delete_member.png";}if(thisClass.logtype=="MEMBER-EDITOR"||thisClass.logtype=="MEMBER-REVIEWER"||thisClass.logtype=="MEMBER-APPROVER"||thisClass.logtype=="MEMBER-ADMIN"){str="images/logicons/membertype.png";}if(thisClass.logtype=="RENAMED"){str="images/logicons/rename_project.png";}if(thisClass.logtype=="COMMENTED"){str="images/logicons/comment.png";}if(thisClass.logtype=="RATING"){str="images/logicons/rating.png";}if(thisClass.logtype=="ADD-VARIATION"){str="images/logicons/addvariation.png";}if(thisClass.logtype=="DEL-VARIATION"){str="images/logicons/delvariation.png";}if(thisClass.logtype=="REVERT-REVISION"){str="images/logicons/revert_revision.png";}if(thisClass.logtype=="DEL-PAGE"){str="images/logicons/delete_page.png";}return str;});this.__defineSetter__("logIcon",function(val){logIcon=val;});this.cast=function(obj){this.id=obj.id;this.projectid=obj.projectid;this.clientid=obj.clientid;this.log=obj.log;this.creator=obj.creator;this.createDate=obj.createDate;this.creatorName=obj.creatorName;this.logtype=obj.logtype;};}function MF_UserInactive(){var thisClass=this;this.firstName=null;this.lastName=null;this.username=null;this.password=null;this.companyName=null;this.activateKey=null;this.expiry=null;this.createDate=null;}function MF_Company(){var thisClass=this;this.companyid=null;this.pid=null;this.dbserver=null;this.edition=null;this.createDate=null;this.creator=null;this.status=null;this.storage=null;this.plimit=1;}function MF_DashboardData(){var thisClass=this;this.logshared=null;this.labels=null;this.projects=null;this.ownedProjectsCount=0;this.sharedProjectsCount=0;this.totalProjectsCount=0;this.publicProjectsCount=0;this.trashProjectsCount=0;this.approvedProjectsCount=0;this.awaitingApprovalProjectsCount=0;this.sentForApprovalProjectsCount=0;this.readonlyProjectsCount=0;}function MF_ProjectLabel(){var thisClass=this;this.id=null;this.name=null;this.color=null;this.createDate=null;this.clientid=null;this.projects=null;this.defaultLabel=false;this.count=0;this.approvallabel=false;var labelIconVisible="";this.__defineGetter__("labelIconVisible",function(){if(thisClass.id=="gap"||thisClass.id=="gap2"){return false;}return true;});this.__defineSetter__("labelIconVisible",function(val){labelIconVisible=val;});var labelIconColor="";this.__defineGetter__("labelIconColor",function(){if(thisClass.approvallabel){if(thisClass.id=="awaitapproval"){return"#e67e22";}if(thisClass.id=="sentapproval"){return"#3498db";}if(thisClass.id=="approved"){return"#2ecc71";}}return"#666";});this.__defineSetter__("labelIconColor",function(val){labelIconColor=val;});var labelIconOpacity="";this.__defineGetter__("labelIconOpacity",function(){if(thisClass.id=="gap"||thisClass.id=="gap2"){return"";}if(thisClass.id=="awaitapproval"){return 1;}if(thisClass.id=="sentapproval"){return 1;}if(thisClass.id=="approved"){return 1;}return 0.5;});this.__defineSetter__("labelIconOpacity",function(val){labelIconOpacity=val;});var labelIcon="";this.__defineGetter__("labelIcon",function(){if(thisClass.id=="all"){return"mficon-document";}if(thisClass.id=="owner"){return"mficon-cloud";}if(thisClass.id=="shared"){return"mficon-group";}if(thisClass.id=="public"){return"mficon-globe";}if(thisClass.id=="trash"){return"mficon-trash2";}if(thisClass.id=="readonly"){return"mficon-box";}if(thisClass.id=="gap"||thisClass.id=="gap2"){return"";}if(thisClass.id=="awaitapproval"){return"mficon-inbox";}if(thisClass.id=="sentapproval"){return"mficon-paper-plane";}if(thisClass.id=="approved"){return"mficon-check";}return"mficon-ellipse";});this.__defineSetter__("labelIcon",function(val){labelIcon=val;});this.cast=function(obj){this.id=obj.id;this.name=obj.name;this.color=obj.color;this.createDate=obj.createDate;this.clientid=obj.clientid;this.projects=obj.projects;};}function MF_TeamMember(){var thisClass=this;this.id=null;this.userid=null;this.license=null;this.type=null;var profileImage="";this.__defineGetter__("profileImage",function(){var cr=thisClass.userid;if(cr=="mockflow@produle.com"){cr="dummymf";}var str=MF_Utils.get_gravatar(cr,48);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});this.cast=function(obj){this.userid=obj.userid;this.license=obj.license;this.type=obj.type;this.id=obj.id;};}function MF_Collaborator(){var thisClass=this;this.id=null;this.projectid=null;this.userid=null;this.type=null;this.online=false;this.sharePerm=null;var profileImage="";this.__defineGetter__("profileImage",function(){var str=MF_Utils.get_gravatar(thisClass.userid,64);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});var memberType="";this.__defineGetter__("memberType",function(){if(thisClass.type=="Admin"){return"Admin";}if(thisClass.type=="Editor"){return"Designer";}if(thisClass.type=="Reviewer"){return"Reviewer";}if(thisClass.type=="Approver"){return"Approver";}return"Owner";});this.__defineSetter__("memberType",function(val){memberType=val;});this.cast=function(obj){this.id=obj.id;this.projectid=obj.projectid;this.userid=obj.userid;this.type=obj.type;this.online=obj.online;this.sharePerm=obj.sharePerm;};}function MF_User(){var thisClass=this;this.firstName="dd";this.lastName="cc";this.createDate=null;this.username="";this.password="";this.company="";this.type="";this.companyName="";this.pid="";this.lastLogin=null;this.tokenKey="";this.projectsLeft=0;this.isBasic=true;this.accountType="";this.teamEditor=false;this.teamPremium=false;this.teamLicenseOwner="";this.plusEdition=null;this.isTrial=false;this.hadTrial=false;var createDateStr="";this.__defineGetter__("createDateStr",function(){if(thisClass.createDate!=null){var curr_date=thisClass.createDate.getDate();var curr_month=thisClass.createDate.getMonth()+1;var curr_year=thisClass.createDate.getFullYear();return curr_date+" "+MF_Utils.getMonthByName(thisClass.createDate.getMonth())+" "+curr_year;}else{return thisClass.createDate;}});this.__defineSetter__("createDateStr",function(val){createDateStr=val;});var isNewLicense=false;this.__defineGetter__("isNewLicense",function(){if(thisClass.createDate!=null){var changeLicenseDate=new Date(2018,3,22);if(thisClass.createDate>changeLicenseDate){return true;}}return isNewLicense;});this.__defineSetter__("isNewLicense",function(val){});var profileImage="";this.__defineGetter__("profileImage",function(){var str=MF_Utils.get_gravatar(thisClass.username,48);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});}var MF_UserSession=(function(){var user=new MF_User();function privateMethod(){}return{getUser:function(){return user;},createAllowedAlertMsg:function(){var msg="Your Basic MockFlow account allows only 1 project, Upgrade now?";if(MF_UserSession.getUser()){if(MF_UserSession.getUser().isBasic){if(MF_UserSession.getUser().hadTrial){msg="Your Trial Period has expired. Upgrade account for continued access";}}}return msg;},IsOpenAllowed:function(){if(MF_UserSession.getUser()){if(MF_UserSession.getUser().isBasic){if(MF_UserSession.getUser().hadTrial){return false;}if(mf_main.dashboardController.projectController.projectCollection){var count=0;for(var i=0;i<mf_main.dashboardController.projectController.projectCollection.size();i++){var mock=mf_main.dashboardController.projectController.projectCollection.getItemAt(i);if(mock.company==MF_UserSession.getUser().company){count++;}if(count>1){return false;}}return true;}}else{return true;}}return false;},createAllowed:function(){if(MF_UserSession.getUser()){if(MF_UserSession.getUser().isBasic){if(MF_UserSession.getUser().hadTrial){return false;}if(mf_main.dashboardController.projectController.projectCollection){var count=0;for(var i=0;i<mf_main.dashboardController.projectController.projectCollection.size();i++){var mock=mf_main.dashboardController.projectController.projectCollection.getItemAt(i);if(mock.company==MF_UserSession.getUser().company){count++;}if(count>=1){return false;}}return true;}}else{return true;}}return false;}};})();var MF_Permission=(function(){function privateMethod(){}return{deny:function(projectObj,permission){if(mf_main.PUBLIC){return true;}if(projectObj&&projectObj.checkPermission&&projectObj.sharePerm){if(projectObj.permissionType=="Admin"){return false;}if(permission=="canViewLog"){if(!projectObj.sharePerm.canViewLog){return true;}}if(permission=="canViewMembers"){if(!projectObj.sharePerm.canViewMembers){return true;}}if(permission=="canUploadImage"){if(projectObj.permissionType=="Reviewer"){return true;}if(!projectObj.sharePerm.canUploadImage){return true;}}if(permission=="canDeleteImage"){if(projectObj.permissionType=="Reviewer"){return true;}if(!projectObj.sharePerm.canDeleteImage){return true;}}if(permission=="canRateDesign"){if(projectObj.permissionType=="Reviewer"){return true;}if(!projectObj.sharePerm.canRateDesign){return true;}}if(permission=="canCreateBoard"){if(projectObj.permissionType=="Reviewer"){return true;}if(!projectObj.sharePerm.canCreateBoard){return true;}}if(permission=="canEditBoard"){if(projectObj.permissionType=="Reviewer"){return true;}if(!projectObj.sharePerm.canEditBoard){return true;}}if(permission=="canDeleteBoard"){if(projectObj.permissionType=="Reviewer"){return true;}if(!projectObj.sharePerm.canDeleteBoard){return true;}}}return false;}};})();function MF_DashboardRTCNotificationItem(){var thisClass=this;this.collabarators=new Array();this.messageStr=null;this.sender=MF_UserSession.getUser().firstName+" "+MF_UserSession.getUser().lastName;this.receiver=null;var profileImage="";this.__defineGetter__("profileImage",function(){var str=MF_Utils.get_gravatar(MF_UserSession.getUser().username,32);return str;});this.__defineSetter__("profileImage",function(val){profileImage=val;});this.cast=function(obj){thisClass.collabarators=obj.collabarators;thisClass.messageStr=obj.messageStr;thisClass.receiver=obj.receiver;};}function MF_LogController(){var thisClass=this;this.constructor=function(){};this.downgradeTeamMember=function(memberid){var log=new MF_Log();log.creator=MF_UserSession.getUser().username;log.creatorName=MF_UserSession.getUser().firstName;log.id=MF_Utils.guidGenerator();log.log="upgraded account to premium: "+memberid;log.logtype="MEMBER-UPGRADE";log.projectid="";var logshared=new MF_LogShared();logshared.creator=MF_UserSession.getUser().username;logshared.creatorName=MF_UserSession.getUser().firstName;logshared.id=MF_Utils.guidGenerator();logshared.projectName="";logshared.projectid="";logshared.logtype=log.logtype;logshared.receiver=memberid;MF_LogManager.add(MF_UserSession.getUser().company,log,logshared,{callback:function(){}});};this.upgradeTeamMember=function(memberid){var log=new MF_Log();log.creator=MF_UserSession.getUser().username;log.creatorName=MF_UserSession.getUser().firstName;log.id=MF_Utils.guidGenerator();log.log="downgraded account to basic: "+memberid;log.logtype="MEMBER-DOWNGRADE";log.projectid="";var logshared=new MF_LogShared();logshared.creator=MF_UserSession.getUser().username;logshared.creatorName=MF_UserSession.getUser().firstName;logshared.id=MF_Utils.guidGenerator();logshared.projectName="";logshared.projectid="";logshared.logtype=log.logtype;logshared.receiver=memberid;MF_LogManager.add(MF_UserSession.getUser().company,log,logshared,{callback:function(){}});};this.logMemberType=function(memberid,type,projectid,projectName){var log=new MF_Log();log.creator=MF_UserSession.getUser().username;log.creatorName=MF_UserSession.getUser().firstName;log.id=MF_Utils.guidGenerator();log.log="changed the role of "+memberid;if(type=="Editor"){log.log=log.log+" to Co-Editor";log.logtype="MEMBER-EDITOR";}else{if(type=="Admin"){log.log=log.log+" to Admin";log.logtype="MEMBER-ADMIN";}else{if(type=="Approver"){log.log=log.log+" to Approver";log.logtype="MEMBER-APPROVER";}else{log.log=log.log+" to Reviewer";log.logtype="MEMBER-REVIEWER";}}}log.projectid=projectid;var logshared=new MF_LogShared();logshared.creator=MF_UserSession.getUser().username;logshared.creatorName=MF_UserSession.getUser().firstName;logshared.id=MF_Utils.guidGenerator();logshared.projectName=projectName;logshared.projectid=projectid;logshared.logtype=log.logtype;logshared.receiver=memberid;MF_LogManager.add(MF_UserSession.getUser().company,log,logshared,{callback:function(){}});};this.logNewMember=function(memberid,type,projectid,projectName){var log=new MF_Log();log.creator=MF_UserSession.getUser().username;log.creatorName=MF_UserSession.getUser().firstName;log.id=MF_Utils.guidGenerator();log.log="shared this project with "+memberid;if(type=="Editor"){log.log=log.log+" (as Co-Editor)";log.logtype="ADD-MEMBER-EDITOR";}else{if(type=="Admin"){log.log=log.log+" (as Admin)";log.logtype="ADD-MEMBER-ADMIN";}else{if(type=="Approver"){log.log=log.log+" (as Approver)";log.logtype="ADD-MEMBER-Approver";}else{log.log=log.log+" (as Reviewer)";log.logtype="ADD-MEMBER-REVIEWER";}}}log.projectid=projectid;var logshared=new MF_LogShared();logshared.creator=MF_UserSession.getUser().username;logshared.creatorName=MF_UserSession.getUser().firstName;logshared.id=MF_Utils.guidGenerator();logshared.projectName=projectName;logshared.projectid=projectid;logshared.logtype=log.logtype;logshared.receiver=memberid;MF_LogManager.add(MF_UserSession.getUser().company,log,logshared,{callback:function(){}});};this.logDelMember=function(memberid,projectid,projectName){var log=new MF_Log();log.creator=MF_UserSession.getUser().username;log.creatorName=MF_UserSession.getUser().firstName;log.id=MF_Utils.guidGenerator();log.log="removed "+memberid+" from this project";log.logtype="DEL-MEMBER";log.projectid=projectid;var logshared=new MF_LogShared();logshared.creator=MF_UserSession.getUser().username;logshared.creatorName=MF_UserSession.getUser().firstName;logshared.id=MF_Utils.guidGenerator();logshared.projectName=projectName;logshared.projectid=projectid;logshared.logtype=log.logtype;logshared.receiver=memberid;MF_LogManager.add(MF_UserSession.getUser().company,log,logshared,{callback:function(){}});};this.logRename=function(oldname,project){var log=new MF_Log();log.creator=MF_UserSession.getUser().username;log.creatorName=MF_UserSession.getUser().firstName;log.id=MF_Utils.guidGenerator();log.log="renamed this project from '"+oldname+"'";log.logtype="RENAMED";log.projectid=project.id;MF_LogManager.add(MF_UserSession.getUser().company,log,null,{callback:function(){}});};this.logDelVariation=function(project,varid){var log=new MF_Log();log.creator=MF_UserSession.getUser().username;log.creatorName=MF_UserSession.getUser().firstName;log.id=MF_Utils.guidGenerator();log.log="deleted this design variation '"+varid+"'";log.logtype="DEL-VARIATION";log.projectid=project.id;MF_LogManager.add(project.company,log,null,{callback:function(){}});};}var MF_Utils=(function(){var user=new MF_User();function privateMethod(){}return{getUser:function(){return user;},guidGenerator:function(){var S4=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1);};return"M"+(S4()+S4()+S4()+S4()+S4()+S4()+S4()+S4())+Date.now();},resolveUrls:function(feedbackMsg){var resolvedMsg=feedbackMsg;var urlPattern=/\b(https?:\/\/)?[a-zA-Z0-9\/\-:]+(\.[a-z0-9-+&@#\/%?=~_|!:,;]+)+/gi;var protocolList=/^((https?):\/\/)/i;var linkTemplate="<a href='{0}' target='_blank'>{0}</a>";var urlList=urlPattern.exec(feedbackMsg),currentUrl="";while(urlList!==null){currentUrl=urlList[0];if(!protocolList.test(currentUrl)){currentUrl="http://"+currentUrl;}resolvedMsg=resolvedMsg.replace(urlList[0],linkTemplate.replace("{0}",currentUrl).replace("{0}",urlList[0]));urlList=urlPattern.exec(feedbackMsg);}return resolvedMsg;},trim:function(s){var l=0;var r=s.length-1;while(l<s.length&&s[l]==" "){l++;}while(r>l&&s[r]==" "){r-=1;}return s.substring(l,r+1);},sortList:function(a,b){return(a.sortDate>b.sortDate)?1:((b.sortDate>a.sortDate)?-1:0);},getCheckBoxValue:function(chkID){if($("#"+chkID).is(":checked")){return true;}else{return false;}},localToGlobal:function(_el){var target=_el,target_width=target.offsetWidth,target_height=target.offsetHeight,target_left=target.offsetLeft,target_top=target.offsetTop,gleft=0,gtop=0,rect={};var moonwalk=function(_parent){if(!!_parent){gleft+=_parent.offsetLeft;gtop+=_parent.offsetTop;moonwalk(_parent.offsetParent);}else{return rect={top:target.offsetTop+gtop,left:target.offsetLeft+gleft,bottom:(target.offsetTop+gtop)+target_height,right:(target.offsetLeft+gleft)+target_width};}};moonwalk(target.offsetParent);return rect;},globalToLocalPoint:function(e,elementid){if($("#"+elementid).length){var localoffsetX=$("#"+elementid).offset().left;var localoffsetY=$("#"+elementid).offset().top;var localx=Math.floor(e.pageX-localoffsetX);var localy=Math.floor(e.pageY-localoffsetY);var lpt=new Object();lpt.x=localx;lpt.y=localy;return lpt;}else{var lpt=new Object();lpt.x=0;lpt.y=0;return lpt;}},globalToLocalPoint2:function(x,y,elementid){if($("#"+elementid).length){var localoffsetX=$("#"+elementid).offset().left;var localoffsetY=$("#"+elementid).offset().top;var localx=Math.floor(x-localoffsetX);var localy=Math.floor(y-localoffsetY);var lpt=new Object();lpt.x=localx;lpt.y=localy;return lpt;}else{var lpt=new Object();lpt.x=0;lpt.y=0;return lpt;}},localToGlobalPoint:function(xpt,ypt,elementid){if($("#"+elementid).length){var localoffsetX=$("#"+elementid).offset().left;var localoffsetY=$("#"+elementid).offset().top;var localx=Math.floor(xpt+localoffsetX);var localy=Math.floor(ypt+localoffsetY);var lpt=new Object();lpt.x=localx;lpt.y=localy;return lpt;}else{var lpt=new Object();lpt.x=0;lpt.y=0;return lpt;}},getMonthByName:function(num){var m_names=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");return m_names[num];},isValidEmailAddress:function(emailAddress){var pattern2=new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);return pattern2.test(emailAddress);},findPos:function(obj){var curleft=curtop=0;if(obj.offsetParent){curleft=obj.offsetLeft;curtop=obj.offsetTop;while(obj=obj.offsetParent){curleft+=obj.offsetLeft;curtop+=obj.offsetTop;}}return[curleft,curtop];},display_ActionIndicator:function(msg){$("#mfActionIndicator").css({position:"absolute",top:0,left:(($(window).width()/2)-($("#mfActionIndicator").width()/2))});$("#mfActionIndicatorMessage").text(msg);$("#mfActionIndicator").fadeTo("fast",1.5);setTimeout(function(){$("#mfActionIndicator").css("display","none");},2000);return;},display_menu:function(parent,named,e){var menu_element=document.getElementById(named);menu_element.style.display="";menu_element.style.left=e.pageX+"px";menu_element.style.top=e.pageY+"px";if((e.pageY+10+$("#"+named).height())>$(window).height()){menu_element.style.top=(e.pageY-$("#"+named).height())+"px";}return;},hide_menu:function(named){var menu_element=document.getElementById(named);if(menu_element){menu_element.style.display="none";}return;},roundedRect2:function(ctx,x,y,w,h,cornerRadius){cornerRadius=cornerRadius/2;ctx.beginPath();var theta,angle,cx,cy,px,py;if(cornerRadius>Math.min(w,h)/2){cornerRadius=Math.min(w,h)/2;}theta=Math.PI/4;ctx.moveTo(x+cornerRadius,y);ctx.lineTo(x+w-cornerRadius,y);angle=-Math.PI/2;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);ctx.lineTo(x+w,y+h-cornerRadius);angle+=theta;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+w-cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+w-cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);ctx.lineTo(x+cornerRadius,y+h);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+h-cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+h-cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);ctx.lineTo(x,y+cornerRadius);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);angle+=theta;cx=x+cornerRadius+(Math.cos(angle+(theta/2))*cornerRadius/Math.cos(theta/2));cy=y+cornerRadius+(Math.sin(angle+(theta/2))*cornerRadius/Math.cos(theta/2));px=x+cornerRadius+(Math.cos(angle+theta)*cornerRadius);py=y+cornerRadius+(Math.sin(angle+theta)*cornerRadius);ctx.quadraticCurveTo(cx,cy,px,py);ctx.stroke();return;},roundedRect:function(ctx,x,y,width,height,radius){ctx.beginPath();ctx.moveTo(x,y+radius);ctx.lineTo(x,y+height-radius);ctx.quadraticCurveTo(x,y+height,x+radius,y+height);ctx.lineTo(x+width-radius,y+height);ctx.quadraticCurveTo(x+width,y+height,x+width,y+height-radius);ctx.lineTo(x+width,y+radius);ctx.quadraticCurveTo(x+width,y,x+width-radius,y);ctx.lineTo(x+radius,y);ctx.quadraticCurveTo(x,y,x,y+radius);ctx.stroke();return;},hexToRGB:function(hex,alpha){alpha=typeof(alpha)!="undefined"?alpha:"1";var rgbObj={red:((hex&16711680)>>16),green:((hex&65280)>>8),blue:((hex&255))};return"rgba("+rgbObj.red+","+rgbObj.green+","+rgbObj.blue+","+alpha+")";},randomInRange:function(min,max){var scale=max-min;return Math.floor(Math.random()*scale+min);},get_gravatar:function(email,size){var userName=MF_Utils.getMD5(email);var size=size||80;var profileImgUrl="https://mockflow.com/userProfileImage.jsp?userName="+userName+"&imageSize="+size;return profileImgUrl;},getMD5:function(data){var MD5=function(s){function L(k,d){return(k<<d)|(k>>>(32-d));}function K(G,k){var I,d,F,H,x;F=(G&2147483648);H=(k&2147483648);I=(G&1073741824);d=(k&1073741824);x=(G&1073741823)+(k&1073741823);if(I&d){return(x^2147483648^F^H);}if(I|d){if(x&1073741824){return(x^3221225472^F^H);}else{return(x^1073741824^F^H);}}else{return(x^F^H);}}function r(d,F,k){return(d&F)|((~d)&k);}function q(d,F,k){return(d&k)|(F&(~k));}function p(d,F,k){return(d^F^k);}function n(d,F,k){return(F^(d|(~k)));}function u(G,F,aa,Z,k,H,I){G=K(G,K(K(r(F,aa,Z),k),I));return K(L(G,H),F);}function f(G,F,aa,Z,k,H,I){G=K(G,K(K(q(F,aa,Z),k),I));return K(L(G,H),F);}function D(G,F,aa,Z,k,H,I){G=K(G,K(K(p(F,aa,Z),k),I));return K(L(G,H),F);}function t(G,F,aa,Z,k,H,I){G=K(G,K(K(n(F,aa,Z),k),I));return K(L(G,H),F);}function e(G){var Z;var F=G.length;var x=F+8;var k=(x-(x%64))/64;var I=(k+1)*16;var aa=Array(I-1);var d=0;var H=0;while(H<F){Z=(H-(H%4))/4;d=(H%4)*8;aa[Z]=(aa[Z]|(G.charCodeAt(H)<<d));H++;}Z=(H-(H%4))/4;d=(H%4)*8;aa[Z]=aa[Z]|(128<<d);aa[I-2]=F<<3;aa[I-1]=F>>>29;return aa;}function B(x){var k="",F="",G,d;for(d=0;d<=3;d++){G=(x>>>(d*8))&255;F="0"+G.toString(16);k=k+F.substr(F.length-2,2);}return k;}function J(k){k=k.replace(/rn/g,"n");var d="";for(var F=0;F<k.length;F++){var x=k.charCodeAt(F);if(x<128){d+=String.fromCharCode(x);}else{if((x>127)&&(x<2048)){d+=String.fromCharCode((x>>6)|192);d+=String.fromCharCode((x&63)|128);}else{d+=String.fromCharCode((x>>12)|224);d+=String.fromCharCode(((x>>6)&63)|128);d+=String.fromCharCode((x&63)|128);}}}return d;}var C=Array();var P,h,E,v,g,Y,X,W,V;var S=7,Q=12,N=17,M=22;var A=5,z=9,y=14,w=20;var o=4,m=11,l=16,j=23;var U=6,T=10,R=15,O=21;s=J(s);C=e(s);Y=1732584193;X=4023233417;W=2562383102;V=271733878;for(P=0;P<C.length;P+=16){h=Y;E=X;v=W;g=V;Y=u(Y,X,W,V,C[P+0],S,3614090360);V=u(V,Y,X,W,C[P+1],Q,3905402710);W=u(W,V,Y,X,C[P+2],N,606105819);X=u(X,W,V,Y,C[P+3],M,3250441966);Y=u(Y,X,W,V,C[P+4],S,4118548399);V=u(V,Y,X,W,C[P+5],Q,1200080426);W=u(W,V,Y,X,C[P+6],N,2821735955);X=u(X,W,V,Y,C[P+7],M,4249261313);Y=u(Y,X,W,V,C[P+8],S,1770035416);V=u(V,Y,X,W,C[P+9],Q,2336552879);W=u(W,V,Y,X,C[P+10],N,4294925233);X=u(X,W,V,Y,C[P+11],M,2304563134);Y=u(Y,X,W,V,C[P+12],S,1804603682);V=u(V,Y,X,W,C[P+13],Q,4254626195);W=u(W,V,Y,X,C[P+14],N,2792965006);X=u(X,W,V,Y,C[P+15],M,1236535329);Y=f(Y,X,W,V,C[P+1],A,4129170786);V=f(V,Y,X,W,C[P+6],z,3225465664);W=f(W,V,Y,X,C[P+11],y,643717713);X=f(X,W,V,Y,C[P+0],w,3921069994);Y=f(Y,X,W,V,C[P+5],A,3593408605);V=f(V,Y,X,W,C[P+10],z,38016083);W=f(W,V,Y,X,C[P+15],y,3634488961);X=f(X,W,V,Y,C[P+4],w,3889429448);Y=f(Y,X,W,V,C[P+9],A,568446438);V=f(V,Y,X,W,C[P+14],z,3275163606);W=f(W,V,Y,X,C[P+3],y,4107603335);X=f(X,W,V,Y,C[P+8],w,1163531501);Y=f(Y,X,W,V,C[P+13],A,2850285829);V=f(V,Y,X,W,C[P+2],z,4243563512);W=f(W,V,Y,X,C[P+7],y,1735328473);X=f(X,W,V,Y,C[P+12],w,2368359562);Y=D(Y,X,W,V,C[P+5],o,4294588738);V=D(V,Y,X,W,C[P+8],m,2272392833);W=D(W,V,Y,X,C[P+11],l,1839030562);X=D(X,W,V,Y,C[P+14],j,4259657740);Y=D(Y,X,W,V,C[P+1],o,2763975236);V=D(V,Y,X,W,C[P+4],m,1272893353);W=D(W,V,Y,X,C[P+7],l,4139469664);X=D(X,W,V,Y,C[P+10],j,3200236656);Y=D(Y,X,W,V,C[P+13],o,681279174);V=D(V,Y,X,W,C[P+0],m,3936430074);W=D(W,V,Y,X,C[P+3],l,3572445317);X=D(X,W,V,Y,C[P+6],j,76029189);Y=D(Y,X,W,V,C[P+9],o,3654602809);V=D(V,Y,X,W,C[P+12],m,3873151461);W=D(W,V,Y,X,C[P+15],l,530742520);X=D(X,W,V,Y,C[P+2],j,3299628645);Y=t(Y,X,W,V,C[P+0],U,4096336452);V=t(V,Y,X,W,C[P+7],T,1126891415);W=t(W,V,Y,X,C[P+14],R,2878612391);X=t(X,W,V,Y,C[P+5],O,4237533241);Y=t(Y,X,W,V,C[P+12],U,1700485571);V=t(V,Y,X,W,C[P+3],T,2399980690);W=t(W,V,Y,X,C[P+10],R,4293915773);X=t(X,W,V,Y,C[P+1],O,2240044497);Y=t(Y,X,W,V,C[P+8],U,1873313359);V=t(V,Y,X,W,C[P+15],T,4264355552);W=t(W,V,Y,X,C[P+6],R,2734768916);X=t(X,W,V,Y,C[P+13],O,1309151649);Y=t(Y,X,W,V,C[P+4],U,4149444226);V=t(V,Y,X,W,C[P+11],T,3174756917);W=t(W,V,Y,X,C[P+2],R,718787259);X=t(X,W,V,Y,C[P+9],O,3951481745);Y=K(Y,h);X=K(X,E);W=K(W,v);V=K(V,g);}var i=B(Y)+B(X)+B(W)+B(V);return i.toLowerCase();};var hashVal=MD5(data);return hashVal;},copyToClipBoard:function(elementToCopy){elementToCopy.focus();elementToCopy.select();var returnState=false;try{if(document.execCommand("copy")){returnState=true;MF_Utils.display_ActionIndicator("Copied to clipboard");}}catch(errorMessage){console.log("HTML5 Copy to Clipboard is not supported in your browser");returnState=false;}return returnState;},changeHash:function(hashVal){history.pushState("",document.title,window.location.pathname+window.location.search+hashVal);},getDashboardRTCCollabrators:function(sharedUser){if(mf_main.dashboardController.projectController.selectedProject!=null){var collabarators=[];var userIndex=-1;for(var i=0;i<mf_main.dashboardController.projectController.selectedProject.collaborators.length;i++){if(sharedUser&&sharedUser.toLowerCase()==mf_main.dashboardController.projectController.selectedProject.collaborators[i].userid.toLowerCase()){continue;}collabarators.push(mf_main.dashboardController.projectController.selectedProject.collaborators[i].userid);}collabarators.push(mf_main.dashboardController.projectController.selectedProject.creator);return collabarators;}}};})();function MF_DashboardRTCController(){var thisClass=this;this.sessionID=null;this.socket=null;this.disconnect=function(){if(thisClass.socket){thisClass.socket.disconnect();}};this.connect=function(){if(mf_main.RENDER){return;}if(MF_Global.getS3Bucket()=="testmfassets"){thisClass.socket=io.connect("http://localhost:8002");}else{thisClass.socket=io.connect("https://designcollab.mockflow.com:8002");}thisClass.socket.on("connect",function(){thisClass.sessionID=MF_Utils.guidGenerator();thisClass.socket.emit("adduser",{sessionid:thisClass.sessionID,username:MF_UserSession.getUser().username});});thisClass.socket.on("updatemsg",function(username,data){if(data){var senderUsername=username;var cachedTemplate=mf_main.getTemplateFromCache("mfDashboardRTCTemplate");var senderName=MF_UserSession.getUser().firstName+" "+MF_UserSession.getUser().lastName;if(senderName==data.sender){data.sender="You";data.message=data.message.replace("has","have");}if(data.cmd=="project_share"){MF_LogSharedManager.list(MF_UserSession.getUser(),{callback:function(logData){mf_main.dashboardController.alertController.logSharedCollection=new ArrayCollection();mf_main.dashboardController.alertController.applyAlertTemplate(logData);}});if(cachedTemplate==null){$.get("templates/dashboard/DashboardRTCNotificationItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfDashboardRTCTemplate").html());mf_main.addTemplateToCache("mfDashboardRTCTemplate",template);$("#mfProjectNotificationMessageContainer").prepend(template(data));$("#mfProjectNotificationMessageWrapper").show();});}else{$("#mfProjectNotificationMessageContainer").prepend(cachedTemplate(data));$("#mfProjectNotificationMessageWrapper").show();}}if(data.cmd=="project_sync"){MF_LogSharedManager.list(MF_UserSession.getUser(),{callback:function(logData){mf_main.dashboardController.alertController.logSharedCollection=new ArrayCollection();mf_main.dashboardController.alertController.applyAlertTemplate(logData);}});if(cachedTemplate==null){$.get("templates/dashboard/DashboardRTCNotificationItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfDashboardRTCTemplate").html());mf_main.addTemplateToCache("mfDashboardRTCTemplate",template);$("#mfProjectNotificationMessageContainer").prepend(template(data));$("#mfProjectNotificationMessageWrapper").show();});}else{$("#mfProjectNotificationMessageContainer").prepend(cachedTemplate(data));$("#mfProjectNotificationMessageWrapper").show();}}}});};this.projectShareSync=function(cmd,rtcObj){var obj=new Object();obj.sessionID=thisClass.sessionID;obj.cmd=cmd;obj.sender=rtcObj.sender;obj.userobj=rtcObj.collabarators;obj.message=rtcObj.messageStr;obj.profileImage=rtcObj.profileImage;if(cmd=="project_share"){thisClass.socket.emit("sendmsg",obj);return;}if(cmd=="project_sync"){thisClass.socket.emit("sendmsg",obj);return;}};}function MF_RTSController(){var thisClass=this;this.rtsSet=false;this.start=function(){MF_RTSServer.setSessionID(MF_UserSession.getUser().username,{callback:function(){dwr.engine.setActiveReverseAjax(true);thisClass.rtsSet=true;}});};this.sendRefreshDashboard=function(){if(thisClass.rtsSet){var rtsData=new MF_RTSData();rtsData.sessionID=MF_UserSession.getUser().username;rtsData.callType="refreshDashboard";rtsData.msg="";rtsData.UID=mf_main.UID;MF_RTSServer.communicate(rtsData,{callback:function(){}});}};this.parseRTSData=function(rtsData){if(rtsData){if(rtsData.callType="refreshDashboard"){mf_main.dashboardController.refreshHandler();}}};}function MF_RTSData(){var thisClass=this;this.sessionID=null;this.UID=null;this.callType=null;this.msg="";}function MF_RTSReceive(rtsData){if(rtsData.UID!=mf_main.UID){if(mf_main&&mf_main.rtsController){mf_main.rtsController.parseRTSData(rtsData);}}}function MF_TeamController(){var thisClass=this;this.constructor=function(){$("#mfTeamModal").on("show",thisClass.teamModalShowHandler);$("#mfTeamAddMemberBox").on("textchange",thisClass.textChangeHandler);$("#mfTeamAddMemberBox").on("keypress",thisClass.enterHandler);$("#mfTeamManagerAddBtn").on("click",thisClass.addClickHandler);};this.teamMembers=new ArrayCollection();this.selectedMember=null;this.listed=false;this.teamModalShowHandler=function(e){thisClass.list(true);$("#mfTeamAddMemberBox").val("");thisClass.textChangeHandler(null);$("#mfTeamAddMemberBox").focus();};this.enterHandler=function(e){var keycode=(e.keyCode?e.keyCode:e.which);if(keycode=="13"){thisClass.addNewMember();}};this.addClickHandler=function(e){thisClass.addNewMember();};this.textChangeHandler=function(e){var arr=$.grep(thisClass.teamMembers.toArray(),function(value,i){var str1=value.userid.toLowerCase();var str2=$("#mfTeamAddMemberBox").val().toLowerCase();if(str1.indexOf(str2)>=0){return true;}else{return false;}});for(var i=0;i<thisClass.teamMembers.size();i++){var item=thisClass.teamMembers.getItemAt(i);var showItem=false;for(var k=0;k<arr.length;k++){if(item.userid.toLowerCase()==arr[k].userid.toLowerCase()){showItem=true;}}if(!showItem){$("#mfTeamMemberItem"+item.id).css("height","0px");$("#mfTeamMemberItem"+item.id).css("display","none");}else{$("#mfTeamMemberItem"+item.id).css("height","30px");$("#mfTeamMemberItem"+item.id).css("display","block");}}};this.applyTemplate=function(arr,sync){if(sync==null){sync=false;}$("#mfTeamList").empty();$("#mfTeamManagerLoader").css("display","none");thisClass.teamMembers=new ArrayCollection();var cachedTemplate=mf_main.getTemplateFromCache("mfTeamMemberTemplate");if(cachedTemplate==null){$.get("templates/dashboard/TeamMember.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfTeamMemberTemplate").html());mf_main.addTemplateToCache("mfTeamMemberTemplate",template);thisClass.renderTeamMemberItem(template,arr,sync);});}else{thisClass.renderTeamMemberItem(cachedTemplate,arr,sync);}};this.renderTeamMemberItem=function(template,arr,sync){for(var i=0,j=arr.length;i<j;i++){thisClass.teamMembers.addItem(arr[i]);$("#mfTeamList").append(template(arr[i]));$("#mfTeamMemberItem"+arr[i].id).on("mouseover",thisClass.memberItemOver);$("#mfTeamMemberItem"+arr[i].id).on("mouseout",thisClass.memberItemOut);$("#mfTeamMemberItem"+arr[i].id).on("click",thisClass.memberItemClick);}$(".mfTeamMemberDelBtn").on("click",thisClass.deleteMemberHandler);if(sync){mf_main.dashboardController.projectController.shareController.applyTemplate(arr,false);}};this.deleteMemberHandler=function(e){e.stopImmediatePropagation();thisClass.selectDeleteMember($(this).attr("id"));thisClass.deleteMember();};this.list=function(sync){if(sync==null){sync=false;}if(thisClass.listed){return;}if(mf_main.dashboardController.projectController.shareController.listed){return;}$("#mfTeamManagerLoader").css("display","block");MF_TeamManager.list(MF_UserSession.getUser().company,{callback:function(arr){if(arr!=null){thisClass.listed=true;thisClass.applyTemplate(arr,sync);}}});};this.memberItemOver=function(e){if(thisClass.selectedMember!=null&&("mfTeamMemberItem"+thisClass.selectedMember.id)==$(this).attr("id")){}else{$(this).css({"background-color":"#f6f6f6"});}};this.memberItemOut=function(e){if(thisClass.selectedMember!=null&&("mfTeamMemberItem"+thisClass.selectedMember.id)==$(this).attr("id")){}else{$(this).css({"background-color":"#fff"});}};function clearMemberSelection(){for(var i=0;i<thisClass.teamMembers.size();i++){var item=thisClass.teamMembers.getItemAt(i);$("#mfTeamMemberItem"+item.id).css({"background-color":"#fff"});}}this.selectMember=function(pid){clearMemberSelection();for(var i=0;i<thisClass.teamMembers.size();i++){var item=thisClass.teamMembers.getItemAt(i);if("mfTeamMemberItem"+item.id==pid){this.selectedMember=item;$("#mfTeamMemberItem"+item.id).css({"background-color":"#f0f0f0"});break;}}};this.selectDeleteMember=function(pid){for(var i=0;i<thisClass.teamMembers.size();i++){var item=thisClass.teamMembers.getItemAt(i);if("mfTeamMemberDelBtn"+item.id==pid){this.selectedMember=item;break;}}};this.memberItemClick=function(e){thisClass.selectMember($(this).attr("id"));};this.deleteMember=function(){if(thisClass.selectedMember!=null){var answer=confirm('Remove "'+thisClass.selectedMember.userid+'" from your Team List?');if(answer){$("#mfTeamMemberItem"+thisClass.selectedMember.id).css("height","0px");$("#mfTeamMemberItem"+thisClass.selectedMember.id).css("display","none");$("#mfShareMemberItem"+thisClass.selectedMember.id).css("height","0px");$("#mfShareMemberItem"+thisClass.selectedMember.id).css("display","none");var tind=thisClass.teamMembers.getItemIndex(thisClass.selectedMember);if(tind!=-1){thisClass.teamMembers.removeItemAt(tind);}MF_TeamManager.deleteMember(MF_UserSession.getUser(),thisClass.selectedMember.userid,{callback:function(str){$("#mfTeamManagerLoader").css("display","none");}});}}};this.IsExist=function(email){for(var i=0;i<thisClass.teamMembers.size();i++){var user=thisClass.teamMembers.getItemAt(i);if(user.userid.toLowerCase()==email.toLowerCase()){return true;}}return false;};this.addNewMember=function(){var memberID=$("#mfTeamAddMemberBox").val();if(memberID.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()){alert("You cannot share it with yourself");return;}if(memberID==""){return;}memberID=memberID.toLowerCase();if(!MF_Utils.isValidEmailAddress(memberID)){alert("Invalid email");return;}if(thisClass.IsExist(memberID)){alert("User already exists");return;}var mem=new MF_TeamMember();mem.id=MF_Utils.guidGenerator();mem.userid=$("#mfTeamAddMemberBox").val();mem.type="";mem.license="";$("#mfTeamAddMemberBox").val("");thisClass.textChangeHandler(null);thisClass.teamMembers.addItemAt(mem,0);thisClass.applyTemplate(thisClass.teamMembers.toArray(),true);MF_TeamManager.addMember(MF_UserSession.getUser().company,mem,MF_UserSession.getUser(),{callback:function(str){$("#mfTeamManagerLoader").css("display","none");if(str=="success"){}else{alert("Some error occurred");}}});};}function MF_AlertController(){var thisClass=this;this.logSharedCollection=new ArrayCollection();this.unreadItems=0;this.constructor=function(){this.drawNotificationBubble();$("#mfTeamAlertBtn").on("click",thisClass.openAlertHandler);$("#mfTeamAlertBubble").on("click",thisClass.openAlertHandler);$("#mfTeamAlertEmptyBtn").on("click",thisClass.emptyAlertDialogHandler);};this.alertListOver=function(e){$("#mfTeamAlertModalList").css("overflow-y","auto");};this.alertListOut=function(e){$("#mfTeamAlertModalList").css("overflow-y","hidden");};this.emptyAlertDialogHandler=function(e){e.stopPropagation();$("#mfTeamAlertModal").removeClass("animated scaleInSmall");$("#mfTeamAlertModal").css("display","none");var answer=confirm("Empty all notifications?");if(answer){thisClass.emptyAlerts();}};this.emptyAlerts=function(){$("#mfContentLoader").css("display","block");$("#mfContentHolder").css("display","none");MF_AccountManager.emptyAlerts(MF_UserSession.getUser(),{callback:function(dashboardData){mf_main.dashboardController.refreshHandler(null);}});};this.openAlertHandler=function(e){e.stopPropagation();if($("#mfTeamAlertModal").css("display")=="block"){$("#mfTeamAlertModal").css("display","none");}else{thisClass.hideNotificationBubble();$("#mfTeamAlertModal").css("display","block");$("#mfTeamAlertModal").css("right",(($("#mfCurrentLabelSelected").width()-6))+"px");$("#mfTeamAlertModal").css("top","300px");$("#mfTeamAlertModal").animate({top:51},300,"easeOutBack").show();if(thisClass.unreadItems>0){MF_LogSharedManager.readAll(MF_UserSession.getUser().username,{callback:function(){}});}}};this.applyAlertTemplate=function(arr){$("#mfTeamAlertModalList").empty();var cachedTemplate=mf_main.getTemplateFromCache("mfAlertItemTemplate");if(cachedTemplate==null){$.get("templates/dashboard/AlertItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfAlertItemTemplate").html());mf_main.addTemplateToCache("mfAlertItemTemplate",template);thisClass.renderAlertItems(template,arr);});}else{thisClass.renderAlertItems(cachedTemplate,arr);}};this.renderAlertItems=function(template,arr){thisClass.unreadItems=0;for(var i=0,j=arr.length;i<j;i++){var nitem=new MF_LogShared();nitem.cast(arr[i]);thisClass.logSharedCollection.addItem(nitem);$("#mfTeamAlertModalList").append(template(nitem));if(!nitem.opened){thisClass.unreadItems++;}$("#mfAlertItem"+arr[i].id).on("click",thisClass.alertItemClick);}if(thisClass.unreadItems>0){$("#mfTeamAlertBubbleNum").text(thisClass.unreadItems.toString());thisClass.showNotificationBubble();}};this.showNotificationBubble=function(){$("#mfTeamAlertBubble").css("display","block");thisClass.centerNotificationBubble();};this.centerNotificationBubble=function(){if($("#mfTeamAlertBubble").css("display")=="block"){$("#mfTeamAlertBubble").css("right","-5px");$("#mfTeamAlertBubble").css("z-index","10");$("#mfTeamAlertBubble").css("top",(-7).toString()+"px");}};this.hideNotificationBubble=function(){$("#mfTeamAlertBubble").css("display","none");};this.drawNotificationBubble=function(e){var ctx_Circle1=(document.getElementById("mfTeamAlertBubbleCvs")).getContext("2d");ctx_Circle1.fillStyle="#FF0000";ctx_Circle1.beginPath();ctx_Circle1.arc(5,5,20,Math.PI*2,0,true);ctx_Circle1.closePath();ctx_Circle1.fill();};this.alertItemClick=function(e){MF_Utils.hide_menu("mfTeamAlertModal");$("#mfTeamAlertModal").removeClass("animated scaleInSmall");var alertID=$(this).attr("id");var alertObj=thisClass.getSelectedAlert(alertID);if(alertObj){if(alertObj.logtype=="COMMENTED"){var midarr=alertObj.projectid.split("#varid#");if(midarr.length==2){var mid=midarr[0];var varid=midarr[1];var project=mf_main.dashboardController.projectController.getProjectByID(mid);if(project==null){mf_main.dashboardController.projectController.openProjectById(mid,"",true,varid);return;}mf_main.dashboardController.projectController.openProject(project,"",true,varid);}else{var project=mf_main.dashboardController.projectController.getProjectByID(alertObj.projectid);if(project==null){mf_main.dashboardController.projectController.openProjectById(alertObj.projectid,"",true,"all");return;}mf_main.dashboardController.projectController.openProject(project,"",true,"all");}}else{if(alertObj.logtype=="ALTEREDLABEL"||alertObj.logtype=="APPROVED"){var midarr=alertObj.projectid.split("#varid#");if(midarr.length==2){var mid=midarr[0];var varid=midarr[1];var project=mf_main.dashboardController.projectController.getProjectByID(mid);if(project==null){mf_main.dashboardController.projectController.openProjectById(mid,"",true,varid);return;}mf_main.dashboardController.projectController.openProject(project,"",true,varid);}else{var project=mf_main.dashboardController.projectController.getProjectByID(alertObj.projectid);if(project==null){mf_main.dashboardController.projectController.openProjectById(alertObj.projectid,"",true,"all");return;}mf_main.dashboardController.projectController.openProject(project,"",true,"all");}}else{if(alertObj.logtype=="UNAPPROVED"){var midarr=alertObj.projectid.split("#varid#");if(midarr.length==2){var mid=midarr[0];var varid=midarr[1];var project=mf_main.dashboardController.projectController.getProjectByID(mid);if(project==null){mf_main.dashboardController.projectController.openProjectById(mid,"",true,varid);return;}mf_main.dashboardController.projectController.openProject(project,"",true,varid);}else{var project=mf_main.dashboardController.projectController.getProjectByID(alertObj.projectid);if(project==null){mf_main.dashboardController.projectController.openProjectById(alertObj.projectid,"",true,"all");return;}mf_main.dashboardController.projectController.openProject(project,"",true,"all");}}else{var project=mf_main.dashboardController.projectController.getProjectByID(alertObj.projectid);if(project==null){mf_main.dashboardController.projectController.openProjectById(alertObj.projectid,"");return;}mf_main.dashboardController.projectController.openProject(project,"");}}}}};this.getSelectedAlert=function(pid){for(var i=0;i<thisClass.logSharedCollection.size();i++){var item=thisClass.logSharedCollection.getItemAt(i);if("mfAlertItem"+item.id==pid){return item;}}return null;};}function MF_LabelController(){var thisClass=this;this.labelCollection=new ArrayCollection();this.allLabel=null;this.ownerLabel=null;this.sharedLabel=null;this.publicLabel=null;this.awaitApprovalLabel=null;this.sentApprovalLabel=null;this.approvedLabel=null;this.trashLabel=null;this.readonlyLabel=null;this.selectedLabel=null;this.constructor=function(){$("#mfLabelList").bind("sortstop",thisClass.sortLabelStopHandler);if(Modernizr.touch){$("#mfLabelList").css("overflow-y","auto");}else{$("#mfLabelList").on("mouseover",thisClass.labelListOver);$("#mfLabelList").on("mouseout",thisClass.labelListOut);}$("#mfLabelAddBtn,#mfAddNewLabel").on("click",thisClass.labelAddHandler);$("#mfLabelDelBtn").on("click",thisClass.labelRemoveHandler);$("#mfLabelHelpBtn").on("click",thisClass.labelHelpHandler);$("#mfLabelEditBtn").on("click",thisClass.labelEditHandler);$("#mfAddLabelModalCloseBtn").on("click",thisClass.closeHandler);$("#mfAddLabelModalBtn").on("click",thisClass.labelAddToServerHandler);$("#mfAddLabelModal").on("show",thisClass.addLabelShowHandler);$("#mfAddLabelModal").on("shown",thisClass.addLabelShownHandler);$("#mfAddLabelTitle").keypress(function(e){if(e.which==13){thisClass.labelAddToServerHandler(null);}});$("#mfHelpLabelModalCloseBtn").on("click",thisClass.closeHandler);$("#mfRenameLabelModal").on("show",thisClass.renameLabelShowHandler);$("#mfRenameLabelModal").on("shown",thisClass.renameLabelShownHandler);$("#mfRenameLabelModalCloseBtn").on("click",thisClass.closeHandler);$("#mfRenameLabelModalBtn").on("click",thisClass.labelRenameToServerHandler);$("#mfRenameLabelModalText").keypress(function(e){if(e.which==13){thisClass.labelRenameToServerHandler(null);}});};this.sortLabelStopHandler=function(e,ui){var d=new Date();var count=0;$("#mfLabelList").children().each(function(){count++;var label=thisClass.getLabelbyID($(this).attr("id"));if(label){label.createDate=new Date(d.getTime()+(count*1000));}});MF_LabelManager.updateLabels(thisClass.labelCollection.toArray(),{callback:function(){}});};this.labelListOver=function(e){$("#mfLabelList").css("overflow-y","auto");};this.labelListOut=function(e){$("#mfLabelList").css("overflow-y","hidden");};this.removeProjectFromDefaultLabel=function(project,owned){if(!project.readonly){thisClass.allLabel.count--;$("#mfLabelItemCount"+thisClass.allLabel.id).text(thisClass.allLabel.count.toString());if(owned){thisClass.ownerLabel.count--;$("#mfLabelItemCount"+thisClass.ownerLabel.id).text(thisClass.ownerLabel.count.toString());}else{thisClass.sharedLabel.count--;$("#mfLabelItemCount"+thisClass.sharedLabel.id).text(thisClass.sharedLabel.count.toString());}if(project.share){thisClass.publicLabel.count--;$("#mfLabelItemCount"+thisClass.publicLabel.id).text(thisClass.publicLabel.count.toString());}if(project.awaitingApproval){thisClass.awaitApprovalLabel.count--;$("#mfLabelItemCount"+thisClass.awaitApprovalLabel.id).text(thisClass.awaitApprovalLabel.count.toString());}if(project.sentForApproval){thisClass.sentApprovalLabel.count--;$("#mfLabelItemCount"+thisClass.sentApprovalLabel.id).text(thisClass.sentApprovalLabel.count.toString());}if(project.approvedProject){thisClass.approvedLabel.count--;$("#mfLabelItemCount"+thisClass.approvedLabel.id).text(thisClass.approvedLabel.count.toString());}}else{thisClass.readonlyLabel.count--;$("#mfLabelItemCount"+thisClass.readonlyLabel.id).text(thisClass.readonlyLabel.count.toString());}if(project.isdeleted){thisClass.trashLabel.count++;$("#mfLabelItemCount"+thisClass.trashLabel.id).text(thisClass.trashLabel.count.toString());}};this.removeProjectFromLabel=function(projectid,label){if(!label.defaultLabel){if(label.projects==null){label.projects="";}var newStr="";var arr=label.projects.split(",");var count=0;for(var i=0;i<arr.length;i++){var thisProjectID=arr[i];if(thisProjectID!=projectid){if(count==0){newStr=thisProjectID;}else{newStr=newStr+","+thisProjectID;}count++;}}label.projects=newStr;label.count=label.projects.split(",").length;if(label.projects.split(",").length>0){var lb1=label.projects.split(",")[0];if(lb1==""){label.count=label.count-1;}}if(label.count<0){label.count=0;}$("#mfLabelItemCount"+label.id).text(label.count.toString());}};this.closeHandler=function(){$(".modal").modal("hide");};this.renameLabelShowHandler=function(e){if(thisClass.selectedLabel){$("#mfRenameLabelModalText").val(thisClass.selectedLabel.name);}else{$("#mfRenameLabelModalText").val("");}};this.renameLabelShownHandler=function(e){$("#mfRenameLabelModalText").focus();};this.labelRenameToServerHandler=function(e){mf_main.closeDialog();var labelname=$.trim($("#mfRenameLabelModalText").val());if(labelname==""){alert("Label name cannot be empty");return;}if(thisClass.selectedLabel){thisClass.selectedLabel.name=labelname;$("#mfLabelItemName"+thisClass.selectedLabel.id).text(labelname);$("#mfCurrentLabelSelected p").text(labelname);}$("#mfRenameLabelModalText").val("");MF_LabelManager.update(thisClass.selectedLabel,{callback:function(){}});};this.labelAddToServerHandler=function(e){var labelname=$.trim($("#mfAddLabelTitle").val());if(labelname==""){alert("Label name cannot be empty");return;}$("#mfAddLabelModalScreen2").show();$("#mfAddLabelModalScreen1").hide();$("#mfAddLabelModalCloseBtn").hide();$("#mfAddLabelModalBtn").hide();$("#mfAddLabelModalTitle").text("Creating Label...");$("#mfAddLabelModalBtn").attr("disabled","disabled");var l=new MF_ProjectLabel();l.name=$("#mfAddLabelTitle").val();l.id=MF_Utils.guidGenerator();l.creator=MF_UserSession.getUser().username;l.clientid=MF_UserSession.getUser().company;l.color="0xCCCCCC";l.projects="";l.defaultLabel=false;l.createDate=new Date();MF_LabelManager.add(l,{callback:function(){thisClass.labelCollection.addItem(l);thisClass.listLabels();mf_main.closeDialog();}});};this.mfAddLabelModalReset=function(){$("#mfAddLabelModalScreen1").show();$("#mfAddLabelModalScreen2").hide();$("#mfAddLabelModalCloseBtn").show();$("#mfAddLabelModalBtn").show();$("#mfAddLabelModalTitle").text("New Label");$("#mfAddLabelModalBtn").removeAttr("disabled");$("#mfAddLabelTitle").val("");};this.addLabelShowHandler=function(e){thisClass.mfAddLabelModalReset();};this.addLabelShownHandler=function(e){$("#mfAddLabelTitle").focus();};this.labelAddHandler=function(e){$("#mfAddLabelModal").modal();};this.labelRemoveHandler=function(e){mf_main.dashboardController.closeLabelSideBar();if(thisClass.selectedLabel){if(thisClass.selectedLabel.defaultLabel){MF_Utils.display_ActionIndicator("Cannot remove Default labels");}else{var answer=confirm('This will only delete the label "'+thisClass.selectedLabel.name+'" and not its projects. Continue?');if(answer){var lind=thisClass.labelCollection.getItemIndex(thisClass.selectedLabel);if(lind!=-1){thisClass.labelCollection.removeItemAt(lind);}thisClass.listLabels();MF_LabelManager.deleteLabel(thisClass.selectedLabel,{callback:function(){thisClass.selectedLabel=thisClass.allLabel;thisClass.listProjectsByLabel(thisClass.allLabel);}});thisClass.selectedLabel=thisClass.allLabel;}}}else{MF_Utils.display_ActionIndicator("No Label selected");}};this.labelHelpHandler=function(e){mf_main.dashboardController.closeLabelSideBar();$("#mfHelpLabelModal").modal();};this.createDefaultLabels=function(){thisClass.allLabel=new MF_ProjectLabel();thisClass.allLabel.id="all";thisClass.allLabel.clientid=MF_UserSession.getUser().company;thisClass.allLabel.createDate=new Date();thisClass.allLabel.defaultLabel=true;thisClass.allLabel.projects="";thisClass.allLabel.color="#FFFFFF";thisClass.allLabel.name="All Projects";thisClass.ownerLabel=new MF_ProjectLabel();thisClass.ownerLabel.id="owner";thisClass.ownerLabel.clientid=MF_UserSession.getUser().company;thisClass.ownerLabel.createDate=new Date();thisClass.ownerLabel.defaultLabel=true;thisClass.ownerLabel.projects="";thisClass.ownerLabel.color="#FFFFFF";thisClass.ownerLabel.name="Owned by me";thisClass.sharedLabel=new MF_ProjectLabel();thisClass.sharedLabel.id="shared";thisClass.sharedLabel.clientid=MF_UserSession.getUser().company;thisClass.sharedLabel.createDate=new Date();thisClass.sharedLabel.defaultLabel=true;thisClass.sharedLabel.projects="";thisClass.sharedLabel.color="#FFFFFF";thisClass.sharedLabel.name="Shared by others";thisClass.publicLabel=new MF_ProjectLabel();thisClass.publicLabel.id="public";thisClass.publicLabel.clientid=MF_UserSession.getUser().company;thisClass.publicLabel.createDate=new Date();thisClass.publicLabel.defaultLabel=true;thisClass.publicLabel.projects="";thisClass.publicLabel.color="#FFFFFF";thisClass.publicLabel.name="Public Projects";thisClass.awaitApprovalLabel=new MF_ProjectLabel();thisClass.awaitApprovalLabel.id="awaitapproval";thisClass.awaitApprovalLabel.clientid=MF_UserSession.getUser().company;thisClass.awaitApprovalLabel.createDate=new Date();thisClass.awaitApprovalLabel.defaultLabel=true;thisClass.awaitApprovalLabel.projects="";thisClass.awaitApprovalLabel.color="#FFFFFF";thisClass.awaitApprovalLabel.name="Awaiting my Approval";thisClass.awaitApprovalLabel.approvallabel=true;thisClass.sentApprovalLabel=new MF_ProjectLabel();thisClass.sentApprovalLabel.id="sentapproval";thisClass.sentApprovalLabel.clientid=MF_UserSession.getUser().company;thisClass.sentApprovalLabel.createDate=new Date();thisClass.sentApprovalLabel.defaultLabel=true;thisClass.sentApprovalLabel.projects="";thisClass.sentApprovalLabel.color="#FFFFFF";thisClass.sentApprovalLabel.name="Sent for Approval";thisClass.sentApprovalLabel.approvallabel=true;thisClass.approvedLabel=new MF_ProjectLabel();thisClass.approvedLabel.id="approved";thisClass.approvedLabel.clientid=MF_UserSession.getUser().company;thisClass.approvedLabel.createDate=new Date();thisClass.approvedLabel.defaultLabel=true;thisClass.approvedLabel.projects="";thisClass.approvedLabel.color="#FFFFFF";thisClass.approvedLabel.name="Approved Projects";thisClass.approvedLabel.approvallabel=true;thisClass.trashLabel=new MF_ProjectLabel();thisClass.trashLabel.id="trash";thisClass.trashLabel.clientid=MF_UserSession.getUser().company;thisClass.trashLabel.createDate=new Date();thisClass.trashLabel.defaultLabel=true;thisClass.trashLabel.projects="";thisClass.trashLabel.color="#FFFFFF";thisClass.trashLabel.name="Trash";thisClass.readonlyLabel=new MF_ProjectLabel();thisClass.readonlyLabel.id="readonly";thisClass.readonlyLabel.clientid=MF_UserSession.getUser().company;thisClass.readonlyLabel.createDate=new Date();thisClass.readonlyLabel.defaultLabel=true;thisClass.readonlyLabel.projects="";thisClass.readonlyLabel.color="#FFFFFF";thisClass.readonlyLabel.name="Archived";var gapLabel=new MF_ProjectLabel();gapLabel.id="gap";gapLabel.clientid=MF_UserSession.getUser().company;gapLabel.createDate=new Date();gapLabel.defaultLabel=true;gapLabel.projects="";gapLabel.color="#FFFFFF";gapLabel.name="";var gapLabel2=new MF_ProjectLabel();gapLabel2.id="gap2";gapLabel2.clientid=MF_UserSession.getUser().company;gapLabel2.createDate=new Date();gapLabel2.defaultLabel=true;gapLabel2.projects="";gapLabel2.color="#FFFFFF";gapLabel2.name="";thisClass.labelCollection.addItem(thisClass.allLabel);thisClass.labelCollection.addItem(thisClass.ownerLabel);thisClass.labelCollection.addItem(thisClass.sharedLabel);thisClass.labelCollection.addItem(thisClass.publicLabel);thisClass.labelCollection.addItem(thisClass.readonlyLabel);thisClass.labelCollection.addItem(thisClass.trashLabel);thisClass.labelCollection.addItem(gapLabel);thisClass.labelCollection.addItem(thisClass.awaitApprovalLabel);thisClass.labelCollection.addItem(thisClass.sentApprovalLabel);thisClass.labelCollection.addItem(thisClass.approvedLabel);thisClass.labelCollection.addItem(gapLabel2);};this.listLabels=function(){$("#mfLabelList").empty();var cachedTemplate=mf_main.getTemplateFromCache("mfLabelItemTemplate");if(cachedTemplate==null){$.get("templates/dashboard/LabelItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfLabelItemTemplate").html());mf_main.addTemplateToCache("mfLabelItemTemplate",template);thisClass.renderLabelListing(template);});}else{thisClass.renderLabelListing(cachedTemplate);}};this.renderLabelListing=function(template){var sortableItems="";var sortableCount=0;for(var k=0;k<thisClass.labelCollection.size();k++){var litem=thisClass.labelCollection.getItemAt(k);$("#mfLabelList").append(template(litem));if(litem.defaultLabel!=true){if(sortableCount==0){sortableItems=".mfLabelItemCls"+litem.id;}else{sortableItems=sortableItems+",.mfLabelItemCls"+litem.id;}sortableCount++;$("#mfLabelItem"+litem.id).droppable({over:thisClass.handleProjectOver,out:thisClass.handleProjectOut,drop:thisClass.handleProjectDrop});$("#mfLabelItem"+litem.id).data("dtype","label");$("#mfLabelItem"+litem.id).data("did","mfLabelItem"+litem.id);}$("#mfLabelItem"+litem.id).on("mouseover",thisClass.labelItemOver);$("#mfLabelItem"+litem.id).on("mouseout",thisClass.labelItemOut);$("#mfLabelItem"+litem.id).on("click",thisClass.labelItemClick);}$("#mfLabelItemCountapproved, #mfLabelItemCountsentapproval, #mfLabelItemCountawaitapproval").addClass("badge").css({"background-color":"#B0B0B0",color:"#fff"});if(!Modernizr.touch){$("#mfLabelList").sortable({items:sortableItems});}};this.handleProjectOver=function(event,ui){if(ui.draggable.data("dtype")=="project"||ui.draggable.data("dtype")=="label"){$(this).css({"background-color":"#ffcc33"});}};this.handleProjectOut=function(event,ui){$(this).css({"background-color":"transparent"});};this.handleProjectDrop=function(event,ui){$(this).css({"background-color":"transparent"});if(ui.draggable.data("dtype")=="project"){mf_main.dashboardController.projectController.selectProject(ui.draggable.data("did"));var label=thisClass.getLabelbyID($(this).attr("id"));if(label&&label.defaultLabel){MF_Utils.display_ActionIndicator("Cannot drop to Default labels");}else{if(mf_main.dashboardController.projectController.selectedProject&&label){thisClass.addProjectToLabel(mf_main.dashboardController.projectController.selectedProject,label);}}}if(ui.draggable.data("dtype")=="label"){}};this.addProjectToLabel=function(project,label){if(label.projects==null){label.projects="";}var arr=label.projects.split(",");var present=false;for(var k=0;k<arr.length;k++){var mid=arr[k];if(mid==project.id){present=true;break;}}if(!present){label.count++;label.projects=label.projects+","+project.id;$("#mfLabelItemCount"+label.id).text(label.count.toString());MF_LabelManager.update(label,{callback:function(){}});}};this.listProjectsByLabel=function(label){$("#mfCurrentLabelSelected p").html(label.name);$("#mfLabelItem"+label.id).css({"font-weight":"bold"});$("#mfDesignSets").empty();var cachedTemplate=mf_main.getTemplateFromCache("mfProjectItemTemplate");if(cachedTemplate==null){$.get("templates/dashboard/ProjectItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfProjectItemTemplate").html());mf_main.addTemplateToCache("mfProjectItemTemplate",template);thisClass.renderProjectItemByLabel(template,label);});}else{thisClass.renderProjectItemByLabel(cachedTemplate,label);}};this.renderProjectItemByLabel=function(template,label){mf_main.dashboardController.projectListLabel=label.id;mf_main.dashboardController.projectListStartIndex=0;mf_main.dashboardController.getDashboardProjects(true);};this.countProjectsByLabel=function(dashboardDataObj){thisClass.ownerLabel.count=0;thisClass.sharedLabel.count=0;thisClass.allLabel.count=0;thisClass.publicLabel.count=0;thisClass.awaitApprovalLabel.count=0;thisClass.sentApprovalLabel.count=0;thisClass.approvedLabel.count=0;thisClass.trashLabel.count=0;thisClass.readonlyLabel.count=0;thisClass.allLabel.count=dashboardDataObj.totalProjectsCount;thisClass.ownerLabel.count=dashboardDataObj.ownedProjectsCount;thisClass.sharedLabel.count=dashboardDataObj.sharedProjectsCount;thisClass.publicLabel.count=dashboardDataObj.publicProjectsCount;thisClass.trashLabel.count=dashboardDataObj.trashProjectsCount;thisClass.readonlyLabel.count=dashboardDataObj.readonlyProjectsCount;thisClass.approvedLabel.count=dashboardDataObj.approvedProjectsCount;thisClass.awaitApprovalLabel.count=dashboardDataObj.awaitingApprovalProjectsCount;thisClass.sentApprovalLabel.count=dashboardDataObj.sentForApprovalProjectsCount;for(var k=0;k<thisClass.labelCollection.size();k++){var projectLabel=thisClass.labelCollection.getItemAt(k);if(projectLabel.projects!=null&&!projectLabel.defaultLabel){projectLabel.count=projectLabel.projects.split(",").length;if(projectLabel.projects.split(",").length>0){var lb1=projectLabel.projects.split(",")[0];if(lb1==""){projectLabel.count=projectLabel.count-1;}}if(projectLabel.count<0){projectLabel.count=0;}}}};this.filterLabelResults=function(label,item){if(label){if(label.defaultLabel){if(label.id=="public"){if(!item.isdeleted&&item.share&&item.company==MF_UserSession.getUser().company){return true;}}if(label.id=="all"){if(!item.isdeleted){return true;}}if(label.id=="shared"){if(!item.isdeleted&&item.company!=MF_UserSession.getUser().company){return true;}}if(label.id=="owner"){if(!item.isdeleted&&item.company==MF_UserSession.getUser().company){return true;}}if(label.id=="awaitapproval"){if(!item.isdeleted&&item.awaitingApproval){return true;}}if(label.id=="sentapproval"){if(!item.isdeleted&&item.sentForApproval){return true;}}if(label.id=="approved"){if(!item.isdeleted&&item.approvedProject){return true;}}if(label.id=="trash"){if(item.isdeleted){return true;}}if(label.id=="readonly"){if(item.readonly){return true;}}}else{if(label.projects==null){label.projects="";}var arr=label.projects.split(",");for(var k=0;k<arr.length;k++){var mid=arr[k];if(!item.isdeleted&&mid==item.id){return true;}}}}return false;};this.labelItemOver=function(e){if(thisClass.selectedLabel!=null&&("mfLabelItem"+thisClass.selectedLabel.id)==$(this).attr("id")){}else{if($(this).attr("id")!="mfLabelItemgap"){$(this).css({"font-weight":"bold"});}}};this.labelItemOut=function(e){if(thisClass.selectedLabel!=null&&("mfLabelItem"+thisClass.selectedLabel.id)==$(this).attr("id")){}else{if($(this).attr("id")!="mfLabelItemgap"){$(this).css({"font-weight":"normal"});}}};this.clearLabelSelection=function(){for(var i=0;i<thisClass.labelCollection.size();i++){var item=thisClass.labelCollection.getItemAt(i);$("#mfLabelItem"+item.id).css({"font-weight":"normal"});}};this.selectLabel=function(pid){thisClass.clearLabelSelection();for(var i=0;i<thisClass.labelCollection.size();i++){var item=thisClass.labelCollection.getItemAt(i);if("mfLabelItem"+item.id==pid){thisClass.selectedLabel=item;thisClass.listProjectsByLabel(thisClass.selectedLabel);break;}}};this.getLabelbyID=function(pid){thisClass.clearLabelSelection();for(var i=0;i<thisClass.labelCollection.size();i++){var item=thisClass.labelCollection.getItemAt(i);if("mfLabelItem"+item.id==pid){return item;break;}}return null;};this.labelItemClick=function(e){if($(this).attr("id")!="mfLabelItemgap"){thisClass.selectLabel($(this).attr("id"));}mf_main.dashboardController.closeLabelSideBar();};this.labelEditHandler=function(e){if(!thisClass.selectedLabel||thisClass.selectedLabel.defaultLabel){MF_Utils.display_ActionIndicator("Default Labels cannot be renamed");}else{$("#mfRenameLabelModal").modal();}};this.selectLabelUI=function(labelId){thisClass.clearLabelSelection();for(var i=0;i<thisClass.labelCollection.size();i++){var item=thisClass.labelCollection.getItemAt(i);if(item.id==labelId){thisClass.selectedLabel=item;$("#mfCurrentLabelSelected p").html(item.name);$("#mfLabelItem"+item.id).css({"font-weight":"bold"});break;}}};}function MF_DashboardController(){var thisClass=this;this.currentSideBarStack="mfDashSidebarLabels";this.infoShowed=false;this.logShowed=false;this.memberShowed=false;this.labelController=new MF_LabelController();this.projectController=new MF_ProjectController();this.alertController=new MF_AlertController();this.integrationListed=false;this.showSidebar=false;this.showApplist=false;this.showAccountMenu=false;this.projectListStartIndex=0;this.projectListLength=50;this.projectListSearchText="";this.projectListLabel="";this.isLazyLoadInProgress=false;this.allProjectsLoaded=false;this.projectListLatestCall=null;this.openRecentProject=false;this.constructor=function(){thisClass.labelController.constructor();thisClass.alertController.constructor();thisClass.projectController.constructor();$("#mfMobileApps").on("click",thisClass.appListHandler);$("#mfRefreshDashboardBtn").on("click",thisClass.refreshHandler);$("#mfCloseSideBarBtn").on("click",thisClass.closeSidebar);$("#mfDashSidebarBackground").on("click",thisClass.closeSidebar);$("#mfLoginBoxBackground").on("click",thisClass.closeApplist);$("#mfOpenAppList").on("click",thisClass.openApplist);$("#mfAccountMenuApps").on("click",thisClass.openApplist);$("#mfAppListCloseBtn").on("click",thisClass.closeApplist);$(".mfSwitchAppBtnCls").on("click",thisClass.openApplist2);$("#mfAccountMenuBoxBackground").on("click",thisClass.closeAccountMenu);$("#mfAccountMenuBtn").on("click",thisClass.openAccountMenu);$("#mfAccountMenuCloseBtn").on("click",thisClass.closeAccountMenu);$("#mfCurrentLabelSelected").on("click",thisClass.toggleLabelsSideBar);$("#mfCloseLabelSideBar").on("click",thisClass.closeLabelSideBar);$("#mfNewProjectGettingStartedBtn").on("click",thisClass.newProjectHandler);$("#mfMemberAccessEdit,.mfMemberAccessRemoveLink").tooltip({animation:false});$("#mfRefreshDashboardBtn").tooltip({animation:false,placement:"bottom"});$("#mfAddToUserList").tooltip({animation:false,placement:"bottom"});$("#mfMobileApps").tooltip({animation:false,placement:"bottom"});$(".mfLabelControlIcon").tooltip({animation:false,placement:"left"});$("#mfProjectDetailsTab a").click(function(e){e.preventDefault();$(this).tab("show");});$(document).bind("keydown",function(evt){if(evt.keyCode=="27"){mf_main.dashboardController.closeLabelSideBar();thisClass.closeSidebar();thisClass.closeApplist();thisClass.closeAccountMenu();}});$("#mfDesignSets").scroll(thisClass.projectListScrollHandler);$("#mfProjectNotificationCloseBtn").on("click",thisClass.closeRTCNotificationSection);$("#mfProjectNotificationMessageReload").on("click",thisClass.refreshHandler);};this.newProjectHandler=function(e){thisClass.projectController.openNewProjectModalHandler();};this.openSidebar=function(){thisClass.showSidebar=true;thisClass.infoShowed=false;thisClass.logShowed=false;thisClass.memberShowed=false;thisClass.openMemberCanvas();if(thisClass.projectController.selectedProject.approved){$("#mfApproveTick").show();}else{$("#mfApproveTick").hide();}mf_main.dashboardController.interfaceResize();mf_main.dashboardController.projectController.openManageLabelsHandler();$("#mfProjectSBThumb").attr("src",thisClass.projectController.selectedProject.thumbnailURL);$("#mfProjectSBThumbContainer").imgLiquid();$("#mfProjectSBTitle").text(mfProjectTitle());function mfProjectTitle(){var projectTitle=thisClass.projectController.selectedProject.title;var maxChar=80;if(projectTitle.length>maxChar){projectTitle=projectTitle.substr(0,80)+"...";$("#mfProjectSBTitle").text(projectTitle);}else{$("#mfProjectSBTitle").text(thisClass.projectController.selectedProject.title);}}$("#mfDashSidebarBackground").show(0,onDivShow);function onDivShow(){$("#mfDashSidebar").css("display","block");$("#mfDashSidebar").css({position:"absolute",left:($(window).width()+$("#mfDashSidebar").width())});$("#mfDashSidebar").transition({left:($(window).width()-$("#mfDashSidebar").width())+"px",easing:"easeOutExpo",duration:500,complete:function(){$("#mfProjectSBMenuBtn").attr("src",$("#mfProjectSBMenuBtn").attr("src"));mf_main.dashboardController.interfaceResize();}});}};this.closeSidebar=function(){thisClass.showSidebar=false;$("#mfDashSidebarBackground").css("display","none");$("#mfDashSidebar").css("display","none");$("#mfShareModal").hide();mf_main.dashboardController.closeLabelSideBar();};this.openApplist=function(){thisClass.closeAccountMenu();thisClass.showApplist=true;$("#mfAppSwitchLoader").hide();$("#mfLoginBoxBackground").show(0,onDivShow);function onDivShow(){mf_main.interfaceResize();$("#mfLoginBox").css("display","block");$("#mfLoginBox").css({position:"absolute",left:($(window).width()+$("#mfDashSidebar").width())});$("#mfLoginBox").animate({left:($(window).width()-$("#mfLoginBox").width())+"px"},{duration:500,complete:function(){}});}};this.openApplist2=function(){thisClass.closeAccountMenu();thisClass.showApplist=true;$("#mfAppSwitchLoader").hide();$("#mfLoginBoxBackground").show(0,onDivShow);function onDivShow(){mf_main.interfaceResize();$("#mfLoginBox").css("display","block");$("#mfLoginBox").css({position:"absolute",left:(-$("#mfDashSidebar").width())});$("#mfLoginBox").animate({left:"0px"},{duration:500,complete:function(){}});}};this.closeApplist=function(){thisClass.showApplist=false;$("#mfLoginBoxBackground").css("display","none");$("#mfLoginBox").css("display","none");};this.openAccountMenu=function(){thisClass.showAccountMenu=true;$("#mfAccountMenuBoxBackground").show(0,onDivShow);function onDivShow(){mf_main.interfaceResize();$("#mfAccountMenuBox").css("display","block");$("#mfAccountMenuBox").css({position:"absolute",left:($(window).width()+$("#mfDashSidebar").width())});$("#mfAccountMenuBox").animate({left:($(window).width()-$("#mfAccountMenuBox").width())+"px"},{duration:500,complete:function(){}});}};this.closeAccountMenu=function(){thisClass.showAccountMenu=false;$("#mfAccountMenuBoxBackground").css("display","none");$("#mfAccountMenuBox").css("display","none");};this.interfaceResize=function(){$("#mfDesignListing").width($(window).width()-$("#mfControl").width());$(".mfDesignListingCls").height($("#mfControl").height()-$("#mfDesignSetsBar").height()-36);$("#mfSearchProjectsInput").width($("#mfDesignSetsBar").width()-800);$("#mfAccountMenuBtn").css({position:"absolute",left:($(window).width()-15-10),top:20});$("#mfDashboardProfileImg").css({position:"absolute",left:($(window).width()-23-23-50),top:7});$("#mfOpenAppList").css({position:"absolute",left:($(window).width()-30-190),top:12});$("#mfUpgradePromo").css({position:"absolute",left:($(window).width()-30-320),top:14});if(thisClass.showSidebar){$("#mfDashSidebar").height($(window).height());$("#mfDashSidebar").css({position:"absolute",left:($(window).width()-$("#mfDashSidebar").width())});$("#mfDashSidebarBackground").height($(window).height());$("#mfDashSidebarBackground").width($(window).width());$("#mfDashSidebarProject").height($(window).height()-$("#mfDashSidebarProject").position().top);$("#mfManageLabelsList").height($("#mfMemberCanvas").height()-$("#mfMemberActionBar").height()-$("#mfMemberAccessBar").height()-120);}if(thisClass.showApplist){$("#mfLoginBox").height($(window).height());$("#mfLoginBox").css({position:"absolute",left:($(window).width()-$("#mfLoginBox").width())});$("#mfLoginBoxBackground").height($(window).height());$("#mfLoginBoxBackground").width($(window).width());}if(thisClass.showAccountMenu){$("#mfAccountMenuBox").height($(window).height());$("#mfAccountMenuBox").css({position:"absolute",left:($(window).width()-$("#mfAccountMenuBox").width())});$("#mfAccountMenuBoxBackground").height($(window).height());$("#mfAccountMenuBoxBackground").width($(window).width());}};this.openMemberCanvasHandler=function(e){thisClass.openMemberCanvas();};this.fetchDashboardData=function(){MF_AccountManager.getDashboardData(MF_UserSession.getUser(),false,{callback:function(dashboardData){thisClass.listDashboardData(dashboardData);}});};this.listDashboardData=function(dashboardDataObj){if(dashboardDataObj!=null){thisClass.projectController.projectCollection=new ArrayCollection();thisClass.labelController.labelCollection=new ArrayCollection();thisClass.alertController.logSharedCollection=new ArrayCollection();$("#mfDesignSets").empty();var cachedTemplate=mf_main.getTemplateFromCache("mfProjectItemTemplate");if(cachedTemplate==null){$.get("templates/dashboard/ProjectItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfProjectItemTemplate").html());mf_main.addTemplateToCache("mfProjectItemTemplate",template);thisClass.renderDashboardData(template,dashboardDataObj);thisClass.alertController.centerNotificationBubble();});}else{thisClass.renderDashboardData(cachedTemplate,dashboardDataObj);}thisClass.alertController.applyAlertTemplate(dashboardDataObj.logshared);}};this.listProjects=function(template,projects,clearProjectList){var len=projects.length;if(clearProjectList){thisClass.projectController.projectCollection=new ArrayCollection();}var recentProjPresent=false;for(var i=0;i<len;i++){var pitem=new MF_Project();pitem.cast(projects[i]);pitem.creatorImage=MF_Utils.get_gravatar(pitem.creator,32);pitem.appStatus=(pitem.boards!==0&&(pitem.approveCount===pitem.boards)?"approved":"");if(pitem.approvedVariation!=null&&pitem.approvedVariation!=""){pitem.approved=true;}else{pitem.approved=false;}thisClass.projectController.projectCollection.addItem(pitem);$("#mfDesignSets").append(template(pitem));thisClass.projectController.addProjectToTemplate(pitem);if(thisClass.openRecentProject&&thisClass.projectController.recentProject!=null){if(pitem.id==thisClass.projectController.recentProject.id){recentProjPresent=true;}}}if(recentProjPresent==false&&thisClass.openRecentProject&&thisClass.projectController.recentProject!=null){thisClass.projectController.projectCollection.addItemAt(thisClass.projectController.recentProject,0);$("#mfDesignSets").prepend(template(thisClass.projectController.recentProject));thisClass.projectController.addProjectToTemplate(thisClass.projectController.recentProject);}$("#mfDesignSets .mfProjectListPaginationLoaderCls").remove();if(thisClass.projectListStartIndex==0){thisClass.allProjectsLoaded=false;}if(projects.length<thisClass.projectListLength){thisClass.allProjectsLoaded=true;}if(thisClass.projectController.projectCollection.size()==0&&thisClass.projectListSearchText==""&&((thisClass.labelController.selectedLabel!=null&&thisClass.labelController.selectedLabel.id=="all")||thisClass.labelController.selectedLabel==null)){$("#mfDesignSets").css("display","none");$("#mfDesignBlank").css("display","block");}else{$("#mfDesignBlank").css("display","none");$("#mfDesignSets").css("display","block");if(clearProjectList){$("#mfDesignSets").scrollTop(0);}}$(".mfProjectItemWrapper").on("mouseover",thisClass.projectController.projectItemOver);$(".mfProjectItemWrapper").on("mouseout",thisClass.projectController.projectItemOut);$(".projectItemOverOpenBtn").on("click",thisClass.projectItemOpen);thisClass.projectController.bindMoreiconEvents();$("#mfProjectListLoader").hide();if(thisClass.openRecentProject&&thisClass.projectController.recentProject!=null){thisClass.openRecentProject=false;thisClass.projectController.selectProject("mfProjectItem"+thisClass.projectController.recentProject.id);thisClass.openSidebar();thisClass.labelController.allLabel.count++;$("#mfLabelItemCount"+thisClass.labelController.allLabel.id).text(thisClass.labelController.allLabel.count.toString());thisClass.labelController.ownerLabel.count++;$("#mfLabelItemCount"+thisClass.labelController.ownerLabel.id).text(thisClass.labelController.ownerLabel.count.toString());}$("#mfDashboardEmptyTrashContainer").hide();if(thisClass.labelController.selectedLabel!=null&&thisClass.labelController.selectedLabel.id=="trash"&&thisClass.projectController.projectCollection.size()>0){$("#mfDashboardEmptyTrashContainer").show();}};this.projectItemOpen=function(e){e.stopImmediatePropagation();var currentProjectID=$(this).attr("id");currentProjectID=currentProjectID.replace("mfProjectItemOverOpenBtn","");thisClass.projectController.selectProject("mfProjectItem"+currentProjectID);thisClass.projectController.openProject(thisClass.projectController.selectedProject);};this.renderDashboardData=function(template,dashboardDataObj){$("#mfContentLoader").css("display","none");$("#mfContentHolder").css("display","block");thisClass.getDashboardProjects(true);thisClass.labelController.createDefaultLabels();for(var i=0,j=dashboardDataObj.labels.length;i<j;i++){var nitem=new MF_ProjectLabel();nitem.cast(dashboardDataObj.labels[i]);thisClass.labelController.labelCollection.addItem(nitem);}thisClass.labelController.countProjectsByLabel(dashboardDataObj);thisClass.labelController.listLabels();if(thisClass.labelController.allLabel){$("#mfCurrentLabelSelected p").html(thisClass.labelController.allLabel.name);$("#mfLabelItem"+thisClass.labelController.allLabel.id).css({"font-weight":"bold"});}$("#mfUpgradePromo").css("visibility","visible");mf_main.interfaceResize();};this.refreshHandler=function(e){$("#mfContentLoader").css("display","block");$("#mfContentHolder").css("display","none");mf_main.interfaceResize();thisClass.labelController.selectLabelUI("all");thisClass.projectListLabel="all";thisClass.projectListStartIndex=0;thisClass.projectListSearchText="";$("#mfSearchProjectsInput").val("");thisClass.closeRTCNotificationSection();thisClass.closeSidebar();thisClass.fetchDashboardData();$("#mfDashboardEmptyTrashContainer").hide();};this.closeHandler=function(){$(".modal").modal("hide");};this.openProjectView=function(){$("#mfDashSidebarProject").css("display","block");mf_main.interfaceResize();};this.showMemberList=function(){thisClass.openSidebar();thisClass.infoShowed=false;thisClass.logShowed=false;thisClass.memberShowed=false;thisClass.openMemberCanvas();};this.openMemberCanvas=function(){if(MF_Permission.deny(thisClass.projectController.selectedProject,"canViewMembers")){MF_Utils.display_ActionIndicator("Permission denied by project owner: To view members");}else{this.openProjectView();mf_main.interfaceResize();thisClass.projectController.renderPublicAccess();thisClass.projectController.listMembers();}};this.toggleLabelsSideBar=function(e){e.stopImmediatePropagation();$("#mfDashSidebarBackground").show();$("#mfControl").toggle();$("#mfControl").css("right","-350px");$("#mfControl").transition({right:"0px",easing:"easeOutExpo",duration:500,complete:function(){}});};this.closeLabelSideBar=function(){$("#mfDashSidebarBackground").hide();$("#mfControl").hide();};this.appListHandler=function(e){thisClass.listIntegrations();$("#mfMobileAppListModal").modal();};this.listIntegrations=function(){if(thisClass.integrationListed==false){var integrations=[{iconurl:"images/dashboard/mobileAppModal/androidIcon.png",integrationName:"Android",desc:"Full featured android mobile app for DesignCollab",sourcelink:"https://play.google.com/store/apps/details?id=com.mockflow.designcollab&hl=en",btnurl:"images/dashboard/mobileAppModal/mfGooglePlayBtn.png",backgroundcolor:"#eaf1dc"}];var cachedTemplate=mf_main.getTemplateFromCache("mfMobileAppItemTemplate");if(cachedTemplate==null){var template=Handlebars.compile($("#mfMobileAppItemTemplate").html());mf_main.addTemplateToCache("mfMobileAppItemTemplate",template);thisClass.renderIntegrationItems(template,integrations);}else{thisClass.renderIntegrationItems(cachedTemplate,integrations);}}};this.renderIntegrationItems=function(template,integrations){$("#mfMobileAppListing").empty();var len=integrations.length;var htmldom="";for(var i=0,j=len;i<j;i++){var nitem=integrations[i];htmldom=htmldom+template(nitem);}$("#mfMobileAppListing").append(htmldom);thisClass.integrationListed=true;};this.getDashboardProjects=function(clearExistingList){if(clearExistingList){$("#mfDesignSets").empty();$("#mfDesignSets").hide();$("#mfProjectListLoader").show();}thisClass.projectListLatestCall=new Date().getTime();MF_AccountManager.getDashboardProjects(MF_UserSession.getUser(),thisClass.projectListStartIndex,thisClass.projectListLength,thisClass.projectListSearchText,thisClass.projectListLabel,{callback:function(projectList,callTimestamp){if(callTimestamp!=thisClass.projectListLatestCall){return;}if(clearExistingList){$("#mfDesignSets").empty();}var cachedProjectItemTemplate=mf_main.getTemplateFromCache("mfProjectItemTemplate");thisClass.listProjects(cachedProjectItemTemplate,projectList,clearExistingList);thisClass.isLazyLoadInProgress=false;},arg:thisClass.projectListLatestCall});};this.projectListScrollHandler=function(){if(!thisClass.isLazyLoadInProgress&&!thisClass.allProjectsLoaded&&parseInt($("#mfDesignSets").scrollTop())+parseInt($("#mfDesignSets").innerHeight())+10>parseInt($("#mfDesignSets")[0].scrollHeight)){thisClass.isLazyLoadInProgress=true;$("#mfDesignSets").append($("#mfProjectListPaginationLoader").html());thisClass.projectListStartIndex=thisClass.projectListStartIndex+thisClass.projectListLength;thisClass.getDashboardProjects(false);}};this.closeRTCNotificationSection=function(){$("#mfProjectNotificationMessageContainer").empty();$("#mfProjectNotificationMessageWrapper").hide();};}function MF_Main(){var thisClass=this;this.UID=MF_Utils.guidGenerator();this.PUBLICID="";this.teamController=new MF_TeamController();this.dashboardController=new MF_DashboardController();this.logController=new MF_LogController();this.rtsController=new MF_RTSController();this.dashboardRtcController=new MF_DashboardRTCController();this.gname="";this.gsessionid="";this.gappAccess=false;this.glogin=false;this.gAccess=false;this.cachedTemplates=new Object();this.onLoadInterface=function(){thisClass.interfaceResize();$("#mfDashboardInterface").show();thisClass.dashboardRtcController.connect();dwr.engine.setErrorHandler(thisClass.errorDWRHandler);$("#mfDashboardProfileImg").css("background-image","url('"+MF_Utils.get_gravatar(MF_UserSession.getUser().username,32)+"')");$("#mfAccountMenuLogout").on("click",thisClass.logoutHandler);$("#mfAccountMenuUpgrade").on("click",thisClass.openUpgradeModal);$("#mfAccountMenuHelp").on("click",thisClass.openHelpLink);thisClass.changeUIByPermission();$(".mfLoginApp").click(function(e){e.stopImmediatePropagation();var lid=$(this).attr("id");var publicid=MF_Utils.guidGenerator();var privateid=MF_Utils.guidGenerator();var url="https://mockflow.com";if(lid=="mfLoginWebsitePro"){url="https://websitepro.mockflow.com/index.jsp?publicid="+mf_main.PUBLICID+"&from=designcollab";}if(lid=="mfLoginWireframe"){url="https://app.mockflow.com/index.jsp?publicid="+mf_main.PUBLICID+"&from=designcollab";}if(lid=="mfLoginDesignCollab"){url="https://designcollab.mockflow.com/index.jsp?publicid="+mf_main.PUBLICID+"&from=designcollab";}if(lid=="mfLoginAnnotatePro"){url="https://annotatepro.mockflow.com/index.jsp?publicid="+mf_main.PUBLICID+"&from=designcollab";}if(lid=="mfLoginBannerPro"){url="https://bannerpro.mockflow.com/index.jsp?publicid="+mf_main.PUBLICID+"&from=designcollab";}if(lid=="mfLoginTimeline"){url="https://timeline.mockflow.com/index.jsp?publicid="+mf_main.PUBLICID+"&from=designcollab";}$("#mfAppSwitchLoader").height($(window).height());$("#mfAppSwitchLoaderIcon").css({position:"absolute",top:($("#mfAppSwitchLoader").height()/2-100),left:($("#mfAppSwitchLoader").width()/2-20),});$("#mfAppSwitchLoader").show();window.open(url,"_self");mf_main.PUBLICID=publicid;MF_Authentication.addSecureKeyHash(MF_UserSession.getUser(),publicid,privateid,{callback:function(str){}});});$("#mfOpenTeamBtn").on("click",thisClass.openTeamModalHandler);$("#mfUpgradePromo").on("click",thisClass.openUpgradeModal);this.teamController.constructor();this.dashboardController.constructor();this.logController.constructor();this.registerHandlebarHelpers();$("#mfContentLoaderSpinner").css("display","block");mf_main.interfaceResize(true);var publicid=MF_Utils.guidGenerator();var privateid=MF_Utils.guidGenerator();thisClass.PUBLICID=publicid;MF_Authentication.addFirstSecureKeyHash(MF_UserSession.getUser(),publicid,privateid,{callback:function(str){}});thisClass.dashboardController.fetchDashboardData();$(".close").on("click",thisClass.closeHandler);$("html").on("click",thisClass.closePopUpHandler);$(".mfImgLink").on("mouseover",thisClass.imgLinkOver);$(".mfImgLink").on("mouseout",thisClass.imgLinkOut);$("#mfNewProjectBtn").tooltip({animation:false,placement:"right"});$('[data-ptoggle="Pricingtooltip"]').tooltip();};this.menuBtnHandler=function(e){e.stopImmediatePropagation();if($("#mfAccountMenuBoxModal").css("display")=="block"){$("#mfAccountMenuBoxModal").css("display","none");}else{$("#mfAccountMenuBoxModal").css("display","block");var rect=MF_Utils.localToGlobal(document.getElementById("mfAccountMenuBtn"));$("#mfAccountMenuBoxModal").css("left",((rect.left+40)-($("#mfAccountMenuBoxModal").width()))+"px");$("#mfAccountMenuBoxModal").css("top",(rect.top+20)+"px");}};this.errorDWRHandler=function(){};this.openUpgradeModal=function(){window.open("https://mockflow.com/pricing");};this.openHelpLink=function(){window.open("https://mockflow.com/apps/designcollab");};this.imgLinkOver=function(e){$(this).css("opacity",0.5);};this.imgLinkOut=function(e){$(this).css("opacity",1);};this.addTemplateToCache=function(key,template){this.cachedTemplates[key]=template;};this.getTemplateFromCache=function(key){return this.cachedTemplates[key];};this.openTeamModalHandler=function(e){$("#mfTeamModal").modal();};this.closePopUpHandler=function(){MF_Utils.hide_menu("mfProjectMenu");MF_Utils.hide_menu("mfSharedProjectMenu");MF_Utils.hide_menu("mfAdminProjectMenu");MF_Utils.hide_menu("mfTeamAlertModal");$("#mfTeamAlertModal").removeClass("animated scaleInSmall");$("#mfLoginBoxModal").css("display","none");$("#mfAccountMenuBoxModal").css("display","none");};this.logoutHandler=function(){window.open("index.jsp?logout=yes","_self");};this.closeHandler=function(){thisClass.closeDialog();};this.interfaceResize=function(resizeSets){if($("#mfAccountMenuBoxModal").css("display")=="block"){$("#mfAccountMenuBoxModal").css("display","none");}if($("#mfLoginBoxModal").css("display")=="block"){$("#mfLoginBoxModal").css("display","none");}$("#mfContentPlaceHolder").height($(window).height());$("#mfDesignBlank").height($("#mfContentPlaceHolder").height()-$("#mfDesignSetsBar").height()-5);if(resizeSets==true){$("#mfDesignSets,#mfProjectListLoader").width($(window).width()-20);}if($("#mfContentLoader").css("display")=="block"){$("#mfContentLoaderSpinner").css({position:"absolute",top:"50%",left:"50%",transform:"translate3d(-50%,-50%,0)"});}if($("#mfLogCanvas").css("display")=="block"){$("#mfLogList").height($("#mfLogCanvas").height()-$("#mfLogActionBar").height()-80);}$("#mfLogListLoader").css({position:"relative",top:(($("#mfLogList").height()/2)-($("#mfLogListLoader").height()/2))-20,left:(($("#mfLogList").width()/2)-($("#mfLogListLoader").width()/2))-10});if(thisClass.dashboardController){thisClass.dashboardController.interfaceResize();}if(thisClass.dashboardController&&thisClass.dashboardController.alertController){thisClass.dashboardController.alertController.centerNotificationBubble();}thisClass.closePopUpHandler();if($("#mfMemberCanvas").css("display")=="block"){if($("#mfProjectPermissionUi").css("display")=="block"){$("#mfMemberCanvas").height($(window).height()-195-$("#mfProjectPermissionUi").height());}else{$("#mfMemberCanvas").height($(window).height()-195);}$("#mfMemberList").height($("#mfMemberCanvas").height()-$("#mfMemberActionBar").height()-$("#mfMemberAccessBar").height()-120);$("#mfMemberListLoader").css({position:"relative",top:(($("#mfMemberList").height()/2)-($("#mfMemberListLoader").height()/2))-20,left:(($("#mfMemberList").width()/2)-($("#mfMemberListLoader").width()/2))-10});if($("#mfMemberBlankImage").css("display")=="block"){$("#mfMemberBlankImage").css({position:"relative",top:(($("#mfMemberList").height()/2)-(134/2))-20});}}if($("#mfSubFailedModal").css("display")=="block"){$("#mfSubFailedModal").css({position:"absolute",top:(($(window).height()/2)-($("#mfSubFailedModal").height()/2)),left:(($(window).width()/2)-($("#mfSubFailedModal").width()/2))});$("#mfSettingsBackground").height($(window).height());$("#mfSettingsBackground").width($(window).width());}$("#mfShareModal").hide();};this.changeUIByPermission=function(){if(MF_UserSession.getUser().isNewLicense&&!MF_UserSession.getUser().teamPremium){$("#mfAddEditorBtn").css("opacity",0.3);$("#mfAddAdminBtn").css("opacity",0.3);$("#mfSharePermissionTxt").show();}if(MF_UserSession.getUser().isNewLicense&&MF_UserSession.getUser().teamPremium){$("#mfSharePermissionTxt").show();$("#mfSharePermissionTxt").html("<strong>Note:</strong> Users with free basic license cannot co-edit projects shared to them");}};this.registerHandlebarHelpers=function(){Handlebars.registerHelper("permissionTypeMsg",function(project){if(MF_UserSession.getUser()&&project.company!=MF_UserSession.getUser().company){return"Shared as '"+project.permissionType+"' by "+project.creator+"";}else{return"Owned by me";}});Handlebars.registerHelper("localUpdateDate",function(project){return project.updateDate.toLocaleString();});};this.closeDialog=function(){$(".modal").modal("hide");if($("#mfShareModal").is(":visible")){$("#mfShareModal").hide();}};}function receiveRTS(txt){alert(txt);}function MF_Login(){var thisClass=this;this.constructor=function(){$("#login_btn").on("click",thisClass.loginHandler);$("#forgot_btn").on("click",thisClass.forgotPasswordHandler);};this.isValidEmailAddress=function(emailAddress){var pattern2=new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);return pattern2.test(emailAddress);};this.loginHandler=function(e){$("#login_btn").css("opacity","0.5");$(".error").hide();var email=$("input#username").val();if(email!=""){if(!thisClass.isValidEmailAddress(email)){$("input#username").focus();$("#login_btn").css("opacity","1");alert("Invalid E-mail address");return false;}}else{$("input#username").focus();$("#login_btn").css("opacity","1");alert("Email is required");return false;}var password=$("input#password").val();if(password==""){$("input#password").focus();$("#login_btn").css("opacity","1");alert("Password is Required");return false;}var remember=true;$("#rememberme").val("true");$("#login_btn").hide();$("#loging_btn").show();return true;};this.rememberMeClickHandler=function(e){e.stopPropagation();var remember=true;};this.forgotPasswordHandler=function(e){$(".error").hide();var email=$("input#username").val();if(email!=""){if(!thisClass.isValidEmailAddress(email)){$("input#username").focus();alert("Invalid E-mail address");return;}}else{$("input#username").focus();alert("Email is required");return;}alert("Check E-mail for resetting Password.  (If not received check Spam folder) ");$.post("forgotPassword.jsp",{uname:email},function(data){data=jQuery.trim(data);if(data=="success"){}else{alert("Some error occurred, is this an registered E-mail?");}});return;};}var gBtnClicked=false;function gBtnHandler(){gBtnClicked=true;}function signinSuccessCallback(authResult){if(gBtnClicked==true){}else{return;}var profile=authResult.getBasicProfile();var id_token=authResult.getAuthResponse().id_token;var publicmid=guidGenerator();var privatemid=guidGenerator();$("#signinButton").hide();$("#mfGoogleSignin").show();$.post("glogin.jsp",{publicid:publicmid,privateid:privatemid,email:profile.getEmail(),dname:profile.getGivenName(),gtoken:id_token,userid:profile.getId()},function(data){data=data.trim();if(data=="pdlsuccess"){window.location.replace("index.jsp");}else{$("#signinButton").show();$("#mfGoogleSignin").hide();alert("Authentication via Google Failed");}});}function signinFailCallback(authResult){console.log("Sign-in state: "+authResult.error);}function guidGenerator(){var S4=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1);};return(S4()+S4()+S4()+S4()+S4()+S4()+S4()+S4());}function MF_ProjectController(){var thisClass=this;this.projectCollection=new ArrayCollection();this.selectedProject=null;this.recentProject=null;this.mouseOverProjectID=null;this.selectedMember=null;this.currentOpenedProject=null;this.currentProjectInfoLoaded=false;this.collaborators=new ArrayCollection();this.logCollection=new ArrayCollection();this.shareController=new MF_ShareController();this.searchInProgress=false;this.constructor=function(){$("#mfSearchProjectsInput").on("input",thisClass.searchProjectsHandler);$("#mfMemberAccessBtn,.mfMemberAccessShareLink,.mfMemberAccessRemoveLink").on("click",thisClass.publicAccessHandler);$("#mfPublicLinkCreateBtn").on("click",thisClass.createPublicURLHandler);$("#mfNewProjectBtn").on("click",thisClass.openNewProjectModalHandler);$("#mfNewProjectModal").on("show",thisClass.newShowHandler);$("#mfNewProjectModal").on("shown",thisClass.newShownHandler);$("#mfNewProjectModalCloseBtn").on("click",thisClass.closeHandler);$("#mfNewProjectModalBtn").on("click",thisClass.createNewProject);$("#mfGoBackProjectTypeBtn").on("click",thisClass.openProjectTypeHandler);$("#newProjectTitle").keypress(function(e){if(e.which==13){thisClass.createNewProject();}});$(".mfNewProjectTypeBtn").on("mouseover",thisClass.newProjectTypeBtnOver);$(".mfNewProjectTypeBtn").on("mouseout",thisClass.newProjectTypeBtnOut);$(".mfNewProjectTypeBtn").on("click",thisClass.newProjectTypeBtnClick);$("#mfDelProjectModal").on("show",thisClass.delShownHandler);$("#mfDelProjectModalCloseBtn").on("click",thisClass.closeHandler);$("#mfDelProjectModalBtn").on("click",thisClass.delProjectHandler);$("#mfReadonlyProjectModalOkBtn").on("click",thisClass.readonlyProjectHandler);$("#mfReadonlyProjectModalUpgradeBtn").on("click",thisClass.readonlyProjectHandler);$("#mfReadonlyProjectModalCloseBtn").on("click",thisClass.closeHandler);$("#mfRenameProjectModal").on("show",thisClass.renameShowHandler);$("#mfRenameProjectModal").on("shown",thisClass.renameShownHandler);$("#mfRenameProjectModalText").keypress(function(e){if(e.which==13){thisClass.renameProjectHandler();}});$("#mfShareMailMemberBtn").on("click",thisClass.memberInviteHandler);$("#mfShareDelMemberBtn").on("click",thisClass.memberDeleteHandler);$("#mfShareChangeMemberBtn").on("click",thisClass.memberModifyHandler);$("#mfRenameProjectModalCloseBtn").on("click",thisClass.closeHandler);$("#mfRenameProjectModalBtn").on("click",thisClass.renameProjectHandler);$("#mfCopyProjectBtn").on("click",thisClass.copyProjectHandler);$("#mfOpenMenuOpenBtn").on("click",thisClass.openMenuOpenHandler);$("#mfOpenMenuShareBtn").on("click",thisClass.openMenuShareHandler);$("#mfOpenMenuLogBtn").on("click",thisClass.openMenuLogHandler);$("#mfOpenMenuReadonlyBtn").on("click",thisClass.openMenuReadonlyHandler);$("#mfOpenMenuDelBtn").on("click",thisClass.openMenuDelHandler);$("#mfOpenMenuDelLabelBtn").on("click",thisClass.openMenuDelLabelHandler);$("#mfOpenMenuDuplicateBtn").on("click",thisClass.openMenuDuplicateHandler);$("#mfOpenMenuCopyBtn").on("click",thisClass.openMenuCopyHandler);$("#mfOpenMenuExportBtn").on("click",thisClass.openMenuExportHandler);$("#mfOpenMenuRenameBtn").on("click",thisClass.openMenuRenameHandler);$("#mfOpenMenuPublicBtn,#mfMemberAccessEdit").on("click",thisClass.openMenuPublicHandler);$("#mfProjectLabelsList").on("click",thisClass.openManageLabelsHandler);$("#mfOpenAdminMenuOpenBtn").on("click",thisClass.openSharedMenuOpenHandler);$("#mfOpenAdminMenuShareBtn").on("click",thisClass.openSharedMenuMembersHandler);$("#mfOpenAdminMenuLogBtn").on("click",thisClass.openSharedMenuLogHandler);$("#mfOpenAdminMenuDelBtn").on("click",thisClass.openSharedMenuDelHandler);$("#mfOpenAdminMenuDelLabelBtn").on("click",thisClass.openSharedMenuDelLabelHandler);$("#mfOpenAdminMenuDuplicateBtn").on("click",thisClass.openMenuDuplicateHandler);$("#mfOpenAdminMenuCopyBtn").on("click",thisClass.openMenuCopyHandler);$("#mfOpenAdminMenuExportBtn").on("click",thisClass.openMenuExportHandler);$("#mfOpenAdminMenuPublicBtn").on("click",thisClass.openMenuPublicHandler);$("#mfOpenAdminMenuLabelsBtn").on("click",thisClass.openManageLabelsHandler);$("#mfOpenAdminMenuRenameBtn").on("click",thisClass.openMenuRenameHandler);$("#mfOpenSharedMenuOpenBtn").on("click",thisClass.openSharedMenuOpenHandler);$("#mfOpenSharedMembersOpenBtn").on("click",thisClass.openSharedMenuMembersHandler);$("#mfOpenSharedMenuLogBtn").on("click",thisClass.openSharedMenuLogHandler);$("#mfOpenSharedMenuRenameBtn").on("click",thisClass.openSharedMenuRenameHandler);$("#mfOpenSharedMenuCloneBtn").on("click",thisClass.openSharedMenuDuplicateHandler);$("#mfOpenSharedMenuDelLabelBtn").on("click",thisClass.openSharedMenuDelLabelHandler);$("#mfOpenSharedMenuDelBtn").on("click",thisClass.openSharedMenuDelHandler);$("#mfOpenSharedMenuExportBtn").on("click",thisClass.openSharedMenuExportHandler);$("#mfOpenSharedMenuLabelsBtn").on("click",thisClass.openManageLabelsHandler);thisClass.shareController.constructor();$("#mfProjectSBOpenBtn").on("click",thisClass.openProjectBtnHandler);$("#mfProjectSBMenuBtn").on("click",thisClass.menuIconClick);$("#mfManageLabelsModalSaveBtn").on("click",thisClass.saveProjectLabels);$("#mfPublicLinkresetURL").on("click",thisClass.resetPublicURL);$("#mfCopyToClipboardBtn, #mfPublicUrlCopy").tooltip({animation:false,placement:"top"});$("#mfCopyToClipboardBtn").on("click",thisClass.handleCopyToClipboard);$("#mfPublicUrlCopy").on("click",thisClass.handleDashboardCopyLink);$("#mfDashboardEmptyTrashBtn").on("click",thisClass.emptyTrashHandler);};this.handleDashboardCopyLink=function(){var urlValue=$("#mfMemberAccessURL").attr("href");$("#mfPublicUrlCopyVal").val(urlValue);MF_Utils.copyToClipBoard($("#mfPublicUrlCopyVal"));};this.handleCopyToClipboard=function(){var urlValue=$(".mfTextboxWrapper").text().trim()+$("#mfPublicAccessURL").val();$("#mfPublicAccessURLVal").val(urlValue);MF_Utils.copyToClipBoard($("#mfPublicAccessURLVal"));};this.logListOver=function(e){$("#mfLogList").css("overflow-y","auto");};this.logListOut=function(e){$("#mfLogList").css("overflow-y","hidden");};this.openMenuOpenHandler=function(e){thisClass.openProject(thisClass.selectedProject);};this.openMenuShareHandler=function(e){mf_main.dashboardController.showMemberList();};this.openMenuLogHandler=function(e){mf_main.dashboardController.showLogList();};this.openSharedMenuOpenHandler=function(e){thisClass.openProject(thisClass.selectedProject);};this.openSharedMenuMembersHandler=function(e){mf_main.dashboardController.showMemberList();};this.openSharedMenuLogHandler=function(e){mf_main.dashboardController.showLogList();};this.openSharedMenuRenameHandler=function(e){MF_Utils.display_ActionIndicator("Only Project Owner and Admins can rename project");};this.openSharedMenuDelLabelHandler=function(e){thisClass.openMenuDelLabelHandler(null);};this.openMenuExportHandler=function(e){mf_main.closeDialog();thisClass.openProject(thisClass.selectedProject,"",true,"export");};this.openSharedMenuExportHandler=function(e){mf_main.closeDialog();thisClass.openProject(thisClass.selectedProject,"",true,"export");};this.openMenuCopyHandler=function(e){mf_main.closeDialog();if(MF_UserSession.getUser().isTrial||MF_UserSession.getUser().hadTrial){alert("Sorry!, This feature is disabled for Trial Licenses.");return;}$("#mfCopyProjectModalScreen2").hide();$("#mfCopyProjectModalScreen1").show();$("#mfCopyProjectModalTitle").text("For: "+thisClass.selectedProject.title);$("#mfCopyProjectModalText").val("");$("#mfCopyProjectModal").modal();};this.openMenuDuplicateHandler=function(e){if(MF_UserSession.createAllowed()){var answer=confirm('This will create a new version of this project "'+thisClass.selectedProject.title+'"  Continue?');if(answer){mf_main.dashboardController.closeSidebar();$("#mfDuplicateProjectModal").modal();MF_ProjectManager.duplicate(MF_UserSession.getUser(),MF_UserSession.getUser().company,thisClass.selectedProject,MF_Utils.guidGenerator(),{callback:function(str){mf_main.dashboardController.refreshHandler(null);mf_main.closeDialog();}});}}else{var answer=confirm(MF_UserSession.createAllowedAlertMsg());if(answer){mf_main.openUpgradeModal();return;}}};this.openSharedMenuDuplicateHandler=function(e){if(MF_Permission.deny(thisClass.selectedProject,"canDuplicateProject")){MF_Utils.display_ActionIndicator("Permission denied by project owner: To Clone Project");}else{if(MF_UserSession.createAllowed()){var answer=confirm('This will create a new version of this project "'+thisClass.selectedProject.title+'"  Continue?');if(answer){MF_Utils.display_ActionIndicator("Duplicating Project: "+thisClass.selectedProject.title);MF_ProjectManager.duplicateSharedProject(thisClass.selectedProject.company,thisClass.selectedProject,MF_UserSession.getUser().username,{callback:function(str){mf_main.dashboardController.refreshHandler(null);}});}}else{var answer=confirm(MF_UserSession.createAllowedAlertMsg());if(answer){mf_main.openUpgradeModal();return;}}}};this.openSharedMenuDelHandler=function(e){var answer=confirm('Remove access from this project "'+thisClass.selectedProject.title+'" ?');if(answer){var delProject=thisClass.selectedProject;mf_main.dashboardController.closeSidebar();$("#mfProjectItem"+delProject.id).css("height","0px");$("#mfProjectItem"+delProject.id).css("display","none");var pind=thisClass.projectCollection.getItemIndex(delProject);if(pind!=-1){thisClass.projectCollection.removeItemAt(pind);}for(var j=0;j<mf_main.dashboardController.labelController.labelCollection.size();j++){mf_main.dashboardController.labelController.removeProjectFromLabel(delProject.id,mf_main.dashboardController.labelController.labelCollection.getItemAt(j));}mf_main.dashboardController.labelController.removeProjectFromDefaultLabel(delProject,false);mf_main.rtsController.sendRefreshDashboard();$("#mfDesignSets").hide();$("#mfProjectListLoader").show();MF_ProjectManager.deleteSharedProject(MF_UserSession.getUser(),delProject.id,{callback:function(str){mf_main.dashboardController.labelController.selectLabelUI("all");mf_main.dashboardController.projectListLabel="all";mf_main.dashboardController.projectListStartIndex=0;mf_main.dashboardController.getDashboardProjects(true);try{var collaboratorsCollection=[];collaboratorsCollection=MF_Utils.getDashboardRTCCollabrators();var rtcObj=new MF_DashboardRTCNotificationItem();rtcObj.collabarators=collaboratorsCollection.slice(0);rtcObj.messageStr='has left from the project "'+mf_main.dashboardController.projectController.selectedProject.title+'"';mf_main.dashboardRtcController.projectShareSync("project_sync",rtcObj);}catch(error){console.log(error);}}});}};this.openNewProjectModalHandler=function(){$("#mfNewProjectModal").modal();};this.closeHandler=function(){$(".modal").modal("hide");};this.bindMoreiconEvents=function(){$(".projectItemOverRestoreBtn").click(thisClass.restoreFromTrashHandler);$(".projectItemOverDeleteFromTrashBtn").click(thisClass.deleteFromTrashcan);$(".mfReadonlyProjectRestoreBtn").click(thisClass.restoreFromArchiveHandler);$(".mfReadonlyProjectPreviewBtn").click(function(e){e.stopImmediatePropagation();var projectID=$(this).attr("data-projectid");var project=thisClass.getProjectByID(projectID);thisClass.openProject(project);});};this.addProjectToTemplate=function(project){$("#mfProjectItem"+project.id).on("click",thisClass.projectItemClick);};this.openProjectHandler2=function(e){e.stopImmediatePropagation();var projectID=$(this).attr("id");var project=thisClass.getSelectedProject2("mfProjectItemThumbBlank",projectID);thisClass.openProject(project);};this.openProjectHandler3=function(e){e.stopImmediatePropagation();var projectID=$(this).attr("id");var project=thisClass.getSelectedProject2("mfProjectItemThumbImg",projectID);thisClass.openProject(project);};this.getSelectedProject2=function(did,pid){for(var i=0;i<thisClass.projectCollection.size();i++){var item=thisClass.projectCollection.getItemAt(i);if(did+item.id==pid){return item;}}return null;};this.openProjectHandler=function(e){var projectID=$(this).attr("id");var project=thisClass.getSelectedProject(projectID);thisClass.openProject(project);};this.openProjectBtnHandler=function(e){e.stopImmediatePropagation();thisClass.openProject(thisClass.selectedProject);};this.openProject=function(project,template,comment,varid){if(!MF_UserSession.IsOpenAllowed()&&project.company==MF_UserSession.getUser().company){if(MF_UserSession.getUser().hadTrial){alert("Your Trial Period has expired. Upgrade account for continued access");}else{alert("Resubscribe to MockFlow for accessing projects");}mf_main.openUpgradeModal();return;}var publicid=MF_Utils.guidGenerator();var privateid=MF_Utils.guidGenerator();var ptype=project.permissionType;if(ptype==null||ptype=="null"){ptype="Owner";}var readonlyvar="";if(project.readonly){readonlyvar="&readonly=true";}if(template==null){template="";}var url="index.jsp?editor=on&publicid="+mf_main.PUBLICID+"&projectid="+project.id+"&perm="+ptype+readonlyvar;if(comment==true){url=url+"&comment=on&varid="+varid;}window.open(url);mf_main.PUBLICID=publicid;MF_Authentication.addSecureKeyHash(MF_UserSession.getUser(),publicid,privateid,{callback:function(str){}});};this.openProjectById=function(projectid,template,comment,varid){var publicid=MF_Utils.guidGenerator();var privateid=MF_Utils.guidGenerator();var url="index.jsp?editor=on&publicid="+mf_main.PUBLICID+"&projectid="+projectid+"&perm=Owner";if(comment==true){url=url+"&comment=on&varid="+varid;}window.open(url);mf_main.PUBLICID=publicid;MF_Authentication.addSecureKeyHash(MF_UserSession.getUser(),publicid,privateid,{callback:function(str){}});};function clearProjectSelection(){}this.menuIconClick=function(e){e.stopImmediatePropagation();var menuBtn="";if(thisClass.selectedProject.owner){menuBtn="mfProjectMenu";}else{if(thisClass.selectedProject.permissionType=="Admin"){menuBtn="mfAdminProjectMenu";}else{menuBtn="mfSharedProjectMenu";}}if($("#"+menuBtn).css("display")=="block"){$("#"+menuBtn).css("display","none");}else{$("#"+menuBtn).css("display","block");$("#"+menuBtn).css("left",$("#mfDashSidebar").position().left+186);$("#"+menuBtn).css("top",($("#mfProjectSBMenuBtn").position().top+35)+"px");}if(thisClass.selectedProject.flash||thisClass.selectedProject.readonly){$("#mfOpenMenuReadonlyBtn").hide();}else{$("#mfOpenMenuReadonlyBtn").show();}};this.moreIconOver=function(e){$(this).css({opacity:1});$(this).css("cursor","pointer");};this.moreIconOut=function(e){$(this).css({opacity:0.5});$(this).css("cursor","default");};this.projectItemOver=function(e){thisClass.mouseOverProjectID=$(this).attr("id");var currentProjectID=thisClass.mouseOverProjectID.replace("mfProjectItem","");$("#mfProjectItemOver"+currentProjectID).show();};this.showProjectInformation=function(){if(mf_main.dashboardController.infoShowed==false){var cachedTemplate=mf_main.getTemplateFromCache("mfProjectInfoTemplate");if(cachedTemplate==null){$.get("templates/dashboard/ProjectInfo.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfProjectInfoTemplate").html());mf_main.addTemplateToCache("mfProjectInfoTemplate",template);thisClass.renderProjectInformation(template);});}else{thisClass.renderProjectInformation(cachedTemplate);}}};this.renderProjectInformation=function(template){$("#mfInfoCanvas").empty();$("#mfInfoCanvas").append(template(thisClass.selectedProject));mf_main.dashboardController.infoShowed=true;};this.addProjectMemberToTemplate=function(member){};this.showMemberHandler=function(e){e.stopImmediatePropagation();thisClass.mouseOverProjectID=$(this).attr("id");thisClass.selectProject(thisClass.mouseOverProjectID.replace("mfProjectItemMembers","mfProjectItem"));mf_main.dashboardController.showMemberList();};this.showCommentsHandler=function(e){e.stopImmediatePropagation();thisClass.mouseOverProjectID=$(this).attr("id");thisClass.selectProject(thisClass.mouseOverProjectID.replace("mfProjectItemComments","mfProjectItem"));thisClass.openProject(thisClass.selectedProject,"",true,"all");};this.projectItemOut=function(e){$(".projectItemTemplateOver").hide();};this.selectProject=function(pid){clearProjectSelection();for(var i=0;i<thisClass.projectCollection.size();i++){var item=thisClass.projectCollection.getItemAt(i);if("mfProjectItem"+item.id==pid){thisClass.selectedProject=item;thisClass.currentProjectInfoLoaded=false;break;}}};this.getProjectByID=function(pid){for(var i=0;i<thisClass.projectCollection.size();i++){var item=thisClass.projectCollection.getItemAt(i);if(item.id==pid){return item;break;}}return null;};this.getSelectedMember=function(pid){for(var i=0;i<thisClass.collaborators.size();i++){var item=thisClass.collaborators.getItemAt(i);if("mfProjectMemberItem"+item.id==pid){return item;}}return null;};this.getSelectedProject=function(pid){for(var i=0;i<thisClass.projectCollection.size();i++){var item=thisClass.projectCollection.getItemAt(i);if("mfProjectItem"+item.id==pid){return item;}}return null;};this.projectItemClick=function(e){thisClass.selectProject($(this).attr("id"));if(!thisClass.selectedProject.isdeleted){mf_main.dashboardController.openSidebar();}};this.updateMemberCount=function(add){if(add==null){add=true;}if(thisClass.selectedProject){if(add){thisClass.selectedProject.members++;}else{thisClass.selectedProject.members--;}$("#mfProjectItemMembers"+thisClass.selectedProject.id).text(thisClass.selectedProject.members.toString());}};this.getProjectInfoData=function(){var currentProjectID=thisClass.selectedProject.id;if(thisClass.allowManageUsers()){$("#mfMemberActionBar").css("display","block");$("#mfMemberAccessBar").css("display","block");$("#mfPublicUrlCopyVal").css("display","block");}else{$("#mfMemberActionBar").css("display","none");$("#mfMemberAccessBar").css("display","none");$("#mfPublicUrlCopyVal").css("display","none");}$("#mfMemberList").html($("#mfMemberListLoaderWrapper").html());$("#mfMemberListLoader").css("display","block");$("#mfLogList").html($("#mfLogListLoaderWrapper").html());$("#mfLogListLoader").css("display","block");mf_main.interfaceResize();MF_ProjectManager.getProjectInfoData(thisClass.selectedProject.company,thisClass.selectedProject.id,{callback:function(infoData){if(infoData){if(thisClass.selectedProject.id==currentProjectID){thisClass.logCollection=new ArrayCollection();thisClass.collaborators=new ArrayCollection();var memberArr=infoData.collaborators;var logArr=infoData.log;$("#mfMemberList").empty();var cachedTemplate=mf_main.getTemplateFromCache("mfProjectMemberTemplate");if(cachedTemplate==null){$.get("templates/dashboard/ProjectMember.htm",function(templates){$("#mfMemberListLoader").css("display","none");var template=Handlebars.compile($(templates).filter("#mfProjectMemberTemplate").html());mf_main.addTemplateToCache("mfProjectMemberTemplate",template);thisClass.renderProjectMemberItems(template,memberArr);});}else{thisClass.renderProjectMemberItems(cachedTemplate,memberArr);}$("#mfLogList").empty();var cachedLogTemplate=mf_main.getTemplateFromCache("mfLogMemberTemplate");if(cachedLogTemplate==null){$.get("templates/dashboard/LogItem.htm",function(templates){$("#mfLogListLoader").css("display","none");if(thisClass.selectedProject.id==currentProjectID){var template=Handlebars.compile($(templates).filter("#mfLogItemTemplate").html());mf_main.addTemplateToCache("mfLogItemTemplate",template);thisClass.renderLogItems(template,logArr);}});}else{thisClass.renderLogItems(cachedLogTemplate,logArr);}}}}});};this.setupBlankMemberPlaceHolder=function(){$("#mfMemberList").html($("#mfMemberListBlankWrapper").html());$("#mfMemberBlankImage").css("display","block");thisClass.shareController.addBlankImageEvent();mf_main.interfaceResize();};this.listMembers=function(){thisClass.collaborators=new ArrayCollection();var currentProjectID=thisClass.selectedProject.id;if(!thisClass.selectedProject.owner){$("#mfProjectPermissionUi").removeClass("hidden");$("#mfPermissionTxt").text("Shared by "+thisClass.selectedProject.creator);}else{$("#mfProjectPermissionUi").addClass("hidden");}if(!thisClass.selectedProject.owner){$("#mfProjectPermissionUi").removeClass("hidden");$("#mfPermissionTxt").text("Shared by "+thisClass.selectedProject.creator);}else{$("#mfProjectPermissionUi").addClass("hidden");}if(thisClass.allowManageUsers()){$("#mfMemberActionBar").css("display","block");$("#mfMemberAccessBar").css("display","block");$("#mfPublicUrlCopyVal").css("display","block");}else{$("#mfMemberActionBar").css("display","none");$("#mfMemberAccessBar").css("display","none");$("#mfPublicUrlCopyVal").css("display","none");}if(thisClass.selectedProject.collaborators==null){thisClass.selectedProject.collaborators=new Array();}var memberArr=thisClass.selectedProject.collaborators;$("#mfMemberList").empty();var cachedTemplate=mf_main.getTemplateFromCache("mfProjectMemberTemplate");if(cachedTemplate==null){$.get("templates/dashboard/ProjectMember.htm",function(templates){$("#mfMemberListLoader").css("display","none");var template=Handlebars.compile($(templates).filter("#mfProjectMemberTemplate").html());mf_main.addTemplateToCache("mfProjectMemberTemplate",template);thisClass.renderProjectMemberItems(template,memberArr);});}else{thisClass.renderProjectMemberItems(cachedTemplate,memberArr);}};this.renderProjectMemberItems=function(template,memberArr){$("#mfMemberList").empty();thisClass.collaborators=new ArrayCollection();if(memberArr.length==0){thisClass.setupBlankMemberPlaceHolder();}else{$("#mfMemberBlankImage").css("display","none");}for(var i=0,j=memberArr.length;i<j;i++){var nitem=new MF_Collaborator();nitem.cast(memberArr[i]);thisClass.collaborators.addItem(nitem);$("#mfMemberList").append(template(nitem));thisClass.addProjectMemberToTemplate(nitem);if(thisClass.allowManageUsers()){}else{}}$(".mfProjectMemberItemCls").on("mouseover",thisClass.memberItemOver);$(".mfProjectMemberItemCls").on("mouseout",thisClass.memberItemOut);$(".mfProjectMemberItemCls").on("click",thisClass.memberItemClick);};this.memberModifyHandler=function(e){var selectedMember=thisClass.selectedMember;if(selectedMember!=null){thisClass.shareController.hideAllCanvas();$("#mfShareModalTitle").text("Select Permission");$("#mfShareModalTypeScreen").show();}};this.memberItemClick=function(e){e.stopImmediatePropagation();if(thisClass.allowManageUsers()){}else{return false;}var selClass=$(this).attr("id");var selectedMember=thisClass.getSelectedMember(selClass);if(selectedMember!=null){if(thisClass.selectedMember==selectedMember){if($("#mfShareModal").is(":visible")){$("#mfShareModal").hide();return;}}thisClass.selectedMember=selectedMember;thisClass.shareController.changeMember=selectedMember;thisClass.shareController.changeMode=true;thisClass.shareController.hideAllCanvas();thisClass.shareController.showShareModal();}};this.memberItemOver=function(e){$(this).css({opacity:"0.5"});};this.memberItemOut=function(e){$(this).css({opacity:"1"});};this.allowManageUsers=function(){var allowEditing=false;if(thisClass.selectedProject.owner){allowEditing=true;}else{if(thisClass.selectedProject.permissionType=="Admin"){allowEditing=true;}}return allowEditing;};this.renderLogItems=function(template,logArr){$("#mfLogList").empty();thisClass.logCollection=new ArrayCollection();for(var i=0,j=logArr.length;i<j;i++){var nitem=new MF_Log();nitem.cast(logArr[i]);thisClass.logCollection.addItem(nitem);$("#mfLogList").append(template(nitem));}};this.memberTypeHandler=function(e){var selClass=$(this).attr("class");var selectedMember=thisClass.getSelectedMember(selClass);if(selectedMember!=null){thisClass.selectedMember=selectedMember;thisClass.shareController.changeMember=selectedMember;thisClass.shareController.changeMode=true;thisClass.shareController.showShareModal();}};this.memberInviteHandler=function(e){var selectedMember=thisClass.selectedMember;if(selectedMember!=null){mf_main.closeDialog();MF_Utils.display_ActionIndicator("Email Invitation has been sent");MF_UserManager.sendInvite(thisClass.selectedProject.company,MF_UserSession.getUser(),thisClass.selectedProject,selectedMember.userid,selectedMember.type,mf_main.gappAccess,{callback:function(){}});}};this.memberDeleteHandler=function(e){var selectedMember=thisClass.selectedMember;if(selectedMember!=null){if(thisClass.selectedProject&&(thisClass.selectedProject.permissionType=="Admin")){if(selectedMember.type=="Admin"){alert("Only Project Owner can remove Administrators.");return;}}mf_main.closeDialog();$("#mfProjectMemberItem"+selectedMember.id).css("height","0px");$("#mfProjectMemberItem"+selectedMember.id).css("display","none");thisClass.updateMemberCount(false);var cind=thisClass.collaborators.getItemIndex(selectedMember);if(cind!=-1){thisClass.collaborators.removeItemAt(cind);}if(thisClass.collaborators.size()==0){thisClass.setupBlankMemberPlaceHolder();}thisClass.selectedProject.collaborators=thisClass.collaborators.toArray();MF_UserManager.deleteCollaborator(MF_UserSession.getUser(),thisClass.selectedProject.company,thisClass.selectedProject.id,selectedMember.userid,{callback:function(){try{var rtcObj=new MF_DashboardRTCNotificationItem();rtcObj.collabarators.push(selectedMember.userid);rtcObj.messageStr='has removed you from the project "'+mf_main.dashboardController.projectController.selectedProject.title+'"';mf_main.dashboardRtcController.projectShareSync("project_share",rtcObj);var collaboratorsCollection=[];collaboratorsCollection=MF_Utils.getDashboardRTCCollabrators(selectedMember.userid);rtcObj.collabarators=collaboratorsCollection.slice(0);rtcObj.messageStr="has removed "+selectedMember.userid+' from the project "'+mf_main.dashboardController.projectController.selectedProject.title+'"';mf_main.dashboardRtcController.projectShareSync("project_sync",rtcObj);}catch(error){console.log(error);}}});mf_main.logController.logDelMember(selectedMember.userid,thisClass.selectedProject.id,thisClass.selectedProject.title);}};this.searchProjectsHandler=function(e){var searchval=$("#mfSearchProjectsInput").val().toLowerCase().trim();mf_main.dashboardController.closeSidebar();var performSearch=true;if(!thisClass.searchInProgress&&searchval.length==0){performSearch=false;}thisClass.searchInProgress=false;if(searchval.length>0){thisClass.searchInProgress=true;}if(performSearch){mf_main.dashboardController.projectListSearchText=searchval;mf_main.dashboardController.projectListStartIndex=0;mf_main.dashboardController.getDashboardProjects(true);}};this.newShowHandler=function(e){thisClass.mfNewProjectModalReset();};this.newShownHandler=function(e){$("#newProjectTitle").focus();};this.createNewProject=function(){var projectTitle=$.trim($("#newProjectTitle").val());if(projectTitle==""){alert("Project Title cannot be empty");return;}if(MF_UserSession.createAllowed()){$("#mfNewProjectModalScreen2").show();$("#mfNewProjectModalScreen1").hide();$("#mfNewProjectModalCloseBtn").hide();$("#mfNewProjectModalBtn").hide();$("#mfNewProjectModalTitle").text("Saving Project");$("#mfNewProjectModalLoader").css("left",($("#mfNewProjectModal").width()/2)-16);$("#mfNewProjectModalLoader").css("top",($("#mfNewProjectModal").height()/2)-16);$("#mfNewProjectModalBtn").attr("disabled","disabled");var p=new MF_Project();p.title=$("#newProjectTitle").val();p.id=MF_Utils.guidGenerator();p.creator=MF_UserSession.getUser().username;p.company=MF_UserSession.getUser().company;p.createDate=new Date();p.updateDate=new Date();var publicid=MF_Utils.guidGenerator();var privateid=MF_Utils.guidGenerator();mf_main.closeDialog();window.open("index.jsp?editor=on&publicid="+mf_main.PUBLICID+"&perm=Create&projectid="+p.id+"&ptitle="+encodeURIComponent(p.title));mf_main.PUBLICID=publicid;MF_Authentication.addSecureKeyHash(MF_UserSession.getUser(),publicid,privateid,{callback:function(str){}});thisClass.recentProject=p;mf_main.dashboardController.openRecentProject=true;mf_main.dashboardController.refreshHandler();try{var rtcObj=new MF_DashboardRTCNotificationItem();rtcObj.collabarators.push(MF_UserSession.getUser().username);rtcObj.messageStr='have created a project "'+projectTitle+'"';mf_main.dashboardRtcController.projectShareSync("project_share",rtcObj);}catch(error){console.log(error);}}else{var answer=confirm(MF_UserSession.createAllowedAlertMsg());if(answer){mf_main.openUpgradeModal();return;}else{return;}return;}};this.mfNewProjectModalReset=function(){$("#mfNewProjectModalScreen1").show();$("#mfNewProjectModalScreen2").hide();$("#mfNewProjectModalCloseBtn").show();$("#mfNewProjectModalBtn").show();$("#mfNewProjectModalTitle").text("New Project");$("#mfNewProjectModalBtn").removeAttr("disabled");$("#newProjectTitle").val("");};this.renameShowHandler=function(e){thisClass.renameProjectModalReset();};this.renameShownHandler=function(e){$("#mfRenameProjectModalText").focus();};this.delShownHandler=function(e){thisClass.delProjectModalReset();};this.openMenuReadonlyHandler=function(){$("#mfReadonlyProjectModal").modal();if(MF_UserSession.getUser().teamPremium&&MF_UserSession.getUser().accountType=="Enterprise"){$("#mfReadonlyModalOthersMsg,#mfReadonlyProjectModalUpgradeBtn").hide();$("#mfReadonlyModalTeamPackMsg,#mfReadonlyProjectModalOkBtn").show();}else{$("#mfReadonlyModalTeamPackMsg,#mfReadonlyProjectModalOkBtn").hide();$("#mfReadonlyModalOthersMsg,#mfReadonlyProjectModalUpgradeBtn").show();}};this.readonlyProjectHandler=function(){thisClass.closeHandler();if(MF_UserSession.getUser().teamPremium&&MF_UserSession.getUser().accountType=="Enterprise"){var archiveProject=thisClass.selectedProject;archiveProject.readonly=true;$("#mfProjectItem"+archiveProject.id).remove();mf_main.dashboardController.closeSidebar();$("#mfDesignSets").hide();$("#mfProjectListLoader").show();mf_main.dashboardController.labelController.allLabel.count--;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.allLabel.id).text(mf_main.dashboardController.labelController.allLabel.count.toString());mf_main.dashboardController.labelController.ownerLabel.count--;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.ownerLabel.id).text(mf_main.dashboardController.labelController.ownerLabel.count.toString());if(archiveProject.share){mf_main.dashboardController.labelController.publicLabel.count--;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.publicLabel.id).text(mf_main.dashboardController.labelController.publicLabel.count.toString());}if(archiveProject.awaitingApproval){mf_main.dashboardController.labelController.awaitApprovalLabel.count--;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.awaitApprovalLabel.id).text(mf_main.dashboardController.labelController.awaitApprovalLabel.count.toString());}if(archiveProject.sentForApproval){mf_main.dashboardController.labelController.sentApprovalLabel.count--;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.sentApprovalLabel.id).text(mf_main.dashboardController.labelController.sentApprovalLabel.count.toString());}if(archiveProject.approvedProject){mf_main.dashboardController.labelController.approvedLabel.count--;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.approvedLabel.id).text(mf_main.dashboardController.labelController.approvedLabel.count.toString());}mf_main.dashboardController.labelController.readonlyLabel.count++;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.readonlyLabel.id).text(mf_main.dashboardController.labelController.readonlyLabel.count.toString());mf_main.rtsController.sendRefreshDashboard();MF_ProjectManager.updateReadonlyProject(MF_UserSession.getUser(),archiveProject,{callback:function(res){if(res){mf_main.dashboardController.projectListStartIndex=0;mf_main.dashboardController.getDashboardProjects(true);try{var rtcObj=new MF_DashboardRTCNotificationItem();rtcObj.messageStr='has archived the project "'+archiveProject.title+'"';var collaboratorsCollection=[];collaboratorsCollection=MF_Utils.getDashboardRTCCollabrators();rtcObj.collabarators=collaboratorsCollection.slice(0);mf_main.dashboardRtcController.projectShareSync("project_sync",rtcObj);}catch(error){console.log(error);}}}});}else{mf_main.openUpgradeModal();}};this.openMenuDelHandler=function(e){if(mf_main.gAccess){if(MF_UserSession.getUser().isBasic){var answer=confirm('Do you want to delete this project " '+thisClass.selectedProject.title+'" permanently ?  \n\nNote: Upgrade your account to enable Trash feature\n\n');if(answer){var answer2=confirm('Are you sure you want delete this project " '+thisClass.selectedProject.title+'" permanently ?');if(answer2){thisClass.delProjectGLoginHandler();}}}else{$("#mfDelProjectModal").modal();}}else{$("#mfDelProjectModal").modal();}};this.openMenuDelLabelHandler=function(e){if(mf_main.dashboardController.labelController.selectedLabel){if(mf_main.dashboardController.labelController.selectedLabel.defaultLabel){MF_Utils.display_ActionIndicator("Cannot remove from Default labels");}else{var answer=confirm('Remove project "'+thisClass.selectedProject.title+'" from this label "'+mf_main.dashboardController.labelController.selectedLabel.name+'" (this does not remove access from the project itself). Continue?');if(answer){var newStr="";var arr=mf_main.dashboardController.labelController.selectedLabel.projects.split(",");var count=0;for(var p=0;p<arr.length;p++){var thisProjectID=arr[p];if(thisProjectID!=thisClass.selectedProject.id){if(count==0){newStr=thisProjectID;}else{newStr=newStr+","+thisProjectID;}count++;}}mf_main.dashboardController.labelController.selectedLabel.count=newStr.split(",").length-1;mf_main.dashboardController.labelController.selectedLabel.projects=newStr;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.selectedLabel.id).text(mf_main.dashboardController.labelController.selectedLabel.count.toString());mf_main.dashboardController.labelController.selectLabel("mfLabelItem"+mf_main.dashboardController.labelController.selectedLabel.id);MF_LabelManager.update(mf_main.dashboardController.labelController.selectedLabel,{callback:function(){}});}}}else{MF_Utils.display_ActionIndicator("No Label Selected");}};this.openMenuRenameHandler=function(e){$("#mfRenameProjectModal").modal();};this.openManageLabelsHandler=function(e){$("#mfShareModal").hide();$("#mfManageLabelsList").empty();var cachedTemplate=mf_main.getTemplateFromCache("mfManageLabelItemTemplate");if(cachedTemplate==null){$.get("templates/dashboard/LabelManageItem.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfManageLabelItemTemplate").html());mf_main.addTemplateToCache("mfManageLabelItemTemplate",template);thisClass.renderManageLabelListing(template);});}else{thisClass.renderManageLabelListing(cachedTemplate);}};this.renderManageLabelListing=function(template){for(var k=0;k<mf_main.dashboardController.labelController.labelCollection.size();k++){var litem=mf_main.dashboardController.labelController.labelCollection.getItemAt(k);if(!litem.defaultLabel){$("#mfManageLabelsList").append(template(litem));$("#mfManageLabelItemChk"+litem.id).attr("checked",false);if(litem.projects==null){litem.projects="";}var arr=litem.projects.split(",");for(var m=0;m<arr.length;m++){var mid=arr[m];if(mid==thisClass.selectedProject.id){$("#mfManageLabelItemChk"+litem.id).attr("checked",true);}}}}$(".mfManageLabelGlobalItemCls").off("click");$(".mfManageLabelGlobalItemCls").on("click",thisClass.saveProjectLabels);};this.saveProjectLabels=function(){var labelArr=new Array();for(var k=0;k<mf_main.dashboardController.labelController.labelCollection.size();k++){var litem=mf_main.dashboardController.labelController.labelCollection.getItemAt(k);if(litem.projects==null){litem.projects="";}if(!litem.defaultLabel){var arr=litem.projects.split(",");var projects="";var present=false;var val=MF_Utils.getCheckBoxValue("mfManageLabelItemChk"+litem.id);for(var m=0;m<arr.length;m++){var mid=arr[m];if(val){if(mid==thisClass.selectedProject.id){present=true;if(projects==""){projects=mid;}else{projects=projects+","+mid;}}else{if(projects==""){projects=mid;}else{projects=projects+","+mid;}}}else{if(mid!=thisClass.selectedProject.id){if(projects==""){projects=mid;}else{projects=projects+","+mid;}}}}if(val){if(!present){projects=projects+","+thisClass.selectedProject.id;}}litem.projects=projects;litem.count=litem.projects.split(",").length;if(litem.projects.split(",").length>0){var lb1=litem.projects.split(",")[0];if(lb1==""){litem.count=litem.count-1;}}if(litem.count<0){litem.count=0;}labelArr.push(litem);}}mf_main.closeDialog();mf_main.dashboardController.labelController.listLabels();MF_LabelManager.updateLabels(labelArr,{callback:function(){}});};this.openMenuPublicHandler=function(e){thisClass.renderPublicAccess();$("#mfPublicLinkError").hide();if(thisClass.selectedProject.publicURL==null){thisClass.selectedProject.publicURL=thisClass.selectedProject.id;}$("#mfPublicLinkresetURL").show();$("#mfPublicLinkCreateBtn").text("Create");$("#mfPublicAccessURL").val(thisClass.selectedProject.publicURL);$("#mfPublicLinkModal").modal();if(thisClass.selectedProject.share){$("#mfCopyToClipboardBtn").show();$(".mfTextboxWrapper").addClass("mfTextboxWrapperWithCopyLink");$("#mfPublicAccessURL").addClass("mfCopyToClipboardInput");}else{$("#mfCopyToClipboardBtn").hide();$(".mfTextboxWrapper").removeClass("mfTextboxWrapperWithCopyLink");$("#mfPublicAccessURL").removeClass("mfCopyToClipboardInput");}};this.delProjectModalReset=function(){$("#mfDelProjectModalScreen1").show();$("#mfDelProjectModalScreen2").hide();$("#mfDelProjectModalBtn").show();$("#mfDelProjectModalCloseBtn").show();$("#mfDelProjectModalTitle").text("Delete project");$("#mfDelProjectModalBtn").removeAttr("disabled");$("#mfDelProjectModalPass").val("");if(MF_UserSession.getUser().isBasic){$("#mfDelProjectModalNotePremium").hide();$("#mfDelProjectModalNoteBasic").show();}else{$("#mfDelProjectModalNoteBasic").hide();$("#mfDelProjectModalNotePremium").show();}if(mf_main.gAccess){$("#mfDelProjectModalScreen1 .mfModalSubTitle, #mfDelProjectModalPass").hide();}};this.renameProjectModalReset=function(){$("#mfRenameProjectModalScreen1").show();$("#mfRenameProjectModalScreen2").hide();$("#mfRenameProjectModalBtn").show();$("#mfRenameProjectModalCloseBtn").show();$("#mfRenameProjectModalTitle").text("Rename Project");$("#mfRenameProjectModalBtn").removeAttr("disabled");$("#mfRenameProjectModalText").val(thisClass.selectedProject.title);};this.renameProjectHandler=function(){var projectTitle=$.trim($("#mfRenameProjectModalText").val());if(projectTitle==""){alert("Project Title cannot be empty");return;}mf_main.dashboardController.closeSidebar();$("#mfRenameProjectModalScreen2").show();$("#mfRenameProjectModalScreen1").hide();$("#mfRenameProjectModalCloseBtn").hide();$("#mfRenameProjectModalBtn").hide();$("#mfRenameProjectModalTitle").text("Renaming Project");$("#mfRenameProjectModalBtn").attr("disabled","disabled");var oldname=thisClass.selectedProject.title;var renameProject=thisClass.selectedProject;renameProject.title=projectTitle;$("#mfRenameProjectModalText"+renameProject.id).text(renameProject.title);$("#mfProjectItemTitle"+renameProject.id).text(renameProject.title);mf_main.closeDialog();MF_ProjectManager.rename(MF_UserSession.getUser(),MF_UserSession.getUser().company,renameProject,{callback:function(str){try{var collaboratorsCollection=[];collaboratorsCollection=MF_Utils.getDashboardRTCCollabrators();var rtcObj=new MF_DashboardRTCNotificationItem();rtcObj.collabarators=collaboratorsCollection.slice(0);rtcObj.messageStr='has renamed "'+oldname+'" project as "'+projectTitle+'"';mf_main.dashboardRtcController.projectShareSync("project_sync",rtcObj);}catch(error){console.log(error);}}});mf_main.logController.logRename(oldname,thisClass.selectedProject);};this.copyProjectHandler=function(){var memberID=$("#mfCopyProjectModalText").val();if(memberID.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()){alert("You cannot share it with yourself");return;}if(memberID==""){return;}memberID=memberID.toLowerCase();if(!MF_Utils.isValidEmailAddress(memberID)){alert("Invalid email");return;}$("#mfCopyProjectModalScreen2").show();$("#mfCopyProjectModalScreen1").hide();$("#mfCopyProjectModalTitle").text("Copying Project");MF_ProjectManager.copyProject(MF_UserSession.getUser(),thisClass.selectedProject.company,thisClass.selectedProject,memberID,{callback:function(str){mf_main.closeDialog();if(str=="fail"){alert("Some error occurred in Copying Project. Try again!");}else{if(str=="notexist"||str=="basic"){alert("No MockFlow premium account exists for this email");}else{alert("Project copy transfer is complete!");}}}});};this.delProjectHandler=function(){var delProject=thisClass.selectedProject;if(mf_main.gAccess&&!MF_UserSession.getUser().isBasic&&delProject!=null){delProject.isdeleted=true;delProject.deletedon=new Date();thisClass.moveToTrashHandler(delProject);mf_main.dashboardController.closeSidebar();$("#mfProjectItem"+delProject.id).remove();mf_main.closeDialog();return;}var userpass=$("#mfDelProjectModalPass").val();if(userpass==""){alert("Your MockFlow Password is required to delete projects");return;}mf_main.dashboardController.closeSidebar();$("#mfDelProjectModalScreen2").show();$("#mfDelProjectModalScreen1").hide();$("#mfDelProjectModalCloseBtn").hide();$("#mfDelProjectModalBtn").hide();$("#mfDelProjectModalTitle").text("Deleting Project");$("#mfDelProjectModalBtn").attr("disabled","disabled");MF_Authentication.checkUser(MF_UserSession.getUser().username,userpass,true,{callback:function(str){if(str!=null){if(delProject!=null){$("#mfProjectItem"+delProject.id).fadeOut(300,function(){$(this).remove();});if(MF_UserSession.getUser().isBasic){var dind=thisClass.projectCollection.getItemIndex(delProject);if(dind!=-1){thisClass.projectCollection.removeItemAt(dind);}for(var j=0;j<mf_main.dashboardController.labelController.labelCollection.size();j++){mf_main.dashboardController.labelController.removeProjectFromLabel(delProject.id,mf_main.dashboardController.labelController.labelCollection.getItemAt(j));}mf_main.dashboardController.labelController.removeProjectFromDefaultLabel(delProject,true);mf_main.rtsController.sendRefreshDashboard();$("#mfDesignSets").hide();$("#mfProjectListLoader").show();MF_ProjectManager.deleteProject(MF_UserSession.getUser(),MF_UserSession.getUser().company,delProject.id,{callback:function(str){mf_main.dashboardController.labelController.selectLabelUI("all");mf_main.dashboardController.projectListLabel="all";mf_main.dashboardController.projectListStartIndex=0;mf_main.dashboardController.getDashboardProjects(true);try{var collaboratorsCollection=[];collaboratorsCollection=MF_Utils.getDashboardRTCCollabrators(userid);var rtcObj=new MF_DashboardRTCNotificationItem();rtcObj.collabarators=collaboratorsCollection.slice(0);rtcObj.messageStr='has deleted the project "'+mf_main.dashboardController.projectController.selectedProject.title+'"';mf_main.dashboardRtcController.projectShareSync("project_sync",rtcObj);}catch(error){console.log(error);}}});}else{delProject.isdeleted=true;delProject.deletedon=new Date();thisClass.moveToTrashHandler(delProject);}}mf_main.closeDialog();}else{alert("Authentication Failed!");thisClass.delProjectModalReset();}}});};this.setupBlankProjectPlaceHolder=function(){$("#mfDesignSets").hide();$("#mfDesignBlank").show();};this.delProjectGLoginHandler=function(){mf_main.dashboardController.closeSidebar();var delProject=thisClass.selectedProject;if(delProject!=null){$("#mfProjectItem"+delProject.id).remove();if(MF_UserSession.getUser().isBasic){var dind=thisClass.projectCollection.getItemIndex(delProject);if(dind!=-1){thisClass.projectCollection.removeItemAt(dind);}for(var j=0;j<mf_main.dashboardController.labelController.labelCollection.size();j++){mf_main.dashboardController.labelController.removeProjectFromLabel(delProject.id,mf_main.dashboardController.labelController.labelCollection.getItemAt(j));}mf_main.dashboardController.labelController.removeProjectFromDefaultLabel(delProject,true);mf_main.rtsController.sendRefreshDashboard();$("#mfDesignSets").hide();$("#mfProjectListLoader").show();MF_ProjectManager.deleteProject(MF_UserSession.getUser(),MF_UserSession.getUser().company,delProject.id,{callback:function(str){mf_main.dashboardController.labelController.selectLabelUI("all");mf_main.dashboardController.projectListLabel="all";mf_main.dashboardController.projectListStartIndex=0;mf_main.dashboardController.getDashboardProjects(true);try{var collaboratorsCollection=[];collaboratorsCollection=MF_Utils.getDashboardRTCCollabrators();var rtcObj=new MF_DashboardRTCNotificationItem();rtcObj.collabarators=collaboratorsCollection.slice(0);rtcObj.messageStr='has deleted the project "'+mf_main.dashboardController.projectController.selectedProject.title+'"';mf_main.dashboardRtcController.projectShareSync("project_sync",rtcObj);}catch(error){console.log(error);}}});}}};this.publicAccessHandler=function(){if(thisClass.selectedProject.share){thisClass.selectedProject.share=false;$("#mfMemberAccessBtn").text("Removing...");thisClass.selectedProject.publicURL=thisClass.selectedProject.id;if(!thisClass.selectedProject.readonly){mf_main.dashboardController.labelController.publicLabel.count--;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.publicLabel.id).text(mf_main.dashboardController.labelController.publicLabel.count.toString());}MF_ProjectManager.share(MF_UserSession.getUser(),thisClass.selectedProject.company,thisClass.selectedProject,{callback:function(res){if(!res){alert("Some error occurred");}else{thisClass.renderPublicAccess();}}});MF_ProjectManager.removePublicURL(MF_UserSession.getUser(),thisClass.selectedProject.company,thisClass.selectedProject,{callback:function(res){}});}else{if(MF_UserSession.getUser().hadTrial){alert("Your Trial Period has expired. Upgrade account for continued access");return;}thisClass.openMenuPublicHandler();}};this.renderPublicAccess=function(){if(thisClass.selectedProject.share){$("#mfMemberAccessIcon").attr("src","images/dashboard/unLockAccess.png");$("#mfMemberAccessBtn").text("Remove Public URL");$("#mfMemberAccessURL").css("display","inline-block");$("#mfMemberAccessURL").attr("href",MF_Global.serverURL()+"view/"+thisClass.selectedProject.publicURL);$("#mfMemberAccessEdit").css("display","inline-block");$(".mfMemberAccessShareLink ").hide();$(".mfMemberAccessRemoveLinkWrapper").show();}else{$("#mfMemberAccessIcon").attr("src","images/dashboard/lockAccess.png");$("#mfMemberAccessBtn").text("Create Public URL");$("#mfMemberAccessURL").css("display","none");$("#mfMemberAccessURL").attr("href","");$("#mfMemberAccessEdit").css("display","none");$(".mfMemberAccessShareLink").show();$(".mfMemberAccessRemoveLinkWrapper").hide();}};this.loadProjectInfoData=function(){thisClass.renderPublicAccess();if(thisClass.currentProjectInfoLoaded==false){$("#mfMemberList").empty();thisClass.currentProjectInfoLoaded=true;thisClass.getProjectInfoData();}};this.createPublicURLHandler=function(){$("#mfPublicLinkError").hide();var inputURL=$("#mfPublicAccessURL").val().trim();if(inputURL!=thisClass.selectedProject.id){var newinputURL=inputURL.replace(/[^a-zA-Z0-9_-]/g,"");if(newinputURL.length!=inputURL.length){$("#mfPublicLinkError").text("URL should not contain special characters");$("#mfPublicLinkError").show();}else{if(inputURL.length<5){$("#mfPublicLinkError").text("URL should be minimum of 5 characters");$("#mfPublicLinkError").show();}else{if(inputURL.length>200){$("#mfPublicLinkError").text("URL cannot exceed 200 characters");$("#mfPublicLinkError").show();}else{if($("#mfPublicLinkresetURL").css("display")=="none"){return;}$("#mfPublicLinkresetURL").hide();$("#mfPublicLinkCreateBtn").text("Creating...");MF_ProjectManager.createPublicURL(MF_UserSession.getUser(),thisClass.selectedProject.company,thisClass.selectedProject,inputURL,{callback:function(res){if(res=="exist"){$("#mfPublicLinkError").text("URL is not available");$("#mfPublicLinkError").show();$("#mfPublicLinkresetURL").show();$("#mfPublicLinkCreateBtn").text("Create");}else{if(res=="success"){$("#mfPublicLinkModal").modal("hide");thisClass.selectedProject.publicURL=inputURL;if(!thisClass.selectedProject.share){thisClass.selectedProject.share=true;if(!thisClass.selectedProject.readonly){mf_main.dashboardController.labelController.publicLabel.count++;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.publicLabel.id).text(mf_main.dashboardController.labelController.publicLabel.count.toString());}}thisClass.renderPublicAccess();}}}});}}}}else{thisClass.selectedProject.publicURL=thisClass.selectedProject.id;thisClass.renderPublicAccess();if($("#mfPublicLinkresetURL").css("display")=="none"){return;}$("#mfPublicLinkresetURL").hide();$("#mfPublicLinkCreateBtn").text("Creating...");if(!thisClass.selectedProject.share){thisClass.selectedProject.share=true;if(!thisClass.selectedProject.readonly){mf_main.dashboardController.labelController.publicLabel.count++;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.publicLabel.id).text(mf_main.dashboardController.labelController.publicLabel.count.toString());}MF_ProjectManager.share(MF_UserSession.getUser(),thisClass.selectedProject.company,thisClass.selectedProject,{callback:function(res){if(!res){alert("Some error occurred");}else{thisClass.renderPublicAccess();}$("#mfPublicLinkModal").modal("hide");}});}else{$("#mfPublicLinkModal").modal("hide");}MF_ProjectManager.removePublicURL(MF_UserSession.getUser(),thisClass.selectedProject.company,thisClass.selectedProject,{callback:function(res){}});}};this.resetPublicURL=function(){$("#mfPublicAccessURL").val(thisClass.selectedProject.id);thisClass.createPublicURLHandler();};this.moveToTrashHandler=function(delProject){for(var j=0;j<mf_main.dashboardController.labelController.labelCollection.size();j++){mf_main.dashboardController.labelController.removeProjectFromLabel(delProject.id,mf_main.dashboardController.labelController.labelCollection.getItemAt(j));}mf_main.dashboardController.labelController.removeProjectFromDefaultLabel(delProject,true);mf_main.rtsController.sendRefreshDashboard();$("#mfDesignSets").hide();$("#mfProjectListLoader").show();MF_ProjectManager.moveToTrashCan(MF_UserSession.getUser(),MF_UserSession.getUser().company,delProject.id,{callback:function(str){mf_main.dashboardController.labelController.selectLabelUI("all");mf_main.dashboardController.projectListLabel="all";mf_main.dashboardController.projectListStartIndex=0;mf_main.dashboardController.getDashboardProjects(true);try{var collaboratorsCollection=[];collaboratorsCollection=MF_Utils.getDashboardRTCCollabrators();var rtcObj=new MF_DashboardRTCNotificationItem();rtcObj.collabarators=collaboratorsCollection.slice(0);rtcObj.messageStr='has moved the project "'+mf_main.dashboardController.projectController.selectedProject.title+'" to trash.';mf_main.dashboardRtcController.projectShareSync("project_sync",rtcObj);}catch(error){console.log(error);}}});};this.restoreFromTrashHandler=function(e){e.stopImmediatePropagation();var confirmDelete=confirm("Are you sure you want to restore this project?");if(confirmDelete){var currentProjectID=$(this).attr("id");currentProjectID=currentProjectID.replace("mfProjectItemOverRestoreBtn","");thisClass.selectProject("mfProjectItem"+currentProjectID);var restoreProject=thisClass.selectedProject;$("#mfProjectItem"+restoreProject.id).remove();restoreProject.isdeleted=false;restoreProject.deletedon=null;mf_main.dashboardController.labelController.trashLabel.count--;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.trashLabel.id).text(mf_main.dashboardController.labelController.trashLabel.count.toString());if(!restoreProject.readonly){mf_main.dashboardController.labelController.allLabel.count++;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.allLabel.id).text(mf_main.dashboardController.labelController.allLabel.count.toString());if(restoreProject.company==MF_UserSession.getUser().company){mf_main.dashboardController.labelController.ownerLabel.count++;}if(restoreProject.company!=MF_UserSession.getUser().company){mf_main.dashboardController.labelController.sharedLabel.count++;}if(restoreProject.company==MF_UserSession.getUser().company&&restoreProject.share){mf_main.dashboardController.labelController.publicLabel.count++;}if(restoreProject.awaitingApproval){mf_main.dashboardController.labelController.awaitApprovalLabel.count++;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.awaitApprovalLabel.id).text(mf_main.dashboardController.labelController.awaitApprovalLabel.count.toString());}if(restoreProject.sentForApproval){mf_main.dashboardController.labelController.sentApprovalLabel.count++;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.sentApprovalLabel.id).text(mf_main.dashboardController.labelController.sentApprovalLabel.count.toString());}if(restoreProject.approvedProject){mf_main.dashboardController.labelController.approvedLabel.count++;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.approvedLabel.id).text(mf_main.dashboardController.labelController.approvedLabel.count.toString());}$("#mfLabelItemCount"+mf_main.dashboardController.labelController.ownerLabel.id).text(mf_main.dashboardController.labelController.ownerLabel.count.toString());$("#mfLabelItemCount"+mf_main.dashboardController.labelController.sharedLabel.id).text(mf_main.dashboardController.labelController.sharedLabel.count.toString());$("#mfLabelItemCount"+mf_main.dashboardController.labelController.publicLabel.id).text(mf_main.dashboardController.labelController.publicLabel.count.toString());}else{mf_main.dashboardController.labelController.readonlyLabel.count++;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.readonlyLabel.id).text(mf_main.dashboardController.labelController.readonlyLabel.count.toString());}if($("#mfDesignSets").find(".mfProjectItemWrapper").length==0){$("#mfDashboardEmptyTrashContainer").hide();}mf_main.rtsController.sendRefreshDashboard();MF_ProjectManager.restoreFromTrashCan(MF_UserSession.getUser(),MF_UserSession.getUser().company,restoreProject.id,{callback:function(str){try{var collaboratorsCollection=[];collaboratorsCollection=MF_Utils.getDashboardRTCCollabrators();var rtcObj=new MF_DashboardRTCNotificationItem();rtcObj.collabarators=collaboratorsCollection.slice(0);rtcObj.messageStr='has restored the project "'+mf_main.dashboardController.projectController.selectedProject.title+'" from trash.';mf_main.dashboardRtcController.projectShareSync("project_sync",rtcObj);}catch(error){console.log(error);}}});}};this.deleteFromTrashcan=function(e){e.stopImmediatePropagation();var currentProjectID=$(this).attr("data-projectid");thisClass.selectProject("mfProjectItem"+currentProjectID);var delProject=thisClass.selectedProject;var confirmDelete=confirm("Are you sure you want to permanently delete this project?");if(confirmDelete){$("#mfProjectItem"+delProject.id).remove();var dind=thisClass.projectCollection.getItemIndex(delProject);if(dind!=-1){thisClass.projectCollection.removeItemAt(dind);}if($("#mfDesignSets").find(".mfProjectItemWrapper").length==0){$("#mfDashboardEmptyTrashContainer").hide();}mf_main.dashboardController.labelController.trashLabel.count--;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.trashLabel.id).text(mf_main.dashboardController.labelController.trashLabel.count.toString());mf_main.rtsController.sendRefreshDashboard();if(delProject.flash){MF_ProjectManagerFlash.deleteMockup(MF_UserSession.getUser(),MF_UserSession.getUser().company,delProject.id,{callback:function(str){}});}else{MF_ProjectManager.deleteProject(MF_UserSession.getUser(),MF_UserSession.getUser().company,delProject.id,{callback:function(str){}});}}};this.emptyTrashHandler=function(e){e.preventDefault();var confirmDelete=confirm("Are you sure you want to permanently delete all the projects in Trash?");if(confirmDelete){var projectList=[];for(var i=0;i<thisClass.projectCollection.size();i++){var projectItem=thisClass.projectCollection.getItemAt(i);if(projectItem.isdeleted){projectList.push(projectItem);}}for(var i=0;i<projectList.length;i++){var delProject=projectList[i];var dind=thisClass.projectCollection.getItemIndex(delProject);if(dind!=-1){thisClass.projectCollection.removeItemAt(dind);}$("#mfProjectItem"+delProject.id).remove();if(delProject.flash){MF_ProjectManagerFlash.deleteMockup(MF_UserSession.getUser(),MF_UserSession.getUser().company,delProject.id,{callback:function(str){}});}else{MF_ProjectManager.deleteProject(MF_UserSession.getUser(),MF_UserSession.getUser().company,delProject.id,{callback:function(str){}});}}mf_main.dashboardController.labelController.trashLabel.count=0;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.trashLabel.id).text(mf_main.dashboardController.labelController.trashLabel.count.toString());$("#mfDashboardEmptyTrashContainer").hide();mf_main.rtsController.sendRefreshDashboard();}};this.restoreFromArchiveHandler=function(e){e.stopImmediatePropagation();if(!MF_UserSession.getUser().teamPremium||MF_UserSession.getUser().accountType!="Enterprise"){alert("The project archiving feature is available only for TeamPack users with yearly license.");return;}var confirmRestore=confirm("Are you sure you want to restore this project?");if(confirmRestore){var currentProjectID=$(this).attr("id");currentProjectID=currentProjectID.replace("mfReadOnlyProjectRestoreBtn","");thisClass.selectProject("mfProjectItem"+currentProjectID);var restoreProject=thisClass.selectedProject;$("#mfProjectItem"+restoreProject.id).remove();restoreProject.readonly=false;mf_main.dashboardController.labelController.readonlyLabel.count--;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.readonlyLabel.id).text(mf_main.dashboardController.labelController.readonlyLabel.count.toString());mf_main.dashboardController.labelController.allLabel.count++;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.allLabel.id).text(mf_main.dashboardController.labelController.allLabel.count.toString());mf_main.dashboardController.labelController.ownerLabel.count++;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.ownerLabel.id).text(mf_main.dashboardController.labelController.ownerLabel.count.toString());if(restoreProject.share==true){mf_main.dashboardController.labelController.publicLabel.count++;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.publicLabel.id).text(mf_main.dashboardController.labelController.publicLabel.count.toString());}if(restoreProject.awaitingApproval){mf_main.dashboardController.labelController.awaitApprovalLabel.count++;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.awaitApprovalLabel.id).text(mf_main.dashboardController.labelController.awaitApprovalLabel.count.toString());}if(restoreProject.sentForApproval){mf_main.dashboardController.labelController.sentApprovalLabel.count++;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.sentApprovalLabel.id).text(mf_main.dashboardController.labelController.sentApprovalLabel.count.toString());}if(restoreProject.approvedProject){mf_main.dashboardController.labelController.approvedLabel.count++;$("#mfLabelItemCount"+mf_main.dashboardController.labelController.approvedLabel.id).text(mf_main.dashboardController.labelController.approvedLabel.count.toString());}mf_main.rtsController.sendRefreshDashboard();MF_ProjectManager.restoreReadonlyProject(MF_UserSession.getUser(),restoreProject,{callback:function(str){mf_main.dashboardController.projectListStartIndex=0;mf_main.dashboardController.getDashboardProjects(true);try{var rtcObj=new MF_DashboardRTCNotificationItem();rtcObj.messageStr='has unarchived the project "'+restoreProject.title+'"';var collaboratorsCollection=[];collaboratorsCollection=MF_Utils.getDashboardRTCCollabrators();rtcObj.collabarators=collaboratorsCollection.slice(0);mf_main.dashboardRtcController.projectShareSync("project_sync",rtcObj);}catch(error){console.log(error);}}});}};}function MF_ShareController(){var thisClass=this;this.constructor=function(){$("#mfOpenShareBtn").on("click",thisClass.openShareModalHandler);$("#mfMemberBlankImage").on("click",thisClass.openShareModalHandler);$("#mfShareCloseBtn").on("click",thisClass.closeShareModalHandler);$("#mfShareAddMemberBox").on("textchange",thisClass.textChangeHandler);$("#mfShareAddMemberBox").on("keypress",thisClass.enterHandler);$("#mfShareGoBackBtn").on("click",thisClass.goBackHandler);$("#mfAddApproverBtn").on("click",thisClass.addApproverClickHandler);$("#mfAddReviewerBtn").on("click",thisClass.addReviewerClickHandler);$("#mfAddEditorBtn").on("click",thisClass.addEditorClickHandler);$("#mfAddAdminBtn").on("click",thisClass.addAdminClickHandler);$(".mfShareMemberTypeAdd").on("mouseover",thisClass.memberTypeOver);$(".mfShareMemberTypeAdd").on("mouseout",thisClass.memberTypeOut);$(".mfAdvancedPermChk").on("click",thisClass.advancedPermissionHandler);$("#mfShareMemberChkAll").on("click",thisClass.checkAllMemberHandler);$("#mfShareMemberBtn").on("click",thisClass.shareMemberHandler);$("#mfAddToUserList").on("click",thisClass.addClickHandler);};this.selectedMember=null;this.selectedMemberCollection=[];this.tempMemberType="Reviewer";this.shareMember=null;this.changeMode=false;this.changeMember=null;this.listed=false;this.advancedPermissionHandler=function(e){var $this=$(this);if(!MF_UserSession.getUser().teamPremium){if($this.is(":checked")){$(this).attr("checked",false);}else{$(this).attr("checked",true);}alert("Only users with Team-Pack licenses can set 'Advanced sharing permissions'");}};this.addBlankImageEvent=function(){$("#mfMemberBlankImage").on("click",thisClass.openShareModalHandler);};this.memberTypeOver=function(e){$(this).css({opacity:0.5});};this.memberTypeOut=function(e){$(this).css({opacity:1});};this.showShareModal=function(e){var rect=MF_Utils.localToGlobal(document.getElementById("mfOpenShareBtn"));thisClass.mfShareModalReset();$("#mfShareModal").css("left",((rect.left)-230-($("#mfShareModal").width()))+"px");$("#mfShareModal").show();$("#mfShareMemberChkAll").prop("checked",false);$("#mfShareList .mfShareMemberChk").prop("checked",false).attr("disabled",false);thisClass.list();$("#mfShareAddMemberBox").focus();};this.closeShareModalHandler=function(e){$("#mfShareModal").hide();};this.openShareModalHandler=function(e){if($("#mfShareModal").is(":visible")){$("#mfShareModal").hide();return;}if(!MF_UserSession.IsOpenAllowed()){if(MF_UserSession.getUser().isTrial){alert(MF_UserSession.createAllowedAlertMsg);}else{alert("Resubscribe to MockFlow for continued access");}mf_main.openUpgradeModal();return;}var pass=true;if(MF_UserSession.getUser().isBasic){if(mf_main.dashboardController.projectController.collaborators.size()>=2){pass=false;}}if(pass){thisClass.changeMode=false;thisClass.changeMember=null;thisClass.showShareModal();}else{var answer=confirm("Your Basic MockFlow account allows only 2 reviewers per project, Upgrade now?");if(answer){mf_main.openUpgradeModal();return;}}};this.addReviewerClickHandler=function(e){if(thisClass.changeMode==true){thisClass.tempMemberType="Reviewer";thisClass.updateCollaborator(sharePerm);}else{for(i=0;i<thisClass.selectedMemberCollection.length;i++){var sharePerm=new MF_SharePerm();thisClass.selectMemberbyID(thisClass.selectedMemberCollection[i]);thisClass.shareMember=thisClass.selectedMember;thisClass.addCollaborator(thisClass.shareMember.userid,"Reviewer",sharePerm);}}};this.addApproverClickHandler=function(e){var sharePerm=new MF_SharePerm();if(thisClass.changeMode==true){thisClass.tempMemberType="Approver";thisClass.updateCollaborator(sharePerm);}else{thisClass.addCollaborator(thisClass.shareMember.userid,"Approver",sharePerm);}};this.addEditorClickHandler=function(e){if(MF_UserSession.getUser().isNewLicense&&!MF_UserSession.getUser().teamPremium){return;}if(thisClass.changeMode==true){thisClass.tempMemberType="Editor";thisClass.updateCollaborator(sharePerm);}else{for(i=0;i<thisClass.selectedMemberCollection.length;i++){var sharePerm=new MF_SharePerm();thisClass.selectMemberbyID(thisClass.selectedMemberCollection[i]);thisClass.shareMember=thisClass.selectedMember;thisClass.addCollaborator(thisClass.shareMember.userid,"Editor",sharePerm);}}};this.resetAdvancedPermissions=function(){var sharePerm=new MF_SharePerm();$("#mfEditorPermUploadImage").attr("checked",sharePerm.canUploadImage);$("#mfEditorPermDeleteImage").attr("checked",sharePerm.canDeleteImage);$("#mfEditorPermCreateBoard").attr("checked",sharePerm.canCreateBoard);$("#mfEditorPermEditBoard").attr("checked",sharePerm.canEditBoard);$("#mfEditorPermDeleteBoard").attr("checked",sharePerm.canDeleteBoard);};this.addAdminClickHandler=function(e){if(mf_main.dashboardController.projectController.selectedProject.permissionType=="Admin"){alert("Only Project Owner can add new Administrators. Choose other permissions.");return;}if(!MF_UserSession.getUser().teamPremium){return;}if(thisClass.changeMode==true){thisClass.tempMemberType="Admin";thisClass.updateCollaborator(sharePerm);}else{for(i=0;i<thisClass.selectedMemberCollection.length;i++){thisClass.selectMemberbyID(thisClass.selectedMemberCollection[i]);thisClass.shareMember=thisClass.selectedMember;var sharePerm=new MF_SharePerm();thisClass.addCollaborator(thisClass.shareMember.userid,"Admin",sharePerm);}}};this.reviewerClickHandler=function(e){thisClass.hideAllCanvas();thisClass.resetAdvancedPermissions();if(thisClass.changeMode==true){var sharePerm=thisClass.changeMember.sharePerm;if(sharePerm){}}$("#mfShareModalReviewerAdvScreen").show();thisClass.tempMemberType="Reviewer";};this.approverClickHandler=function(e){if(thisClass.IsApproverExist()){alert("Approver already exists. Only 1 Approver is allowed per project. \n\nTo set this user as Approver, delete the existing Approver first.");return;}thisClass.hideAllCanvas();thisClass.resetAdvancedPermissions();if(thisClass.changeMode==true){var sharePerm=thisClass.changeMember.sharePerm;if(sharePerm){}}$("#mfShareModalApproverAdvScreen").show();thisClass.tempMemberType="Approver";};this.collaboratorClickHandler=function(e){thisClass.hideAllCanvas();thisClass.resetAdvancedPermissions();if(thisClass.changeMode==true){var sharePerm=thisClass.changeMember.sharePerm;if(sharePerm){$("#mfEditorPermUploadImage").attr("checked",sharePerm.canUploadImage);$("#mfEditorPermDeleteImage").attr("checked",sharePerm.canDeleteImage);$("#mfEditorPermCreateBoard").attr("checked",sharePerm.canCreateBoard);$("#mfEditorPermEditBoard").attr("checked",sharePerm.canEditBoard);$("#mfEditorPermDeleteBoard").attr("checked",sharePerm.canDeleteBoard);}}$("#mfShareModalEditorAdvScreen").show();thisClass.tempMemberType="Editor";};this.adminClickHandler=function(e){if(mf_main.dashboardController.projectController.selectedProject.permissionType=="Admin"){alert("Only Project Owner can add new Administrators. Choose other permissions.");return;}if(!MF_UserSession.getUser().teamPremium){var answer=confirm("Only users with Team-Pack licenses can set multiple administrators for projects. Upgrade now?");if(answer){mf_main.openUpgradeModal();return;}return;}thisClass.hideAllCanvas();$("#mfShareModalAdminAdvScreen").show();thisClass.tempMemberType="Admin";};this.goBackHandler=function(e){thisClass.mfShareModalReset();};this.mfShareModalReset=function(e){thisClass.resetAdvancedPermissions();thisClass.selectedMemberCollection=[];if(thisClass.changeMode==true){thisClass.hideAllCanvas();$("#mfShareModalChangeScreen").show();$("#mfShareModalTitle").text("Member operations");$("#mfShareGoBackBtn").css("display","none");$(".mfShareForMember").text(thisClass.changeMember.userid);}else{thisClass.hideAllCanvas();$("#mfShareModalMembersScreen").show();$("#mfShareModalTitle").text("Share Project");$("#mfShareAddMemberBox").val("");$("#mfShareAddMemberBox").trigger("input");$("#mfShareGoBackBtn").css("display","block");}};this.hideAllCanvas=function(e){$("#mfShareModalMembersScreen").hide();$("#mfShareModalTypeScreen").hide();$("#mfShareModalReviewerAdvScreen").hide();$("#mfShareModalEditorAdvScreen").hide();$("#mfShareModalAdminAdvScreen").hide();$("#mfShareModalChangeScreen").hide();};this.shareModalShownHandler=function(e){thisClass.list();$("#mfShareAddMemberBox").focus();};this.enterHandler=function(e){var keycode=(e.keyCode?e.keyCode:e.which);if(keycode=="13"){thisClass.addClickHandler(null);}};this.addClickHandler=function(e){var EmailCollection=$("#mfShareAddMemberBox").val().split(",");for(i=0;i<EmailCollection.length;i++){thisClass.addNewMember(EmailCollection[i].trim());}};this.textChangeHandler=function(e){var searchval=$("#mfShareAddMemberBox").val().toLowerCase().trim();if(searchval==""){$("#mfShareMemberChkAllContainer").show();$("#mfAddToUserList").hide();}else{$("#mfShareMemberChkAllContainer").hide();$("#mfAddToUserList").show();}for(var i=0;i<mf_main.teamController.teamMembers.size();i++){var item=mf_main.teamController.teamMembers.getItemAt(i);if(item.userid.toLowerCase().indexOf(searchval)>=0){$("#mfShareMemberItem"+item.id).css("height","40px");$("#mfShareMemberItem"+item.id).show();}else{$("#mfShareMemberItem"+item.id).css("height","0px");$("#mfShareMemberItem"+item.id).hide();}}};this.applyTemplate=function(arr){$("#mfShareList").empty();$("#mfShareManagerLoader").css("display","none");mf_main.teamController.teamMembers=new ArrayCollection();$("#mfTeamList").empty();$("#mfTeamManagerLoader").css("display","none");var cachedTemplate=mf_main.getTemplateFromCache("mfShareMemberTemplate");if(cachedTemplate==null){$.get("templates/dashboard/ShareMember.htm",function(templates){var template=Handlebars.compile($(templates).filter("#mfShareMemberTemplate").html());mf_main.addTemplateToCache("mfShareMemberTemplate",template);thisClass.renderShareMemberItem(template,arr);});}else{thisClass.renderShareMemberItem(cachedTemplate,arr);}};this.renderShareMemberItem=function(template,arr){$("#mfShareList .mfShareMemberChk").prop("checked",false).attr("disabled",false);for(var i=0,j=arr.length;i<j;i++){var teamMember=new MF_TeamMember();teamMember.cast(arr[i]);mf_main.teamController.teamMembers.addItem(teamMember);thisClass.appendTeamMember(template,teamMember);}if(arr.length==0){$("#mfShareList").html("<div style='width: 450px; color: #888;'>The team list is empty. You can type multiple emails in the above box and press 'Enter' to first add users to your team. And then click 'Share' button.</div>");}thisClass.userListCheckHandler();$(".mfShareMemberDelBtn").off("click");$(".mfShareMemberDelBtn").on("click",thisClass.deleteMemberHandler);};this.appendTeamMember=function(template,teamMember,prepend){if(prepend){$("#mfShareList").prepend(template(teamMember));}else{$("#mfShareList").append(template(teamMember));}$("#mfShareMemberItem"+teamMember.id).on("mouseover",thisClass.memberItemOver);$("#mfShareMemberItem"+teamMember.id).on("mouseout",thisClass.memberItemOut);$("#mfShareMemberItem"+teamMember.id+" .mfShareMemberChk").on("click",thisClass.checkMemberHandler);};this.shareMemberHandler=function(e){thisClass.selectedMemberCollection=[];thisClass.addClickHandler();if($("#mfShareList .mfShareMemberChk:checked:enabled").length==0){MF_Utils.display_ActionIndicator("No new members selected");return;}$("#mfShareList .mfShareMemberChk:checked:enabled").each(function(i){if($(this).attr("disabled")!="disabled"&&$(this).prop("checked")==true){var usermfid=$(this).closest(".mfShareMemberItem").attr("id");var chkMember=$.grep(mf_main.teamController.teamMembers.data,function(e){return"mfShareMemberItem"+e.id==usermfid;});thisClass.selectedMemberCollection.push(chkMember[0].userid);thisClass.gotoMemberTypeScreen();}});};this.checkAllMemberHandler=function(e){var membersCnt=mf_main.dashboardController.projectController.collaborators.size()+$("#mfShareList .mfShareMemberChk:enabled:visible").length;var memberLimitAllowed=thisClass.isMemberLimitAllowed(membersCnt);if(memberLimitAllowed){}else{$(this).prop("checked",false);return;}$("#mfShareList .mfShareMemberChk").each(function(i){if($(this).attr("disabled")!="disabled"&&$("#mfShareMemberChkAll").prop("checked")==false){$(this).prop("checked",false);}else{$(this).prop("checked",true);}});};this.isMemberLimitAllowed=function(membersCnt,noalert){var allow=true;if(MF_UserSession.getUser().isBasic){if(membersCnt>2){if(noalert){allow=false;}else{var answer=confirm("Your Basic MockFlow account allows only 2 reviewers per project, Upgrade now?");if(answer){allow=false;mf_main.openUpgradeModal();}else{allow=false;}}}}else{if(!MF_UserSession.getUser().teamPremium){if(MF_UserSession.getUser().isNewLicense){}else{if(membersCnt>5){if(noalert){allow=false;}else{var answer=confirm("Maximum of 5 members are allowed per project in Premium license. For unlimited collaborators upgrade to Team-Pack");if(answer){allow=false;mf_main.openUpgradeModal();}else{allow=false;}}}}}}return allow;};this.checkMemberHandler=function(e){var mfuserid=$(this).closest(".mfShareMemberItem").attr("id");var chkdmember=$.grep(mf_main.teamController.teamMembers.data,function(e){return"mfShareMemberItem"+e.id==mfuserid;});var membersCnt=mf_main.dashboardController.projectController.collaborators.size()+$("#mfShareList .mfShareMemberChk:checked:enabled:visible").length;if(chkdmember!=""){if(thisClass.IsExist(chkdmember[0].userid)){MF_Utils.display_ActionIndicator("Project already shared with this user");$(this).prop("checked",false);}}var memberLimitAllowed=thisClass.isMemberLimitAllowed(membersCnt);if(memberLimitAllowed){}else{$(this).prop("checked",false);return;}$("#mfShareList .mfShareMemberChk").each(function(i){if($(this).prop("checked")==false){$("#mfShareMemberChkAll").prop("checked",false);return;}});};this.userListCheckHandler=function(){$("#mfShareList .mfShareMemberChk").each(function(i){var usermfid=$(this).closest(".mfShareMemberItem").attr("id");var chkMember=$.grep(mf_main.teamController.teamMembers.data,function(e){return"mfShareMemberItem"+e.id==usermfid;});if(chkMember!=""&&thisClass.IsExist(chkMember[0].userid)){$("#"+usermfid+" .mfShareMemberChk").prop("checked",true).attr("disabled",true);}else{if(chkMember!=""&&mf_main.dashboardController.projectController.selectedProject&&(mf_main.dashboardController.projectController.selectedProject.creator.toLowerCase()==chkMember[0].userid.toLowerCase())){$("#"+usermfid+" .mfShareMemberChk").prop("checked",true).attr("disabled",true);}else{}}});};this.gotoMemberTypeScreen=function(){thisClass.hideAllCanvas();$("#mfShareModalTypeScreen").show();$(".mfShareForMember").text(thisClass.selectedMemberCollection.length==1?thisClass.selectedMemberCollection.toString():thisClass.selectedMemberCollection.length+" Users");$("#mfShareModalTitle").text("Select Permission");};this.memberSelectHandler=function(e){$(this).css({"background-color":"#ffffff"});thisClass.selectMember($(this).attr("id"));if(thisClass.IsExist(thisClass.selectedMember.userid)){MF_Utils.display_ActionIndicator("Project already shared with this user");return;}thisClass.shareMember=thisClass.selectedMember;thisClass.gotoMemberTypeScreen();};this.deleteMemberHandler=function(e){e.stopImmediatePropagation();thisClass.selectDeleteMember($(this).attr("id"));thisClass.deleteMember();};this.list=function(){if(thisClass.listed){thisClass.userListCheckHandler();return;}$("#mfShareManagerLoader").css("display","block");MF_TeamManager.list(MF_UserSession.getUser().company,{callback:function(arr){if(arr!=null){thisClass.listed=true;thisClass.applyTemplate(arr);if(arr==""){$("#mfShareMemberChkAllContainer").hide();}else{$("#mfShareMemberChkAllContainer").show();}}}});};this.memberItemOver=function(e){$(this).css({"background-color":"#f6f6f6"});};this.memberItemOut=function(e){$(this).css({"background-color":"#fff"});};this.selectMember=function(pid){for(var i=0;i<mf_main.teamController.teamMembers.size();i++){var item=mf_main.teamController.teamMembers.getItemAt(i);if("mfShareMemberItem"+item.id==pid){this.selectedMember=item;break;}}};this.selectMemberbyID=function(pid){for(var i=0;i<mf_main.teamController.teamMembers.size();i++){var item=mf_main.teamController.teamMembers.getItemAt(i);if(item.userid.toLowerCase()==pid.toLowerCase()){this.selectedMember=item;break;}}};this.selectDeleteMember=function(pid){for(var i=0;i<mf_main.teamController.teamMembers.size();i++){var item=mf_main.teamController.teamMembers.getItemAt(i);if("mfShareMemberDelBtn"+item.id==pid){this.selectedMember=item;break;}}};this.memberItemClick=function(e){$(this).css({"background-color":"#fff"});thisClass.selectMember($(this).attr("id"));};this.deleteMember=function(){if(thisClass.selectedMember!=null){var answer=confirm('Remove "'+thisClass.selectedMember.userid+'" from your Team List?');if(answer){$("#mfShareMemberItem"+thisClass.selectedMember.id).css("height","0px");$("#mfShareMemberItem"+thisClass.selectedMember.id).css("display","none");$("#mfShareMemberItem"+thisClass.selectedMember.id).remove();var tind=mf_main.teamController.teamMembers.getItemIndex(thisClass.selectedMember);if(tind!=-1){mf_main.teamController.teamMembers.removeItemAt(tind);}MF_TeamManager.deleteMember(MF_UserSession.getUser(),thisClass.selectedMember.userid,{callback:function(str){$("#mfShareManagerLoader").css("display","none");}});}}};this.addNewMember=function(memberID){if(memberID.toLowerCase()==MF_UserSession.getUser().username.toLowerCase()){MF_Utils.display_ActionIndicator("You cannot share it with yourself");return;}if(memberID==""){return;}memberID=memberID.toLowerCase();if(!MF_Utils.isValidEmailAddress(memberID)){return;}if(thisClass.IsExist(memberID)){MF_Utils.display_ActionIndicator("Project already shared with this user");return;}if(thisClass.IsTeamMemberExist(memberID)){var existMember=thisClass.getTeamMember(memberID);thisClass.shareMember=existMember;}else{if(mf_main.teamController.teamMembers.size()==0){$("#mfShareList").empty();}var mem=new MF_TeamMember();mem.id=MF_Utils.guidGenerator();mem.userid=memberID;mem.type="";mem.license="";$("#mfShareAddMemberBox").val("");$("#mfShareMemberChkAll").prop("checked",false);thisClass.textChangeHandler(null);mf_main.teamController.teamMembers.addItemAt(mem,0);var cachedTemplate=mf_main.getTemplateFromCache("mfShareMemberTemplate");if(cachedTemplate){thisClass.appendTeamMember(cachedTemplate,mem,true);}$(".mfShareMemberDelBtn").off("click");$(".mfShareMemberDelBtn").on("click",thisClass.deleteMemberHandler);$("#mfShareManagerLoader").css("display","block");$("#mfShareManagerLoader").css("display","none");var membersCnt=mf_main.dashboardController.projectController.collaborators.size()+$("#mfShareList .mfShareMemberChk:checked:enabled:visible").length;if(thisClass.isMemberLimitAllowed(membersCnt+1,true)){thisClass.shareMember=mem;$("#mfShareMemberItem"+mem.id+" .mfShareMemberChk").click();}MF_TeamManager.addMember(MF_UserSession.getUser().company,mem,MF_UserSession.getUser(),{callback:function(str){if(str=="success"){}else{MF_Utils.display_ActionIndicator("Some error occurred");}}});}};this.IsTeamMemberExist=function(email){for(var i=0;i<mf_main.teamController.teamMembers.size();i++){var user=mf_main.teamController.teamMembers.getItemAt(i);if(user.userid.toLowerCase()==email.toLowerCase()){return true;}}return false;};this.getTeamMember=function(email){for(var i=0;i<mf_main.teamController.teamMembers.size();i++){var user=mf_main.teamController.teamMembers.getItemAt(i);if(user.userid.toLowerCase()==email.toLowerCase()){return user;}}return null;};this.checkLimit=function(){var allow=true;if((mf_main.dashboardController.projectController.selectedProject.members)>=2){if(MF_UserSession.getUser().isBasic){allow=false;}else{allow=true;}}return allow;};this.IsExist=function(email){for(var i=0;i<mf_main.dashboardController.projectController.collaborators.size();i++){var user=mf_main.dashboardController.projectController.collaborators.getItemAt(i);if(user.userid.toLowerCase()==email.toLowerCase()){return true;}}return false;};this.IsApproverExist=function(){for(var i=0;i<mf_main.dashboardController.projectController.collaborators.size();i++){var user=mf_main.dashboardController.projectController.collaborators.getItemAt(i);if(user.type=="Approver"||user.type=="approver"){return true;}}return false;};this.updateCollaborator=function(sharePerm){mf_main.closeDialog();var memberTypeChanged=false;if(thisClass.changeMember.type!=thisClass.tempMemberType){memberTypeChanged=true;}thisClass.changeMember.type=thisClass.tempMemberType;thisClass.changeMember.sharePerm=sharePerm;mf_main.dashboardController.projectController.selectedProject.collaborators=mf_main.dashboardController.projectController.collaborators.toArray();$("#mfMemberList").empty();var cachedTemplate=mf_main.getTemplateFromCache("mfProjectMemberTemplate");if(cachedTemplate!=null){mf_main.dashboardController.projectController.renderProjectMemberItems(cachedTemplate,mf_main.dashboardController.projectController.collaborators.toArray());}var rtcObj=new MF_DashboardRTCNotificationItem();rtcObj.collabarators.push(thisClass.changeMember.userid);MF_UserManager.updateCollaboratorAll(MF_UserSession.getUser(),mf_main.dashboardController.projectController.selectedProject.company,mf_main.dashboardController.projectController.selectedProject,thisClass.changeMember,memberTypeChanged,{callback:function(str,argData){if(memberTypeChanged){try{if(argData.changeMember.type=="Editor"){argData.changeMember.type="Designer";}rtcObj.messageStr='has changed your role to "'+argData.changeMember.type+'" for the project "'+argData.projectTitle+'"';mf_main.dashboardRtcController.projectShareSync("project_share",argData.rtcObj);var collaboratorsCollection=[];collaboratorsCollection=MF_Utils.getDashboardRTCCollabrators(argData.changeMember.userid);argData.rtcObj.collabarators=[];argData.rtcObj.collabarators=collaboratorsCollection.slice(0);argData.rtcObj.messageStr="has changed "+argData.changeMember.userid+' role to "'+argData.changeMember.type+'" for the project "'+argData.projectTitle+'"';mf_main.dashboardRtcController.projectShareSync("project_sync",argData.rtcObj);}catch(error){console.log(error);}}},arg:{rtcObj:rtcObj,changeMember:thisClass.changeMember,projectTitle:mf_main.dashboardController.projectController.selectedProject.title}});if(memberTypeChanged){mf_main.logController.logMemberType(thisClass.changeMember.userid,thisClass.changeMember.type,mf_main.dashboardController.projectController.selectedProject.id,mf_main.dashboardController.projectController.selectedProject.title);}};this.getEditorCount=function(){var count=0;for(var i=0;i<mf_main.dashboardController.projectController.collaborators.size();i++){var user=mf_main.dashboardController.projectController.collaborators.getItemAt(i);if(user.type=="Editor"){count++;}}return count;};this.addCollaborator=function(userid,usertype,sharePerm){if(thisClass.checkLimit()){if(userid==""){return;}mf_main.closeDialog();var collab=new MF_Collaborator();collab.projectid=mf_main.dashboardController.projectController.selectedProject.id;collab.type=usertype;collab.userid=userid;collab.sharePerm=sharePerm;collab.id=MF_Utils.guidGenerator();mf_main.dashboardController.projectController.collaborators.addItem(collab);mf_main.dashboardController.projectController.selectedProject.collaborators=mf_main.dashboardController.projectController.collaborators.toArray();mf_main.dashboardController.projectController.updateMemberCount(true);$("#mfMemberList").empty();var cachedTemplate=mf_main.getTemplateFromCache("mfProjectMemberTemplate");if(cachedTemplate!=null){mf_main.dashboardController.projectController.renderProjectMemberItems(cachedTemplate,mf_main.dashboardController.projectController.collaborators.toArray());}MF_Utils.display_ActionIndicator("Email Invitation has been sent");MF_UserManager.addCollaborator(mf_main.dashboardController.projectController.selectedProject.company,MF_UserSession.getUser(),mf_main.dashboardController.projectController.selectedProject,userid,usertype,sharePerm,mf_main.gappAccess,{callback:function(str,argData){if(str=="success"){mf_main.logController.logNewMember(userid,usertype,argData.selectedProject.id,argData.selectedProject.title);try{if(usertype=="Editor"){usertype="Designer";}var rtcObj=new MF_DashboardRTCNotificationItem();rtcObj.collabarators.push(userid);rtcObj.messageStr='has added you as "'+usertype+'" for the project "'+argData.selectedProject.title+'"';mf_main.dashboardRtcController.projectShareSync("project_share",rtcObj);var collaboratorsCollection=[];collaboratorsCollection=MF_Utils.getDashboardRTCCollabrators(userid);rtcObj.collabarators=[];rtcObj.collabarators=collaboratorsCollection.slice(0);rtcObj.messageStr="has added "+userid+' as "'+usertype+'" for the project "'+argData.selectedProject.title+'"';mf_main.dashboardRtcController.projectShareSync("project_sync",rtcObj);}catch(error){console.log(error);}}else{if(str=="spam"){if(mf_main.dashboardController.projectController.collaborators.length>0){mf_main.dashboardController.projectController.collaborators.removeItemAt(mf_main.dashboardController.projectController.collaborators.length-1);}mf_main.dashboardController.projectController.updateMemberCount(false);MF_Utils.display_ActionIndicator("Temporary e-mail addressess not accepted");}else{if(mf_main.dashboardController.projectController.collaborators.length>0){mf_main.dashboardController.projectController.collaborators.removeItemAt(mf_main.dashboardController.projectController.collaborators.length-1);}mf_main.dashboardController.projectController.updateMemberCount(false);MF_Utils.display_ActionIndicator("Some error occurred");}}},arg:{selectedProject:mf_main.dashboardController.projectController.selectedProject}});}else{var answer=confirm("Your Basic MockFlow account allows only 2 reviewers per project, Upgrade now?");if(answer){mf_main.openUpgradeModal();return;}}};}